"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.DeserializeGameData = exports.HttpResponse = exports.DeleteGameHttpResponse = exports.ModifyGameHttpResponse = exports.CreateGameHttpResponse = exports.ListGamesHttpResponse = exports.GetGameHttpResponse = void 0;
const AWS = require('aws-sdk');
const modules_1 = require("./modules");
exports.handler = async (event, context, callback) => {
    switch (event.path) {
        case ("/getGame"):
            let getGameData = DeserializeGameData({ gameName: event.queryStringParameters["gameName"] });
            callback(null, await GetGameHttpResponse(getGameData));
            break;
        case ("/listGames"):
            callback(null, await ListGamesHttpResponse());
            break;
        case ("/createGame"):
            let createGameData = DeserializeGameData(JSON.parse(event.body));
            callback(null, await CreateGameHttpResponse(createGameData));
            break;
        case ("/modifyGame"):
            let modifyGameData = DeserializeGameData(JSON.parse(event.body));
            callback(null, await ModifyGameHttpResponse(modifyGameData));
            break;
        case ("/deleteGame"):
            let deleteGameData = DeserializeGameData(JSON.parse(event.body));
            callback(null, await DeleteGameHttpResponse(deleteGameData));
            break;
        default:
            callback(null, HttpResponse({ statusCode: 400, body: JSON.stringify("Invalid operation.") }));
            break;
    }
};
async function GetGameHttpResponse(game) {
    let response = await game.GetGame();
    if (response.code) {
        return ParseDynamoError(response.code);
    }
    else if (response.Item) {
        return HttpResponse({ statusCode: 200, body: JSON.stringify(response) });
    }
    else {
        return HttpResponse({ statusCode: 404, body: "Unable to get game." });
    }
}
exports.GetGameHttpResponse = GetGameHttpResponse;
async function ListGamesHttpResponse() {
    let response = await (0, modules_1.ListGames)();
    if (response.code) {
        return ParseDynamoError(response.code);
    }
    else if (response.Items) {
        return HttpResponse({ statusCode: 200, body: JSON.stringify(response) });
    }
    else {
        return HttpResponse({ statusCode: 404, body: "Unable to get list of games." });
    }
}
exports.ListGamesHttpResponse = ListGamesHttpResponse;
async function CreateGameHttpResponse(game) {
    let response = await game.CreateGame();
    if (response.code) {
        return ParseDynamoError(response.code);
    }
    else if (response.Item) {
        return HttpResponse({ statusCode: 201, body: JSON.stringify(response) });
    }
    else {
        return HttpResponse({ statusCode: 404, body: "Unable to create game." });
    }
}
exports.CreateGameHttpResponse = CreateGameHttpResponse;
async function ModifyGameHttpResponse(game) {
    let response = await game.ModifyGame();
    if (response.code) {
        return ParseDynamoError(response.code);
    }
    else if (response.Item) {
        return HttpResponse({ statusCode: 200, body: JSON.stringify(response) });
    }
}
exports.ModifyGameHttpResponse = ModifyGameHttpResponse;
async function DeleteGameHttpResponse(game) {
    let response = await game.DeleteGame();
    if (response.code) {
        return ParseDynamoError(response.code);
    }
    else if (response.Item) {
        return HttpResponse({ statusCode: 200, body: JSON.stringify(response) });
    }
    else {
        return HttpResponse({ statusCode: 404, body: "Unable to delete game." });
    }
}
exports.DeleteGameHttpResponse = DeleteGameHttpResponse;
function HttpResponse(data) {
    return {
        statusCode: data.statusCode,
        body: data.body,
        headers: {
            'Access-Control-Allow-Origin': '*'
        }
    };
}
exports.HttpResponse = HttpResponse;
function DeserializeGameData(data) {
    return new modules_1.Game(data.gameName, data.yearReleased, data.genre, data.console, data.developer);
}
exports.DeserializeGameData = DeserializeGameData;
function ParseDynamoError(error) {
    switch (error) {
        case "AccessDeniedException":
            return HttpResponse({ statusCode: 400, body: "Unauthorized request." });
        case "ConditionalCheckFailedException":
            return HttpResponse({ statusCode: 400, body: "Error with the provided condition." });
        default:
            return HttpResponse({ statusCode: 400, body: "Invalid operation." });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSxNQUFNLEdBQUcsR0FBRyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7QUFDL0IsdUNBQXlFO0FBRXpFLE9BQU8sQ0FBQyxPQUFPLEdBQUcsS0FBSyxFQUFFLEtBQVUsRUFBRSxPQUFZLEVBQUUsUUFBYSxFQUFFLEVBQUU7SUFDbEUsUUFBUSxLQUFLLENBQUMsSUFBSSxFQUFFO1FBQ2xCLEtBQUssQ0FBQyxVQUFVLENBQUM7WUFDZixJQUFJLFdBQVcsR0FBRyxtQkFBbUIsQ0FBQyxFQUFDLFFBQVEsRUFBRSxLQUFLLENBQUMscUJBQXFCLENBQUMsVUFBVSxDQUFDLEVBQUMsQ0FBQyxDQUFDO1lBQzNGLFFBQVEsQ0FBQyxJQUFJLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO1lBQ3ZELE1BQU07UUFDUixLQUFLLENBQUMsWUFBWSxDQUFDO1lBQ2pCLFFBQVEsQ0FBQyxJQUFJLEVBQUUsTUFBTSxxQkFBcUIsRUFBRSxDQUFDLENBQUM7WUFDOUMsTUFBTTtRQUNSLEtBQUksQ0FBQyxhQUFhLENBQUM7WUFDakIsSUFBSSxjQUFjLEdBQUcsbUJBQW1CLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztZQUNqRSxRQUFRLENBQUMsSUFBSSxFQUFFLE1BQU0sc0JBQXNCLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQztZQUM3RCxNQUFNO1FBQ1IsS0FBSSxDQUFDLGFBQWEsQ0FBQztZQUNqQixJQUFJLGNBQWMsR0FBRyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQ2pFLFFBQVEsQ0FBQyxJQUFJLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDO1lBQzdELE1B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QUFPLEtBQUssRUFBRTtRQUNaLEtBQUssdUJBQXVCO1lBQ3hCLE9BQU8sWUFBWSxDQUFDLEVBQUMsVUFBVSxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsdUJBQXVCLEVBQUMsQ0FBQyxDQUFDO1FBQzFFLEtBQUssaUNBQWlDO1lBQ2xDLE9BQU8sWUFBWSxDQUFDLEVBQUMsVUFBVSxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsb0NBQW9DLEVBQUMsQ0FBQyxDQUFDO1FBQ3ZGO1lBQ0ksT0FBTyxZQUFZLENBQUMsRUFBQyxVQUFVLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxvQkFBb0IsRUFBQyxDQUFDLENBQUM7S0FDeEU7QUFDSCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgQVdTID0gcmVxdWlyZSgnYXdzLXNkaycpO1xyXG5pbXBvcnQgeyBHYW1lLCBJSHR0cFJlc3BvbnNlLCBJRHluYW1vT2JqZWN0LCBMaXN0R2FtZXMgfSBmcm9tIFwiLi9tb2R1bGVzXCJcclxuXHJcbmV4cG9ydHMuaGFuZGxlciA9IGFzeW5jIChldmVudDogYW55LCBjb250ZXh0OiBhbnksIGNhbGxiYWNrOiBhbnkpID0+IHtcclxuICBzd2l0Y2ggKGV2ZW50LnBhdGgpIHtcclxuICAgIGNhc2UgKFwiL2dldEdhbWVcIik6XHJcbiAgICAgIGxldCBnZXRHYW1lRGF0YSA9IERlc2VyaWFsaXplR2FtZURhdGEoe2dhbWVOYW1lOiBldmVudC5xdWVyeVN0cmluZ1BhcmFtZXRlcnNbXCJnYW1lTmFtZVwiXX0pO1xyXG4gICAgICBjYWxsYmFjayhudWxsLCBhd2FpdCBHZXRHYW1lSHR0cFJlc3BvbnNlKGdldEdhbWVEYXRhKSk7XHJcbiAgICAgIGJyZWFrO1xyXG4gICAgY2FzZSAoXCIvbGlzdEdhbWVzXCIpOlxyXG4gICAgICBjYWxsYmFjayhudWxsLCBhd2FpdCBMaXN0R2FtZXNIdHRwUmVzcG9uc2UoKSk7XHJcbiAgICAgIGJyZWFrO1xyXG4gICAgY2FzZShcIi9jcmVhdGVHYW1lXCIpOlxyXG4gICAgICBsZXQgY3JlYXRlR2FtZURhdGEgPSBEZXNlcmlhbGl6ZUdhbWVEYXRhKEpTT04ucGFyc2UoZXZlbnQuYm9keSkpO1xyXG4gICAgICBjYWxsYmFjayhudWxsLCBhd2FpdCBDcmVhdGVHYW1lSHR0cFJlc3BvbnNlKGNyZWF0ZUdhbWVEYXRhKSk7XHJcbiAgICAgIGJyZWFrO1xyXG4gICAgY2FzZShcIi9tb2RpZnlHYW1lXCIpOlxyXG4gICAgICBsZXQgbW9kaWZ5R2FtZURhdGEgPSBEZXNlcmlhbGl6ZUdhbWVEYXRhKEpTT04ucGFyc2UoZXZlbnQuYm9keSkpO1xyXG4gICAgICBjYWxsYmFjayhudWxsLCBhd2FpdCBNb2RpZnlHYW1lSHR0cFJlc3BvbnNlKG1vZGlmeUdhbWVEYXRhKSk7XHJcbiAgICAgIGJyZWFrO1xyXG4gICAgY2FzZSAoXCIvZGVsZXRlR2FtZVwiKTpcclxuICAgICAgbGV0IGRlbGV0ZUdhbWVEYXRhID0gRGVzZXJpYWxpemVHYW1lRGF0YShKU09OLnBhcnNlKGV2ZW50LmJvZHkpKTtcclxuICAgICAgY2FsbGJhY2sobnVsbCwgYXdhaXQgRGVsZXRlR2FtZUh0dHBSZXNwb25zZShkZWxldGVHYW1lRGF0YSkpO1xyXG4gICAgICBicmVhaztcclxuICAgIGRlZmF1bHQ6XHJcbiAgICAgIGNhbGxiYWNrKG51bGwsIEh0dHBSZXNwb25zZSh7c3RhdHVzQ29kZTogNDAwLCBib2R5OiBKU09OLnN0cmluZ2lmeShcIkludmFsaWQgb3BlcmF0aW9uLlwiKX0pKTtcclxuICAgICAgYnJlYWs7XHJcbiAgICB9XHJcbn0gIFxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIEdldEdhbWVIdHRwUmVzcG9uc2UoZ2FtZTogR2FtZSkge1xyXG4gIGxldCByZXNwb25zZSA9IGF3YWl0IGdhbWUuR2V0R2FtZSgpO1xyXG4gIGlmIChyZXNwb25zZS5jb2RlKSB7XHJcbiAgICByZXR1cm4gUGFyc2VEeW5hbW9FcnJvcihyZXNwb25zZS5jb2RlKTtcclxuICB9IGVsc2UgaWYgKHJlc3BvbnNlLkl0ZW0pIHtcclxuICAgIHJldHVybiBIdHRwUmVzcG9uc2Uoe3N0YXR1c0NvZGU6IDIwMCwgYm9keTogSlNPTi5zdHJpbmdpZnkocmVzcG9uc2UpfSk7XHJcbiAgfSBlbHNlIHtcclxuICAgIHJldHVybiBIdHRwUmVzcG9uc2Uoe3N0YXR1c0NvZGU6IDQwNCwgYm9keTogXCJVbmFibGUgdG8gZ2V0IGdhbWUuXCJ9KTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBMaXN0R2FtZXNIdHRwUmVzcG9uc2UoKSB7XHJcbiAgbGV0IHJlc3BvbnNlID0gYXdhaXQgTGlzdEdhbWVzKCk7XHJcbiAgaWYgKHJlc3BvbnNlLmNvZGUpIHtcclxuICAgIHJldHVybiBQYXJzZUR5bmFtb0Vycm9yKHJlc3BvbnNlLmNvZGUpO1xyXG4gIH0gZWxzZSBpZiAocmVzcG9uc2UuSXRlbXMpIHtcclxuICAgIHJldHVybiBIdHRwUmVzcG9uc2Uoe3N0YXR1c0NvZGU6IDIwMCwgYm9keTogSlNPTi5zdHJpbmdpZnkocmVzcG9uc2UpfSk7XHJcbiAgfSBlbHNlIHtcclxuICAgIHJldHVybiBIdHRwUmVzcG9uc2Uoe3N0YXR1c0NvZGU6IDQwNCwgYm9keTogXCJVbmFibGUgdG8gZ2V0IGxpc3Qgb2YgZ2FtZXMuXCJ9KVxyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIENyZWF0ZUdhbWVIdHRwUmVzcG9uc2UoZ2FtZTogR2FtZSkge1xyXG4gIGxldCByZXNwb25zZSA9IGF3YWl0IGdhbWUuQ3JlYXRlR2FtZSgpO1xyXG4gIGlmIChyZXNwb25zZS5jb2RlKSB7XHJcbiAgICByZXR1cm4gUGFyc2VEeW5hbW9FcnJvcihyZXNwb25zZS5jb2RlKTtcclxuICB9IGVsc2UgaWYgKHJlc3BvbnNlLkl0ZW0pIHtcclxuICAgIHJldHVybiBIdHRwUmVzcG9uc2Uoe3N0YXR1c0NvZGU6IDIwMSwgYm9keTogSlNPTi5zdHJpbmdpZnkocmVzcG9uc2UpfSk7XHJcbiAgfSBlbHNlIHtcclxuICAgIHJldHVybiBIdHRwUmVzcG9uc2Uoe3N0YXR1c0NvZGU6IDQwNCwgYm9keTogXCJVbmFibGUgdG8gY3JlYXRlIGdhbWUuXCJ9KTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBNb2RpZnlHYW1lSHR0cFJlc3BvbnNlKGdhbWU6IEdhbWUpIHtcclxuICBsZXQgcmVzcG9uc2UgPSBhd2FpdCBnYW1lLk1vZGlmeUdhbWUoKTtcclxuICBpZiAocmVzcG9uc2UuY29kZSkge1xyXG4gICAgcmV0dXJuIFBhcnNlRHluYW1vRXJyb3IocmVzcG9uc2UuY29kZSk7XHJcbiAgfSBlbHNlIGlmIChyZXNwb25zZS5JdGVtKSB7XHJcbiAgICByZXR1cm4gSHR0cFJlc3BvbnNlKHtzdGF0dXNDb2RlOiAyMDAsIGJvZHk6IEpTT04uc3RyaW5naWZ5KHJlc3BvbnNlKX0pO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIERlbGV0ZUdhbWVIdHRwUmVzcG9uc2UoZ2FtZTogR2FtZSkge1xyXG4gIGxldCByZXNwb25zZSA9IGF3YWl0IGdhbWUuRGVsZXRlR2FtZSgpO1xyXG4gIGlmIChyZXNwb25zZS5jb2RlKSB7XHJcbiAgICByZXR1cm4gUGFyc2VEeW5hbW9FcnJvcihyZXNwb25zZS5jb2RlKTtcclxuICB9IGVsc2UgaWYgKHJlc3BvbnNlLkl0ZW0pIHtcclxuICAgIHJldHVybiBIdHRwUmVzcG9uc2Uoe3N0YXR1c0NvZGU6IDIwMCwgYm9keTogSlNPTi5zdHJpbmdpZnkocmVzcG9uc2UpfSk7XHJcbiAgfSBlbHNlIHtcclxuICAgIHJldHVybiBIdHRwUmVzcG9uc2Uoe3N0YXR1c0NvZGU6IDQwNCwgYm9keTogXCJVbmFibGUgdG8gZGVsZXRlIGdhbWUuXCJ9KTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBIdHRwUmVzcG9uc2UoZGF0YTogSUh0dHBSZXNwb25zZSkge1xyXG4gIHJldHVybiB7XHJcbiAgICBzdGF0dXNDb2RlOiBkYXRhLnN0YXR1c0NvZGUsXHJcbiAgICBib2R5OiBkYXRhLmJvZHksXHJcbiAgICBoZWFkZXJzOiB7XHJcbiAgICAgICdBY2Nlc3MtQ29udHJvbC1BbGxvdy1PcmlnaW4nOiAnKidcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBEZXNlcmlhbGl6ZUdhbWVEYXRhKGRhdGE6IElEeW5hbW9PYmplY3QpIHtcclxuICByZXR1cm4gbmV3IEdhbWUoZGF0YS5nYW1lTmFtZSwgZGF0YS55ZWFyUmVsZWFzZWQsIGRhdGEuZ2VucmUsIGRhdGEuY29uc29sZSwgZGF0YS5kZXZlbG9wZXIpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBQYXJzZUR5bmFtb0Vycm9yKGVycm9yOiBzdHJpbmcpIHtcclxuICBzd2l0Y2goZXJyb3IpIHtcclxuICAgIGNhc2UgXCJBY2Nlc3NEZW5pZWRFeGNlcHRpb25cIjpcclxuICAgICAgICByZXR1cm4gSHR0cFJlc3BvbnNlKHtzdGF0dXNDb2RlOiA0MDAsIGJvZHk6IFwiVW5hdXRob3JpemVkIHJlcXVlc3QuXCJ9KTtcclxuICAgIGNhc2UgXCJDb25kaXRpb25hbENoZWNrRmFpbGVkRXhjZXB0aW9uXCI6XHJcbiAgICAgICAgcmV0dXJuIEh0dHBSZXNwb25zZSh7c3RhdHVzQ29kZTogNDAwLCBib2R5OiBcIkVycm9yIHdpdGggdGhlIHByb3ZpZGVkIGNvbmRpdGlvbi5cIn0pO1xyXG4gICAgZGVmYXVsdDpcclxuICAgICAgICByZXR1cm4gSHR0cFJlc3BvbnNlKHtzdGF0dXNDb2RlOiA0MDAsIGJvZHk6IFwiSW52YWxpZCBvcGVyYXRpb24uXCJ9KTtcclxuICB9XHJcbn0iXX0=