"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.deserializeCollectionData = exports.deserializeGameData = exports.httpResponse = exports.removeGameFromWishlist = exports.addGameToWishlist = exports.getWishlistHttpResponse = exports.createWishlistHttpResponse = exports.deleteGameHttpResponse = exports.modifyGameHttpResponse = exports.createGameHttpResponse = exports.listGamesHttpResponse = exports.getGameHttpResponse = void 0;
const AWS = require('aws-sdk');
const game_1 = require("./game");
const gameManager_1 = require("./gameManager");
const collection_1 = require("./collection");
const collectionManager_1 = require("./collectionManager");
exports.handler = async (event, context, callback) => {
    const userID = event.requestContext.authorizer.claims['cognito:username'];
    switch (event.path) {
        case ("/getGame"):
            let gameName = { gameName: event.queryStringParameters["gameName"] };
            let getGameData = deserializeGameData(userID, gameName);
            callback(null, await getGameHttpResponse(getGameData));
            break;
        case ("/listGames"):
            let listGameData = userID;
            callback(null, await listGamesHttpResponse(listGameData));
            break;
        case ("/createGame"):
            let createGameData = deserializeGameData(userID, JSON.parse(event.body));
            callback(null, await createGameHttpResponse(createGameData));
            break;
        case ("/modifyGame"):
            let modifyGameData = deserializeGameData(userID, JSON.parse(event.body));
            callback(null, await modifyGameHttpResponse(modifyGameData));
            break;
        case ("/deleteGame"):
            let deleteGameData = deserializeGameData(userID, JSON.parse(event.body));
            callback(null, await deleteGameHttpResponse(deleteGameData));
            break;
        case ("/collection/wishlist/createWishlist"):
            callback(null, await createWishlistHttpResponse(userID));
            break;
        case ("/collection/wishlist/getWishlist"):
            callback(null, await getWishlistHttpResponse(userID));
            break;
        case ("/collection/wishlist/addGame"):
            let addGameData = deserializeGameData(userID, JSON.parse(event.body));
            callback(null, await addGameToWishlist(addGameData));
            break;
        case ("/collection/wishlist/removeGame"):
            let removeGameData = deserializeGameData(userID, JSON.parse(event.body));
            callback(null, await removeGameFromWishlist(removeGameData));
            break;
        default:
            callback(null, httpResponse({ statusCode: 400, body: JSON.stringify("Invalid operation.") }));
            break;
    }
};

async function getGameHttpResponse(game) {
    try {
        let response = await (0, gameManager_1.getGame)(game);
        return httpResponse({ statusCode: 200, body: JSON.stringify(response) });
    }
    catch (err) {
        return httpResponse({ statusCode: err.statusCode, body: err.message });
    }
}
exports.getGameHttpResponse = getGameHttpResponse;
async function listGamesHttpResponse(userID) {
    try {
        let response = await (0, gameManager_1.listGames)(userID);
        return httpResponse({ statusCode: 200, body: JSON.stringify(response) });
    }
    catch (err) {
        return httpResponse({ statusCode: err.statusCode, body: err.message });
    }
}
exports.listGamesHttpResponse = listGamesHttpResponse;
async function createGameHttpResponse(game) {
    try {
        let response = await game.createGame();
        return httpResponse({ statusCode: 200, body: JSON.stringify(response) });
    }
    catch (err) {
        return httpResponse({ statusCode: err.statusCode, body: err.message });
    }
}
exports.createGameHttpResponse = createGameHttpResponse;
async function modifyGameHttpResponse(game) {
    try {
        let response = await (0, gameManager_1.modifyGame)(game);
        return httpResponse({ statusCode: 200, body: JSON.stringify(response) });
    }
    catch (err) {
        return httpResponse({ statusCode: err.statusCode, body: err.message });
    }
}
exports.modifyGameHttpResponse = modifyGameHttpResponse;
async function deleteGameHttpResponse(game) {
    try {
        let response = await (0, gameManager_1.deleteGame)(game);
        return httpResponse({ statusCode: 200, body: JSON.stringify(response) });
    }
    catch (err) {
        return httpResponse({ statusCode: err.statusCode, body: err.message });
    }
}
exports.deleteGameHttpResponse = deleteGameHttpResponse;
async function createWishlistHttpResponse(userID) {
    try {
        let wishlist = new collection_1.Collection(userID, 'wishlist');
        let response = await wishlist.createCollection();
        return httpResponse({ statusCode: 200, body: JSON.stringify(response) });
    }
    catch (err) {
        return httpResponse({ statusCode: err.statusCode, body: err.message });
    }
}
exports.createWishlistHttpResponse = createWishlistHttpResponse;
async function getWishlistHttpResponse(userID) {
    try {
        let response = await (0, collectionManager_1.getCollection)(userID, "wishlist");
        return httpResponse({ statusCode: 200, body: JSON.stringify(response) });
    }
    catch (err) {
        return httpResponse({ statusCode: err.statusCode, body: err.message });
    }
}
exports.getWishlistHttpResponse = getWishlistHttpResponse;
async function addGameToWishlist(game) {
    try {
        let wishlist = await (0, collectionManager_1.getCollection)(game.userID, 'wishlist');
        let response = await (0, collectionManager_1.addGameToCollection)(game, wishlist);
        return httpResponse({ statusCode: 200, body: JSON.stringify(response) });
    }
    catch (err) {
        return httpResponse({ statusCode: err.statusCode, body: err.message });
    }
}
exports.addGameToWishlist = addGameToWishlist;
async function removeGameFromWishlist(game) {
    try {
        let wishlist = await (0, collectionManager_1.getCollection)(game.userID, 'wishlist');
        let response = await (0, collectionManager_1.removeGameFromCollection)(game, wishlist);
        return httpResponse({ statusCode: 200, body: JSON.stringify(response) });
    }
    catch (err) {
        return httpResponse({ statusCode: err.statusCode, body: err.message });
    }
}
exports.removeGameFromWishlist = removeGameFromWishlist;
function httpResponse(data) {
    return {
        statusCode: data.statusCode,
        body: data.body,
        headers: {
            'Access-Control-Allow-Origin': '*'
        }
    };
}
exports.httpResponse = httpResponse;
function deserializeGameData(userID, data) {
    return new game_1.Game(userID, data.gameName, data === null || data === void 0 ? void 0 : data.yearReleased, data === null || data === void 0 ? void 0 : data.genre, data === null || data === void 0 ? void 0 : data.console, data === null || data === void 0 ? void 0 : data.developer);
}
exports.deserializeGameData = deserializeGameData;
function deserializeCollectionData(userID, collectionType) {
    return new collection_1.Collection(userID, collectionType);
}
exports.deserializeCollectionData = deserializeCollectionData;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSxNQUFNLEdBQUcsR0FBRyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7QUFDL0IsaUNBQTZCO0FBQzdCLCtDQUF3RztBQUN4Ryw2Q0FBMEM7QUFDMUMsMkRBQW1HO0FBRW5HLE9BQU8sQ0FBQyxPQUFPLEdBQUcsS0FBSyxFQUFFLEtBQVUsRUFBRSxPQUFZLEVBQUUsUUFBYSxFQUFFLEVBQUU7SUFDbEUsTUFBTSxNQUFNLEdBQUcsS0FBSyxDQUFDLGNBQWMsQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLGtCQUFrQixDQUFDLENBQUM7SUFDMUUsUUFBUSxLQUFLLENBQUMsSUFBSSxFQUFFO1FBQ2xCLEtBQUssQ0FBQyxVQUFVLENBQUM7WUFDZixJQUFJLFFBQVEsR0FBRyxFQUFFLFFBQVEsRUFBRSxLQUFLLENBQUMscUJBQXFCLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQztZQUNyRSxJQUFJLFdBQVcsR0FBRyxtQkFBbUIsQ0FBQyxNQUFNLEVBQUUsUUFBUSxDQUFDLENBQUE7WUFDdkQsUUFBUSxDQUFDLElBQUksRUFBRSxNQUFNLG1CQUFtQixDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUM7WUFDdkQsTUFBTTtRQUNSLEtBQUksQ0FBQyxZQUFZLENBQUM7WUFDaEIsSUFBSSxZQUFZLEdBQUcsTUFBTSxDQUFDO1lBQzFCLFFBQVEsQ0FBQyxJQUFJLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO1lBQzFELE1BQU07UUFDUixLQUFJLENBQUMsYUFBYSxDQUFDO1lBQ2pCLElBQUksY0FBYyxHQUFHLG1CQUFtQixDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQ3pFLFFBQVEsQ0FBQyxJQUFJLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQyxj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QUFDLENBQUMsQ0FBQztLQUN0RTtBQUNILENBQUM7QUFSRCx3REFRQztBQUVELFNBQWdCLFlBQVksQ0FBQyxJQUFtQjtJQUM5QyxPQUFPO1FBQ0wsVUFBVSxFQUFFLElBQUksQ0FBQyxVQUFVO1FBQzNCLElBQUksRUFBRSxJQUFJLENBQUMsSUFBSTtRQUNmLE9BQU8sRUFBRTtZQUNQLDZCQUE2QixFQUFFLEdBQUc7U0FDbkM7S0FDRixDQUFBO0FBQ0gsQ0FBQztBQVJELG9DQVFDO0FBRUQsU0FBZ0IsbUJBQW1CLENBQUMsTUFBYyxFQUFFLElBQWtCO0lBQ3BFLE9BQU8sSUFBSSxXQUFJLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxRQUFRLEVBQUUsSUFBSSxhQUFKLElBQUksdUJBQUosSUFBSSxDQUFFLFlBQVksRUFBRSxJQUFJLGFBQUosSUFBSSx1QkFBSixJQUFJLENBQUUsS0FBSyxFQUFFLElBQUksYUFBSixJQUFJLHVCQUFKLElBQUksQ0FBRSxPQUFPLEVBQUUsSUFBSSxhQUFKLElBQUksdUJBQUosSUFBSSxDQUFFLFNBQVMsQ0FBQyxDQUFDO0FBQzFHLENBQUM7QUFGRCxrREFFQztBQUVELFNBQWdCLHlCQUF5QixDQUFDLE1BQWMsRUFBRSxjQUFzQjtJQUM5RSxPQUFPLElBQUksdUJBQVUsQ0FBQyxNQUFNLEVBQUUsY0FBYyxDQUFDLENBQUM7QUFDaEQsQ0FBQztBQUZELDhEQUVDIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgQVdTID0gcmVxdWlyZSgnYXdzLXNkaycpO1xyXG5pbXBvcnQgeyBHYW1lIH0gZnJvbSBcIi4vZ2FtZVwiXHJcbmltcG9ydCB7IGdldEdhbWUsIGxpc3RHYW1lcywgSUh0dHBSZXNwb25zZSwgSUpTT05QYXlsb2FkLCBkZWxldGVHYW1lLCBtb2RpZnlHYW1lIH0gZnJvbSBcIi4vZ2FtZU1hbmFnZXJcIjtcclxuaW1wb3J0IHsgQ29sbGVjdGlvbiB9IGZyb20gXCIuL2NvbGxlY3Rpb25cIjtcclxuaW1wb3J0IHsgYWRkR2FtZVRvQ29sbGVjdGlvbiwgZ2V0Q29sbGVjdGlvbiwgcmVtb3ZlR2FtZUZyb21Db2xsZWN0aW9uIH0gZnJvbSBcIi4vY29sbGVjdGlvbk1hbmFnZXJcIjtcclxuXHJcbmV4cG9ydHMuaGFuZGxlciA9IGFzeW5jIChldmVudDogYW55LCBjb250ZXh0OiBhbnksIGNhbGxiYWNrOiBhbnkpID0+IHtcclxuICBjb25zdCB1c2VySUQgPSBldmVudC5yZXF1ZXN0Q29udGV4dC5hdXRob3JpemVyLmNsYWltc1snY29nbml0bzp1c2VybmFtZSddO1xyXG4gIHN3aXRjaCAoZXZlbnQucGF0aCkge1xyXG4gICAgY2FzZSAoXCIvZ2V0R2FtZVwiKTpcclxuICAgICAgbGV0IGdhbWVOYW1lID0geyBnYW1lTmFtZTogZXZlbnQucXVlcnlTdHJpbmdQYXJhbWV0ZXJzW1wiZ2FtZU5hbWVcIl0gfTtcclxuICAgICAgbGV0IGdldEdhbWVEYXRhID0gZGVzZXJpYWxpemVHYW1lRGF0YSh1c2VySUQsIGdhbWVOYW1lKVxyXG4gICAgICBjYWxsYmFjayhudWxsLCBhd2FpdCBnZXRHYW1lSHR0cFJlc3BvbnNlKGdldEdhbWVEYXRhKSk7XHJcbiAgICAgIGJyZWFrO1xyXG4gICAgY2FzZShcIi9saXN0R2FtZXNcIik6XHJcbiAgICAgIGxldCBsaXN0R2FtZURhdGEgPSB1c2VySUQ7XHJcbiAgICAgIGNhbGxiYWNrKG51bGwsIGF3YWl0IGxpc3RHYW1lc0h0dHBSZXNwb25zZShsaXN0R2FtZURhdGEpKTtcclxuICAgICAgYnJlYWs7XHJcbiAgICBjYXNlKFwiL2NyZWF0ZUdhbWVcIik6XHJcbiAgICAgIGxldCBjcmVhdGVHYW1lRGF0YSA9IGRlc2VyaWFsaXplR2FtZURhdGEodXNlcklELCBKU09OLnBhcnNlKGV2ZW50LmJvZHkpKTtcclxuICAgICAgY2FsbGJhY2sobnVsbCwgYXdhaXQgY3JlYXRlR2FtZUh0dHBSZXNwb25zZShjcmVhdGVHYW1lRGF0YSkpO1xyXG4gICAgICBicmVhaztcclxuICAgIGNhc2UoXCIvbW9kaWZ5R2FtZVwiKTpcclxuICAgICAgbGV0IG1vZGlmeUdhbWVEYXRhID0gZGVzZXJpYWxpemVHYW1lRGF0YSh1c2VySUQsIEpTT04ucGFyc2UoZXZlbnQuYm9keSkpO1xyXG4gICAgICBjYWxsYmFjayhudWxsLCBhd2FpdCBtb2RpZnlHYW1lSHR0cFJlc3BvbnNlKG1vZGlmeUdhbWVEYXRhKSk7XHJcbiAgICAgIGJyZWFrO1xyXG4gICAgY2FzZSAoXCIvZGVsZXRlR2FtZVwiKTpcclxuICAgICAgbGV0IGRlbGV0ZUdhbWVEYXRhID0gZGVzZXJpYWxpemVHYW1lRGF0YSh1c2VySUQsIEpTT04ucGFyc2UoZXZlbnQuYm9keSkpO1xyXG4gICAgICBjYWxsYmFjayhudWxsLCBhd2FpdCBkZWxldGVHYW1lSHR0cFJlc3BvbnNlKGRlbGV0ZUdhbWVEYXRhKSk7XHJcbiAgICAgIGJyZWFrO1xyXG4gICAgY2FzZSAoXCIvY29sbGVjdGlvbi93aXNobGlzdC9jcmVhdGVXaXNobGlzdFwiKTpcclxuICAgICAgY2FsbGJhY2sobnVsbCwgYXdhaXQgY3JlYXRlV2lzaGxpc3RIdHRwUmVzcG9uc2UodXNlcklEKSk7XHJcbiAgICAgIGJyZWFrO1xyXG4gICAgY2FzZSAoXCIvY29sbGVjdGlvbi93aXNobGlzdC9nZXRXaXNobGlzdFwiKTpcclxuICAgICAgY2FsbGJhY2sobnVsbCwgYXdhaXQgZ2V0V2lzaGxpc3RIdHRwUmVzcG9uc2UodXNlcklEKSk7XHJcbiAgICAgIGJyZWFrO1xyXG4gICAgY2FzZSAoXCIvY29sbGVjdGlvbi93aXNobGlzdC9hZGRHYW1lXCIpOlxyXG4gICAgICBsZXQgYWRkR2FtZURhdGEgPSBkZXNlcmlhbGl6ZUdhbWVEYXRhKHVzZXJJRCwgSlNPTi5wYXJzZShldmVudC5ib2R5KSk7XHJcbiAgICAgIGNhbGxiYWNrKG51bGwsIGF3YWl0IGFkZEdhbWVUb1dpc2hsaXN0KGFkZEdhbWVEYXRhKSk7XHJcbiAgICAgIGJyZWFrO1xyXG4gICAgY2FzZSAoXCIvY29sbGVjdGlvbi93aXNobGlzdC9yZW1vdmVHYW1lXCIpOlxyXG4gICAgICBsZXQgcmVtb3ZlR2FtZURhdGEgPSBkZXNlcmlhbGl6ZUdhbWVEYXRhKHVzZXJJRCwgSlNPTi5wYXJzZShldmVudC5ib2R5KSk7XHJcbiAgICAgIGNhbGxiYWNrKG51bGwsIGF3YWl0IHJlbW92ZUdhbWVGcm9tV2lzaGxpc3QocmVtb3ZlR2FtZURhdGEpKTtcclxuICAgICAgYnJlYWs7XHJcbiAgICBkZWZhdWx0OlxyXG4gICAgICBjYWxsYmFjayhudWxsLCBodHRwUmVzcG9uc2Uoe3N0YXR1c0NvZGU6IDQwMCwgYm9keTogSlNPTi5zdHJpbmdpZnkoXCJJbnZhbGlkIG9wZXJhdGlvbi5cIil9KSk7XHJcbiAgICAgIGJyZWFrO1xyXG4gICAgfVxyXG59ICBcclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRHYW1lSHR0cFJlc3BvbnNlKGdhbWU6IEdhbWUpIHtcclxuICB0cnkge1xyXG4gICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgZ2V0R2FtZShnYW1lKTtcclxuICAgIHJldHVybiBodHRwUmVzcG9uc2Uoe3N0YXR1c0NvZGU6IDIwMCwgYm9keTogSlNPTi5zdHJpbmdpZnkocmVzcG9uc2UpfSk7XHJcbiAgfSBjYXRjaCAoZXJyOiBhbnkpIHtcclxuICAgIHJldHVybiBodHRwUmVzcG9uc2Uoe3N0YXR1c0NvZGU6IGVyci5zdGF0dXNDb2RlLCBib2R5OiBlcnIubWVzc2FnZX0pO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxpc3RHYW1lc0h0dHBSZXNwb25zZSh1c2VySUQ6IHN0cmluZykge1xyXG4gIHRyeSB7XHJcbiAgICBsZXQgcmVzcG9uc2UgPSBhd2FpdCBsaXN0R2FtZXModXNlcklEKTtcclxuICAgIHJldHVybiBodHRwUmVzcG9uc2Uoe3N0YXR1c0NvZGU6IDIwMCwgYm9keTogSlNPTi5zdHJpbmdpZnkocmVzcG9uc2UpfSk7XHJcbiAgfSBjYXRjaCAoZXJyOiBhbnkpIHtcclxuICAgIHJldHVybiBodHRwUmVzcG9uc2Uoe3N0YXR1c0NvZGU6IGVyci5zdGF0dXNDb2RlLCBib2R5OiBlcnIubWVzc2FnZX0pO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUdhbWVIdHRwUmVzcG9uc2UoZ2FtZTogR2FtZSkge1xyXG4gIHRyeSB7XHJcbiAgICBsZXQgcmVzcG9uc2UgPSBhd2FpdCBnYW1lLmNyZWF0ZUdhbWUoKTtcclxuICAgIHJldHVybiBodHRwUmVzcG9uc2Uoe3N0YXR1c0NvZGU6IDIwMCwgYm9keTogSlNPTi5zdHJpbmdpZnkocmVzcG9uc2UpfSk7XHJcbiAgfSBjYXRjaCAoZXJyOiBhbnkpIHtcclxuICAgIHJldHVybiBodHRwUmVzcG9uc2Uoe3N0YXR1c0NvZGU6IGVyci5zdGF0dXNDb2RlLCBib2R5OiBlcnIubWVzc2FnZX0pO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIG1vZGlmeUdhbWVIdHRwUmVzcG9uc2UoZ2FtZTogR2FtZSkge1xyXG4gIHRyeSB7XHJcbiAgICBsZXQgcmVzcG9uc2UgPSBhd2FpdCBtb2RpZnlHYW1lKGdhbWUpO1xyXG4gICAgcmV0dXJuIGh0dHBSZXNwb25zZSh7c3RhdHVzQ29kZTogMjAwLCBib2R5OiBKU09OLnN0cmluZ2lmeShyZXNwb25zZSl9KTtcclxuICB9IGNhdGNoIChlcnI6IGFueSkge1xyXG4gICAgcmV0dXJuIGh0dHBSZXNwb25zZSh7c3RhdHVzQ29kZTogZXJyLnN0YXR1c0NvZGUsIGJvZHk6IGVyci5tZXNzYWdlfSk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZGVsZXRlR2FtZUh0dHBSZXNwb25zZShnYW1lOiBHYW1lKSB7XHJcbiAgdHJ5IHtcclxuICAgIGxldCByZXNwb25zZSA9IGF3YWl0IGRlbGV0ZUdhbWUoZ2FtZSk7XHJcbiAgICByZXR1cm4gaHR0cFJlc3BvbnNlKHtzdGF0dXNDb2RlOiAyMDAsIGJvZHk6IEpTT04uc3RyaW5naWZ5KHJlc3BvbnNlKX0pO1xyXG4gIH0gY2F0Y2ggKGVycjogYW55KSB7XHJcbiAgICByZXR1cm4gaHR0cFJlc3BvbnNlKHtzdGF0dXNDb2RlOiBlcnIuc3RhdHVzQ29kZSwgYm9keTogZXJyLm1lc3NhZ2V9KTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVXaXNobGlzdEh0dHBSZXNwb25zZSh1c2VySUQ6IHN0cmluZykge1xyXG4gIHRyeSB7XHJcbiAgICBsZXQgd2lzaGxpc3QgPSBuZXcgQ29sbGVjdGlvbih1c2VySUQsICd3aXNobGlzdCcpO1xyXG4gICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgd2lzaGxpc3QuY3JlYXRlQ29sbGVjdGlvbigpO1xyXG4gICAgcmV0dXJuIGh0dHBSZXNwb25zZSh7c3RhdHVzQ29kZTogMjAwLCBib2R5OiBKU09OLnN0cmluZ2lmeShyZXNwb25zZSl9KTtcclxuICB9IGNhdGNoIChlcnI6IGFueSkge1xyXG4gICAgcmV0dXJuIGh0dHBSZXNwb25zZSh7c3RhdHVzQ29kZTogZXJyLnN0YXR1c0NvZGUsIGJvZHk6IGVyci5tZXNzYWdlfSk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0V2lzaGxpc3RIdHRwUmVzcG9uc2UodXNlcklEOiBzdHJpbmcpIHtcclxuICB0cnkge1xyXG4gICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgZ2V0Q29sbGVjdGlvbih1c2VySUQsIFwid2lzaGxpc3RcIik7XHJcbiAgICByZXR1cm4gaHR0cFJlc3BvbnNlKHtzdGF0dXNDb2RlOiAyMDAsIGJvZHk6IEpTT04uc3RyaW5naWZ5KHJlc3BvbnNlKX0pO1xyXG4gIH0gY2F0Y2ggKGVycjogYW55KSB7XHJcbiAgICByZXR1cm4gaHR0cFJlc3BvbnNlKHtzdGF0dXNDb2RlOiBlcnIuc3RhdHVzQ29kZSwgYm9keTogZXJyLm1lc3NhZ2V9KTtcclxuICB9XHJcbn1cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGFkZEdhbWVUb1dpc2hsaXN0KGdhbWU6IEdhbWUpIHtcclxuICB0cnkge1xyXG4gICAgbGV0IHdpc2hsaXN0ID0gYXdhaXQgZ2V0Q29sbGVjdGlvbihnYW1lLnVzZXJJRCwgJ3dpc2hsaXN0Jyk7XHJcbiAgICBsZXQgcmVzcG9uc2UgPSBhd2FpdCBhZGRHYW1lVG9Db2xsZWN0aW9uKGdhbWUsIHdpc2hsaXN0KTtcclxuICAgIHJldHVybiBodHRwUmVzcG9uc2Uoe3N0YXR1c0NvZGU6IDIwMCwgYm9keTogSlNPTi5zdHJpbmdpZnkocmVzcG9uc2UpfSk7XHJcbiAgfSBjYXRjaCAoZXJyOiBhbnkpIHtcclxuICAgIHJldHVybiBodHRwUmVzcG9uc2Uoe3N0YXR1c0NvZGU6IGVyci5zdGF0dXNDb2RlLCBib2R5OiBlcnIubWVzc2FnZX0pO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJlbW92ZUdhbWVGcm9tV2lzaGxpc3QoZ2FtZTogR2FtZSkge1xyXG4gIHRyeSB7XHJcbiAgICBsZXQgd2lzaGxpc3QgPSBhd2FpdCBnZXRDb2xsZWN0aW9uKGdhbWUudXNlcklELCAnd2lzaGxpc3QnKTtcclxuICAgIGxldCByZXNwb25zZSA9IGF3YWl0IHJlbW92ZUdhbWVGcm9tQ29sbGVjdGlvbihnYW1lLCB3aXNobGlzdCk7XHJcbiAgICByZXR1cm4gaHR0cFJlc3BvbnNlKHtzdGF0dXNDb2RlOiAyMDAsIGJvZHk6IEpTT04uc3RyaW5naWZ5KHJlc3BvbnNlKX0pO1xyXG4gIH0gY2F0Y2ggKGVycjogYW55KSB7XHJcbiAgICByZXR1cm4gaHR0cFJlc3BvbnNlKHtzdGF0dXNDb2RlOiBlcnIuc3RhdHVzQ29kZSwgYm9keTogZXJyLm1lc3NhZ2V9KTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBodHRwUmVzcG9uc2UoZGF0YTogSUh0dHBSZXNwb25zZSkgOiB7fSB7XHJcbiAgcmV0dXJuIHtcclxuICAgIHN0YXR1c0NvZGU6IGRhdGEuc3RhdHVzQ29kZSxcclxuICAgIGJvZHk6IGRhdGEuYm9keSxcclxuICAgIGhlYWRlcnM6IHtcclxuICAgICAgJ0FjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbic6ICcqJ1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGRlc2VyaWFsaXplR2FtZURhdGEodXNlcklEOiBzdHJpbmcsIGRhdGE6IElKU09OUGF5bG9hZCkge1xyXG4gIHJldHVybiBuZXcgR2FtZSh1c2VySUQsIGRhdGEuZ2FtZU5hbWUsIGRhdGE/LnllYXJSZWxlYXNlZCwgZGF0YT8uZ2VucmUsIGRhdGE/LmNvbnNvbGUsIGRhdGE/LmRldmVsb3Blcik7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBkZXNlcmlhbGl6ZUNvbGxlY3Rpb25EYXRhKHVzZXJJRDogc3RyaW5nLCBjb2xsZWN0aW9uVHlwZTogc3RyaW5nKSB7XHJcbiAgcmV0dXJuIG5ldyBDb2xsZWN0aW9uKHVzZXJJRCwgY29sbGVjdGlvblR5cGUpO1xyXG59Il19