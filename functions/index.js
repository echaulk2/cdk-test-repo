"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ParseDynamoError = exports.DeserializeGameData = exports.HttpResponse = exports.DeleteGameHttpResponse = exports.ModifyGameHttpResponse = exports.CreateGameHttpResponse = exports.ListGamesHttpResponse = exports.GetGameHttpResponse = void 0;
const AWS = require('aws-sdk');
const game_1 = require("./game");
exports.handler = async (event, context, callback) => {
    switch (event.path) {
        case ("/getGame"):
            let getGameData = DeserializeGameData({ gameName: event.queryStringParameters["gameName"] });
            callback(null, await GetGameHttpResponse(getGameData));
            break;
        case ("/listGames"):
            callback(null, await ListGamesHttpResponse());
            break;
        case ("/createGame"):
            let createGameData = DeserializeGameData(JSON.parse(event.body));
            callback(null, await CreateGameHttpResponse(createGameData));
            break;
        case ("/modifyGame"):
            let modifyGameData = DeserializeGameData(JSON.parse(event.body));
            callback(null, await ModifyGameHttpResponse(modifyGameData));
            break;
        case ("/deleteGame"):
            let deleteGameData = DeserializeGameData(JSON.parse(event.body));
            callback(null, await DeleteGameHttpResponse(deleteGameData));
            break;
        default:
            callback(null, HttpResponse({ statusCode: 400, body: JSON.stringify("Invalid operation.") }));
            break;
    }
};
async function GetGameHttpResponse(game) {
    let response = await (0, game_1.GetGame)(game);
    if (response.code) {
        return ParseDynamoError(response.code);
    }
    else if (response.Item) {
        return HttpResponse({ statusCode: 200, body: JSON.stringify(response) });
    }
    else {
        return HttpResponse({ statusCode: 404, body: "Unable to get game." });
    }
}
exports.GetGameHttpResponse = GetGameHttpResponse;
async function ListGamesHttpResponse() {
    let response = await (0, game_1.ListGames)();
    if (response.code) {
        return ParseDynamoError(response.code);
    }
    else if (response.Items) {
        return HttpResponse({ statusCode: 200, body: JSON.stringify(response) });
    }
    else {
        return HttpResponse({ statusCode: 404, body: "Unable to get list of games." });
    }
}
exports.ListGamesHttpResponse = ListGamesHttpResponse;
async function CreateGameHttpResponse(game) {
    let response = await game.CreateGame();
    if (response.code) {
        return ParseDynamoError(response.code);
    }
    else if (response.Item) {
        return HttpResponse({ statusCode: 201, body: JSON.stringify(response) });
    }
    else {
        return HttpResponse({ statusCode: 404, body: "Unable to create game." });
    }
}
exports.CreateGameHttpResponse = CreateGameHttpResponse;
async function ModifyGameHttpResponse(game) {
    let response = await (0, game_1.ModifyGame)(game);
    if (response.code) {
        return ParseDynamoError(response.code);
    }
    else if (response.Attributes) {
        return HttpResponse({ statusCode: 200, body: JSON.stringify(response.Attributes) });
    }
}
exports.ModifyGameHttpResponse = ModifyGameHttpResponse;
async function DeleteGameHttpResponse(game) {
    let response = await (0, game_1.DeleteGame)(game);
    if (response.code) {
        return ParseDynamoError(response.code);
    }
    else if (response.Attributes) {
        return HttpResponse({ statusCode: 200, body: JSON.stringify(response) });
    }
    else {
        return HttpResponse({ statusCode: 404, body: "Unable to delete game." });
    }
}
exports.DeleteGameHttpResponse = DeleteGameHttpResponse;
function HttpResponse(data) {
    return {
        statusCode: data.statusCode,
        body: data.body,
        headers: {
            'Access-Control-Allow-Origin': '*'
        }
    };
}
exports.HttpResponse = HttpResponse;
function DeserializeGameData(data) {
    return new game_1.Game(data.gameName, data.yearReleased, data.genre, data.console, data.developer);
}
exports.DeserializeGameData = DeserializeGameData;
function ParseDynamoError(error) {
    switch (error) {
        case "ConditionalCheckFailedException":
            return HttpResponse({ statusCode: 400, body: "Error with the provided condition." });
        default:
            return HttpResponse({ statusCode: 400, body: "Invalid operation." });
    }
}
exports.ParseDynamoError = ParseDynamoError;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSxNQUFNLEdBQUcsR0FBRyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7QUFDL0IsaUNBQXVHO0FBRXZHLE9BQU8sQ0FBQyxPQUFPLEdBQUcsS0FBSyxFQUFFLEtBQVUsRUFBRSxPQUFZLEVBQUUsUUFBYSxFQUFFLEVBQUU7SUFDbEUsUUFBUSxLQUFLLENBQUMsSUFBSSxFQUFFO1FBQ2xCLEtBQUssQ0FBQyxVQUFVLENBQUM7WUFDZixJQUFJLFdBQVcsR0FBRyxtQkFBbUIsQ0FBQyxFQUFDLFFBQVEsRUFBRSxLQUFLLENBQUMscUJBQXFCLENBQUMsVUFBVSxDQUFDLEVBQUMsQ0FBQyxDQUFDO1lBQzNGLFFBQVEsQ0FBQyxJQUFJLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO1lBQ3ZELE1BQU07UUFDUixLQUFLLENBQUMsWUFBWSxDQUFDO1lBQ2pCLFFBQVEsQ0FBQyxJQUFJLEVBQUUsTUFBTSxxQkFBcUIsRUFBRSxDQUFDLENBQUM7WUFDOUMsTUFBTTtRQUNSLEtBQUksQ0FBQyxhQUFhLENBQUM7WUFDakIsSUFBSSxjQUFjLEdBQUcsbUJBQW1CLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztZQUNqRSxRQUFRLENBQUMsSUFBSSxFQUFFLE1BQU0sc0JBQXNCLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQztZQUM3RCxNQUFNO1FBQ1IsS0FBSSxDQUFDLGFBQWEsQ0FBQztZQUNqQixJQUFJLGNBQWMsR0FBRyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQ2pFLFFBQVEsQ0FBQyxJQUFJLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDO1lBQzdELE1B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QWdCLGdCQUFnQixDQUFDLEtBQWE7SUFDNUMsUUFBTyxLQUFLLEVBQUU7UUFDWixLQUFLLGlDQUFpQztZQUNsQyxPQUFPLFlBQVksQ0FBQyxFQUFDLFVBQVUsRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLG9DQUFvQyxFQUFDLENBQUMsQ0FBQztRQUN2RjtZQUNJLE9BQU8sWUFBWSxDQUFDLEVBQUMsVUFBVSxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsb0JBQW9CLEVBQUMsQ0FBQyxDQUFDO0tBQ3hFO0FBQ0gsQ0FBQztBQVBELDRDQU9DIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgQVdTID0gcmVxdWlyZSgnYXdzLXNkaycpO1xyXG5pbXBvcnQgeyBHYW1lLCBHZXRHYW1lLCBNb2RpZnlHYW1lLCBEZWxldGVHYW1lLCBJSHR0cFJlc3BvbnNlLCBJRHluYW1vT2JqZWN0LCBMaXN0R2FtZXMgfSBmcm9tIFwiLi9nYW1lXCJcclxuXHJcbmV4cG9ydHMuaGFuZGxlciA9IGFzeW5jIChldmVudDogYW55LCBjb250ZXh0OiBhbnksIGNhbGxiYWNrOiBhbnkpID0+IHtcclxuICBzd2l0Y2ggKGV2ZW50LnBhdGgpIHtcclxuICAgIGNhc2UgKFwiL2dldEdhbWVcIik6XHJcbiAgICAgIGxldCBnZXRHYW1lRGF0YSA9IERlc2VyaWFsaXplR2FtZURhdGEoe2dhbWVOYW1lOiBldmVudC5xdWVyeVN0cmluZ1BhcmFtZXRlcnNbXCJnYW1lTmFtZVwiXX0pO1xyXG4gICAgICBjYWxsYmFjayhudWxsLCBhd2FpdCBHZXRHYW1lSHR0cFJlc3BvbnNlKGdldEdhbWVEYXRhKSk7XHJcbiAgICAgIGJyZWFrO1xyXG4gICAgY2FzZSAoXCIvbGlzdEdhbWVzXCIpOlxyXG4gICAgICBjYWxsYmFjayhudWxsLCBhd2FpdCBMaXN0R2FtZXNIdHRwUmVzcG9uc2UoKSk7XHJcbiAgICAgIGJyZWFrO1xyXG4gICAgY2FzZShcIi9jcmVhdGVHYW1lXCIpOlxyXG4gICAgICBsZXQgY3JlYXRlR2FtZURhdGEgPSBEZXNlcmlhbGl6ZUdhbWVEYXRhKEpTT04ucGFyc2UoZXZlbnQuYm9keSkpO1xyXG4gICAgICBjYWxsYmFjayhudWxsLCBhd2FpdCBDcmVhdGVHYW1lSHR0cFJlc3BvbnNlKGNyZWF0ZUdhbWVEYXRhKSk7XHJcbiAgICAgIGJyZWFrO1xyXG4gICAgY2FzZShcIi9tb2RpZnlHYW1lXCIpOlxyXG4gICAgICBsZXQgbW9kaWZ5R2FtZURhdGEgPSBEZXNlcmlhbGl6ZUdhbWVEYXRhKEpTT04ucGFyc2UoZXZlbnQuYm9keSkpO1xyXG4gICAgICBjYWxsYmFjayhudWxsLCBhd2FpdCBNb2RpZnlHYW1lSHR0cFJlc3BvbnNlKG1vZGlmeUdhbWVEYXRhKSk7XHJcbiAgICAgIGJyZWFrO1xyXG4gICAgY2FzZSAoXCIvZGVsZXRlR2FtZVwiKTpcclxuICAgICAgbGV0IGRlbGV0ZUdhbWVEYXRhID0gRGVzZXJpYWxpemVHYW1lRGF0YShKU09OLnBhcnNlKGV2ZW50LmJvZHkpKTtcclxuICAgICAgY2FsbGJhY2sobnVsbCwgYXdhaXQgRGVsZXRlR2FtZUh0dHBSZXNwb25zZShkZWxldGVHYW1lRGF0YSkpO1xyXG4gICAgICBicmVhaztcclxuICAgIGRlZmF1bHQ6XHJcbiAgICAgIGNhbGxiYWNrKG51bGwsIEh0dHBSZXNwb25zZSh7c3RhdHVzQ29kZTogNDAwLCBib2R5OiBKU09OLnN0cmluZ2lmeShcIkludmFsaWQgb3BlcmF0aW9uLlwiKX0pKTtcclxuICAgICAgYnJlYWs7XHJcbiAgICB9XHJcbn0gIFxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIEdldEdhbWVIdHRwUmVzcG9uc2UoZ2FtZTogR2FtZSkge1xyXG4gIGxldCByZXNwb25zZSA9IGF3YWl0IEdldEdhbWUoZ2FtZSk7XHJcbiAgaWYgKHJlc3BvbnNlLmNvZGUpIHtcclxuICAgIHJldHVybiBQYXJzZUR5bmFtb0Vycm9yKHJlc3BvbnNlLmNvZGUpO1xyXG4gIH0gZWxzZSBpZiAocmVzcG9uc2UuSXRlbSkge1xyXG4gICAgcmV0dXJuIEh0dHBSZXNwb25zZSh7c3RhdHVzQ29kZTogMjAwLCBib2R5OiBKU09OLnN0cmluZ2lmeShyZXNwb25zZSl9KTtcclxuICB9IGVsc2Uge1xyXG4gICAgcmV0dXJuIEh0dHBSZXNwb25zZSh7c3RhdHVzQ29kZTogNDA0LCBib2R5OiBcIlVuYWJsZSB0byBnZXQgZ2FtZS5cIn0pO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIExpc3RHYW1lc0h0dHBSZXNwb25zZSgpIHtcclxuICBsZXQgcmVzcG9uc2UgPSBhd2FpdCBMaXN0R2FtZXMoKTtcclxuICBpZiAocmVzcG9uc2UuY29kZSkge1xyXG4gICAgcmV0dXJuIFBhcnNlRHluYW1vRXJyb3IocmVzcG9uc2UuY29kZSk7XHJcbiAgfSBlbHNlIGlmIChyZXNwb25zZS5JdGVtcykge1xyXG4gICAgcmV0dXJuIEh0dHBSZXNwb25zZSh7c3RhdHVzQ29kZTogMjAwLCBib2R5OiBKU09OLnN0cmluZ2lmeShyZXNwb25zZSl9KTtcclxuICB9IGVsc2Uge1xyXG4gICAgcmV0dXJuIEh0dHBSZXNwb25zZSh7c3RhdHVzQ29kZTogNDA0LCBib2R5OiBcIlVuYWJsZSB0byBnZXQgbGlzdCBvZiBnYW1lcy5cIn0pXHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gQ3JlYXRlR2FtZUh0dHBSZXNwb25zZShnYW1lOiBHYW1lKSB7XHJcbiAgbGV0IHJlc3BvbnNlID0gYXdhaXQgZ2FtZS5DcmVhdGVHYW1lKCk7XHJcbiAgaWYgKHJlc3BvbnNlLmNvZGUpIHtcclxuICAgIHJldHVybiBQYXJzZUR5bmFtb0Vycm9yKHJlc3BvbnNlLmNvZGUpO1xyXG4gIH0gZWxzZSBpZiAocmVzcG9uc2UuSXRlbSkge1xyXG4gICAgcmV0dXJuIEh0dHBSZXNwb25zZSh7c3RhdHVzQ29kZTogMjAxLCBib2R5OiBKU09OLnN0cmluZ2lmeShyZXNwb25zZSl9KTtcclxuICB9IGVsc2Uge1xyXG4gICAgcmV0dXJuIEh0dHBSZXNwb25zZSh7c3RhdHVzQ29kZTogNDA0LCBib2R5OiBcIlVuYWJsZSB0byBjcmVhdGUgZ2FtZS5cIn0pO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIE1vZGlmeUdhbWVIdHRwUmVzcG9uc2UoZ2FtZTogR2FtZSkge1xyXG4gIGxldCByZXNwb25zZSA9IGF3YWl0IE1vZGlmeUdhbWUoZ2FtZSk7XHJcbiAgaWYgKHJlc3BvbnNlLmNvZGUpIHtcclxuICAgIHJldHVybiBQYXJzZUR5bmFtb0Vycm9yKHJlc3BvbnNlLmNvZGUpO1xyXG4gIH0gZWxzZSBpZiAocmVzcG9uc2UuQXR0cmlidXRlcykge1xyXG4gICAgcmV0dXJuIEh0dHBSZXNwb25zZSh7c3RhdHVzQ29kZTogMjAwLCBib2R5OiBKU09OLnN0cmluZ2lmeShyZXNwb25zZS5BdHRyaWJ1dGVzKX0pO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIERlbGV0ZUdhbWVIdHRwUmVzcG9uc2UoZ2FtZTogR2FtZSkge1xyXG4gIGxldCByZXNwb25zZSA9IGF3YWl0IERlbGV0ZUdhbWUoZ2FtZSk7XHJcbiAgaWYgKHJlc3BvbnNlLmNvZGUpIHtcclxuICAgIHJldHVybiBQYXJzZUR5bmFtb0Vycm9yKHJlc3BvbnNlLmNvZGUpO1xyXG4gIH0gZWxzZSBpZiAocmVzcG9uc2UuQXR0cmlidXRlcykge1xyXG4gICAgcmV0dXJuIEh0dHBSZXNwb25zZSh7c3RhdHVzQ29kZTogMjAwLCBib2R5OiBKU09OLnN0cmluZ2lmeShyZXNwb25zZSl9KTtcclxuICB9IGVsc2Uge1xyXG4gICAgcmV0dXJuIEh0dHBSZXNwb25zZSh7c3RhdHVzQ29kZTogNDA0LCBib2R5OiBcIlVuYWJsZSB0byBkZWxldGUgZ2FtZS5cIn0pO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIEh0dHBSZXNwb25zZShkYXRhOiBJSHR0cFJlc3BvbnNlKSB7XHJcbiAgcmV0dXJuIHtcclxuICAgIHN0YXR1c0NvZGU6IGRhdGEuc3RhdHVzQ29kZSxcclxuICAgIGJvZHk6IGRhdGEuYm9keSxcclxuICAgIGhlYWRlcnM6IHtcclxuICAgICAgJ0FjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbic6ICcqJ1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIERlc2VyaWFsaXplR2FtZURhdGEoZGF0YTogSUR5bmFtb09iamVjdCkge1xyXG4gIHJldHVybiBuZXcgR2FtZShkYXRhLmdhbWVOYW1lLCBkYXRhLnllYXJSZWxlYXNlZCwgZGF0YS5nZW5yZSwgZGF0YS5jb25zb2xlLCBkYXRhLmRldmVsb3Blcik7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBQYXJzZUR5bmFtb0Vycm9yKGVycm9yOiBzdHJpbmcpIHtcclxuICBzd2l0Y2goZXJyb3IpIHtcclxuICAgIGNhc2UgXCJDb25kaXRpb25hbENoZWNrRmFpbGVkRXhjZXB0aW9uXCI6XHJcbiAgICAgICAgcmV0dXJuIEh0dHBSZXNwb25zZSh7c3RhdHVzQ29kZTogNDAwLCBib2R5OiBcIkVycm9yIHdpdGggdGhlIHByb3ZpZGVkIGNvbmRpdGlvbi5cIn0pO1xyXG4gICAgZGVmYXVsdDpcclxuICAgICAgICByZXR1cm4gSHR0cFJlc3BvbnNlKHtzdGF0dXNDb2RlOiA0MDAsIGJvZHk6IFwiSW52YWxpZCBvcGVyYXRpb24uXCJ9KTtcclxuICB9XHJcbn0iXX0=