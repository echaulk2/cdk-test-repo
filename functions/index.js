"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const Common = require("./shared/common/game");
const CommonPriceMonitor = require("./shared/common/gamePriceMonitor");
const CommonUser = require("./shared/common/user");
const CommonCollection = require("./shared/common/collection");
const HttpResponse = require("./shared/common/httpResponse");
const wishlist_1 = require("./models/wishlist");
const Config = require("./shared/config/config");
exports.handler = async (event, context, callback) => {
    let userData = {
        userID: `U-${event.requestContext.authorizer.claims['cognito:username']}`,
        email: event.requestContext.authorizer.claims['email']
    };
    const saveParams = {
        TableName: Config.table
    };
    switch (event.path) {
        case ("/createUser"):
            let createUserData = CommonUser.serializeNewUserData(userData);
            callback(null, await HttpResponse.createUserHttpResponse(createUserData));
            break;
        case ("/getGame"):
            let payload = {
                gameID: event === null || event === void 0 ? void 0 : event.queryStringParameters["gameID"]
            };
            let getGameData = Common.serializeExistingGameData(userData, payload);
            callback(null, await HttpResponse.getGameHttpResponse(getGameData));
            break;
        case ("/listGames"):
            let listGameData = userData;
            callback(null, await HttpResponse.listGamesHttpResponse(listGameData));
            break;
        case ("/createGame"):
            let createGameData = Common.serializeNewGameData(userData, JSON.parse(event.body));
            callback(null, await HttpResponse.createGameHttpResponse(createGameData));
            break;
        case ("/modifyGame"):
            let modifyGameData = Common.serializeExistingGameData(userData, JSON.parse(event.body));
            callback(null, await HttpResponse.modifyGameHttpResponse(modifyGameData));
            break;
        case ("/deleteGame"):
            let deleteGameData = Common.serializeExistingGameData(userData, JSON.parse(event.body));
            callback(null, await HttpResponse.deleteGameHttpResponse(deleteGameData));
            break;
        case ("/collection/wishlist/"):
            let wishlistID = event === null || event === void 0 ? void 0 : event.queryStringParameters["collectionID"];
            let wishlist = new wishlist_1.Wishlist(userData.userID, wishlistID);
            callback(null, await HttpResponse.getWishlistHttpResponse(wishlist));
            break;
        case ("/collection/wishlist/createWishlist"):
            let createWishlistData = CommonCollection.serializeNewWishlist(userData);
            callback(null, await HttpResponse.createWishlistHttpResponse(createWishlistData));
        case ("/collection/wishlist/addGame"):
            let addGameData = Common.serializeNewGameData(userData, JSON.parse(event.body));
            callback(null, await HttpResponse.addGameToWishlistHttpResponse(addGameData));
            break;
        case ("/collection/wishlist/modifyGame"):
            let modifyWishlistData = Common.serializeExistingGameData(userData, JSON.parse(event.body));
            callback(null, await HttpResponse.modifyGameInWishlistHttpResponse(modifyWishlistData));
            break;
        case ("/collection/wishlist/removeGame"):
            let removeGameData = Common.serializeExistingGameData(userData, JSON.parse(event.body));
            callback(null, await HttpResponse.removeGameFromWishlistHttpResponse(removeGameData));
            break;
        case ("/collection/wishlist/addPriceMonitor"):
            let addPriceMonitor = CommonPriceMonitor.serializeNewGamePriceMonitorData(userData, JSON.parse(event.body));
            callback(null, await HttpResponse.addPriceMonitorToWishlistHttpResponse(addPriceMonitor));
            break;
        case ("/collection/wishlist/modifyPriceMonitor"):
            let modifyPriceMonitor = CommonPriceMonitor.serializeExistingGamePriceMonitorData(userData, JSON.parse(event.body));
            callback(null, await HttpResponse.modifyPriceMonitorWishlistHttpResponse(modifyPriceMonitor));
            break;
        case ("/collection/wishlist/deletePriceMonitor"):
            let deletePriceMonitor = CommonPriceMonitor.serializeExistingGamePriceMonitorData(userData, JSON.parse(event.body));
            callback(null, await HttpResponse.deletePriceMonitorWishlistHttpResponse(deletePriceMonitor));
            break;
        default:
            callback(null, HttpResponse.httpResponse({ statusCode: 400, body: JSON.stringify("Invalid operation.") }));
            break;
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUNBLCtDQUErQztBQUMvQyx1RUFBdUU7QUFDdkUsbURBQW1EO0FBQ25ELCtEQUErRDtBQUMvRCw2REFBNkQ7QUFDN0QsZ0RBQTZDO0FBQzdDLGlEQUFpRDtBQUVqRCxPQUFPLENBQUMsT0FBTyxHQUFHLEtBQUssRUFBRSxLQUFVLEVBQUUsT0FBWSxFQUFFLFFBQWEsRUFBRSxFQUFFO0lBQ2xFLElBQUksUUFBUSxHQUF5QjtRQUNuQyxNQUFNLEVBQUUsS0FBSyxLQUFLLENBQUMsY0FBYyxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsa0JBQWtCLENBQUMsRUFBRTtRQUN6RSxLQUFLLEVBQUUsS0FBSyxDQUFDLGNBQWMsQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQztLQUN2RCxDQUFDO0lBQ0YsTUFBTSxVQUFVLEdBQUc7UUFDWCxTQUFTLEVBQUUsTUFBTSxDQUFDLEtBQUs7S0FDMUIsQ0FBQTtJQUNMLFFBQVEsS0FBSyxDQUFDLElBQUksRUFBRTtRQUNsQixLQUFLLENBQUMsYUFBYSxDQUFDO1lBQ2xCLElBQUksY0FBYyxHQUFHLFVBQVUsQ0FBQyxvQkFBb0IsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUMvRCxRQUFRLENBQUMsSUFBSSxFQUFFLE1BQU0sWUFBWSxDQUFDLHNCQUFzQixDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUM7WUFDMUUsTUFBTTtRQUNSLEtBQUssQ0FBQyxVQUFVLENBQUM7WUFDZixJQUFJLE9BQU8sR0FBNEI7Z0JBQ3JDLE1BQU0sRUFBRSxLQUFLLGFBQUwsS0FBSyx1QkFBTCxLQUFLLENBQUUscUJBQXFCLENBQUMsUUFBUSxDQUFDO2FBQy9DLENBQUM7WUFDRixJQUFJLFdBQVcsR0FBRyxNQUFNLENBQUMseUJBQXlCLENBQUMsUUFBUSxFQUFFLE9BQU8sQ0FBQyxDQUFBO1lBQ3JFLFFBQVEsQ0FB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QyxDQUFDLENBQUM7WUFDekcsTUFBTTtLQUNQO0FBQ0wsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgSW50ZXJmYWNlcyBmcm9tIFwiLi9zaGFyZWQvaW50ZXJmYWNlcy9pbnRlcmZhY2VzXCJcbmltcG9ydCAqIGFzIENvbW1vbiBmcm9tIFwiLi9zaGFyZWQvY29tbW9uL2dhbWVcIjtcbmltcG9ydCAqIGFzIENvbW1vblByaWNlTW9uaXRvciBmcm9tIFwiLi9zaGFyZWQvY29tbW9uL2dhbWVQcmljZU1vbml0b3JcIjtcbmltcG9ydCAqIGFzIENvbW1vblVzZXIgZnJvbSBcIi4vc2hhcmVkL2NvbW1vbi91c2VyXCI7XG5pbXBvcnQgKiBhcyBDb21tb25Db2xsZWN0aW9uIGZyb20gXCIuL3NoYXJlZC9jb21tb24vY29sbGVjdGlvblwiO1xuaW1wb3J0ICogYXMgSHR0cFJlc3BvbnNlIGZyb20gXCIuL3NoYXJlZC9jb21tb24vaHR0cFJlc3BvbnNlXCI7XG5pbXBvcnQgeyBXaXNobGlzdCB9IGZyb20gXCIuL21vZGVscy93aXNobGlzdFwiO1xuaW1wb3J0ICogYXMgQ29uZmlnIGZyb20gXCIuL3NoYXJlZC9jb25maWcvY29uZmlnXCI7XG5cbmV4cG9ydHMuaGFuZGxlciA9IGFzeW5jIChldmVudDogYW55LCBjb250ZXh0OiBhbnksIGNhbGxiYWNrOiBhbnkpID0+IHtcbiAgbGV0IHVzZXJEYXRhOiBJbnRlcmZhY2VzLklVc2VyRGF0YSA9IHtcbiAgICB1c2VySUQ6IGBVLSR7ZXZlbnQucmVxdWVzdENvbnRleHQuYXV0aG9yaXplci5jbGFpbXNbJ2NvZ25pdG86dXNlcm5hbWUnXX1gLFxuICAgIGVtYWlsOiBldmVudC5yZXF1ZXN0Q29udGV4dC5hdXRob3JpemVyLmNsYWltc1snZW1haWwnXVxuICB9O1xuICBjb25zdCBzYXZlUGFyYW1zID0ge1xuICAgICAgICAgIFRhYmxlTmFtZTogQ29uZmlnLnRhYmxlXG4gICAgICB9XG4gIHN3aXRjaCAoZXZlbnQucGF0aCkge1xuICAgIGNhc2UgKFwiL2NyZWF0ZVVzZXJcIik6XG4gICAgICBsZXQgY3JlYXRlVXNlckRhdGEgPSBDb21tb25Vc2VyLnNlcmlhbGl6ZU5ld1VzZXJEYXRhKHVzZXJEYXRhKTtcbiAgICAgIGNhbGxiYWNrKG51bGwsIGF3YWl0IEh0dHBSZXNwb25zZS5jcmVhdGVVc2VySHR0cFJlc3BvbnNlKGNyZWF0ZVVzZXJEYXRhKSk7XG4gICAgICBicmVhaztcbiAgICBjYXNlIChcIi9nZXRHYW1lXCIpOlxuICAgICAgbGV0IHBheWxvYWQ6IEludGVyZmFjZXMuSVBheWxvYWREYXRhID0geyBcbiAgICAgICAgZ2FtZUlEOiBldmVudD8ucXVlcnlTdHJpbmdQYXJhbWV0ZXJzW1wiZ2FtZUlEXCJdXG4gICAgICB9O1xuICAgICAgbGV0IGdldEdhbWVEYXRhID0gQ29tbW9uLnNlcmlhbGl6ZUV4aXN0aW5nR2FtZURhdGEodXNlckRhdGEsIHBheWxvYWQpXG4gICAgICBjYWxsYmFjayhudWxsLCBhd2FpdCBIdHRwUmVzcG9uc2UuZ2V0R2FtZUh0dHBSZXNwb25zZShnZXRHYW1lRGF0YSkpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZShcIi9saXN0R2FtZXNcIik6XG4gICAgICBsZXQgbGlzdEdhbWVEYXRhID0gdXNlckRhdGE7XG4gICAgICBjYWxsYmFjayhudWxsLCBhd2FpdCBIdHRwUmVzcG9uc2UubGlzdEdhbWVzSHR0cFJlc3BvbnNlKGxpc3RHYW1lRGF0YSkpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZShcIi9jcmVhdGVHYW1lXCIpOlxuICAgICAgbGV0IGNyZWF0ZUdhbWVEYXRhID0gQ29tbW9uLnNlcmlhbGl6ZU5ld0dhbWVEYXRhKHVzZXJEYXRhLCBKU09OLnBhcnNlKGV2ZW50LmJvZHkpKTtcbiAgICAgIGNhbGxiYWNrKG51bGwsIGF3YWl0IEh0dHBSZXNwb25zZS5jcmVhdGVHYW1lSHR0cFJlc3BvbnNlKGNyZWF0ZUdhbWVEYXRhKSk7XG4gICAgICBicmVhaztcbiAgICBjYXNlKFwiL21vZGlmeUdhbWVcIik6XG4gICAgICBsZXQgbW9kaWZ5R2FtZURhdGEgPSBDb21tb24uc2VyaWFsaXplRXhpc3RpbmdHYW1lRGF0YSh1c2VyRGF0YSwgSlNPTi5wYXJzZShldmVudC5ib2R5KSk7XG4gICAgICBjYWxsYmFjayhudWxsLCBhd2FpdCBIdHRwUmVzcG9uc2UubW9kaWZ5R2FtZUh0dHBSZXNwb25zZShtb2RpZnlHYW1lRGF0YSkpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAoXCIvZGVsZXRlR2FtZVwiKTpcbiAgICAgIGxldCBkZWxldGVHYW1lRGF0YSA9IENvbW1vbi5zZXJpYWxpemVFeGlzdGluZ0dhbWVEYXRhKHVzZXJEYXRhLCBKU09OLnBhcnNlKGV2ZW50LmJvZHkpKTtcbiAgICAgIGNhbGxiYWNrKG51bGwsIGF3YWl0IEh0dHBSZXNwb25zZS5kZWxldGVHYW1lSHR0cFJlc3BvbnNlKGRlbGV0ZUdhbWVEYXRhKSk7XG4gICAgICBicmVhaztcbiAgICBjYXNlIChcIi9jb2xsZWN0aW9uL3dpc2hsaXN0L1wiKTpcbiAgICAgIGxldCB3aXNobGlzdElEID0gZXZlbnQ/LnF1ZXJ5U3RyaW5nUGFyYW1ldGVyc1tcImNvbGxlY3Rpb25JRFwiXVxuICAgICAgbGV0IHdpc2hsaXN0ID0gbmV3IFdpc2hsaXN0KHVzZXJEYXRhLnVzZXJJRCwgd2lzaGxpc3RJRCk7XG4gICAgICBjYWxsYmFjayhudWxsLCBhd2FpdCBIdHRwUmVzcG9uc2UuZ2V0V2lzaGxpc3RIdHRwUmVzcG9uc2Uod2lzaGxpc3QpKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgKFwiL2NvbGxlY3Rpb24vd2lzaGxpc3QvY3JlYXRlV2lzaGxpc3RcIik6XG4gICAgICBsZXQgY3JlYXRlV2lzaGxpc3REYXRhID0gQ29tbW9uQ29sbGVjdGlvbi5zZXJpYWxpemVOZXdXaXNobGlzdCh1c2VyRGF0YSk7XG4gICAgICBjYWxsYmFjayhudWxsLCBhd2FpdCBIdHRwUmVzcG9uc2UuY3JlYXRlV2lzaGxpc3RIdHRwUmVzcG9uc2UoY3JlYXRlV2lzaGxpc3REYXRhKSk7ICAgICAgXG4gICAgY2FzZSAoXCIvY29sbGVjdGlvbi93aXNobGlzdC9hZGRHYW1lXCIpOlxuICAgICAgbGV0IGFkZEdhbWVEYXRhID0gQ29tbW9uLnNlcmlhbGl6ZU5ld0dhbWVEYXRhKHVzZXJEYXRhLCBKU09OLnBhcnNlKGV2ZW50LmJvZHkpKTtcbiAgICAgIGNhbGxiYWNrKG51bGwsIGF3YWl0IEh0dHBSZXNwb25zZS5hZGRHYW1lVG9XaXNobGlzdEh0dHBSZXNwb25zZShhZGRHYW1lRGF0YSkpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAoXCIvY29sbGVjdGlvbi93aXNobGlzdC9tb2RpZnlHYW1lXCIpOlxuICAgICAgbGV0IG1vZGlmeVdpc2hsaXN0RGF0YSA9IENvbW1vbi5zZXJpYWxpemVFeGlzdGluZ0dhbWVEYXRhKHVzZXJEYXRhLCBKU09OLnBhcnNlKGV2ZW50LmJvZHkpKTtcbiAgICAgIGNhbGxiYWNrKG51bGwsIGF3YWl0IEh0dHBSZXNwb25zZS5tb2RpZnlHYW1lSW5XaXNobGlzdEh0dHBSZXNwb25zZShtb2RpZnlXaXNobGlzdERhdGEpKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgKFwiL2NvbGxlY3Rpb24vd2lzaGxpc3QvcmVtb3ZlR2FtZVwiKTpcbiAgICAgIGxldCByZW1vdmVHYW1lRGF0YSA9IENvbW1vbi5zZXJpYWxpemVFeGlzdGluZ0dhbWVEYXRhKHVzZXJEYXRhLCBKU09OLnBhcnNlKGV2ZW50LmJvZHkpKTtcbiAgICAgIGNhbGxiYWNrKG51bGwsIGF3YWl0IEh0dHBSZXNwb25zZS5yZW1vdmVHYW1lRnJvbVdpc2hsaXN0SHR0cFJlc3BvbnNlKHJlbW92ZUdhbWVEYXRhKSk7XG4gICAgICBicmVhaztcbiAgICBjYXNlIChcIi9jb2xsZWN0aW9uL3dpc2hsaXN0L2FkZFByaWNlTW9uaXRvclwiKTpcbiAgICAgIGxldCBhZGRQcmljZU1vbml0b3IgPSBDb21tb25QcmljZU1vbml0b3Iuc2VyaWFsaXplTmV3R2FtZVByaWNlTW9uaXRvckRhdGEodXNlckRhdGEsIEpTT04ucGFyc2UoZXZlbnQuYm9keSkpO1xuICAgICAgY2FsbGJhY2sobnVsbCwgYXdhaXQgSHR0cFJlc3BvbnNlLmFkZFByaWNlTW9uaXRvclRvV2lzaGxpc3RIdHRwUmVzcG9uc2UoYWRkUHJpY2VNb25pdG9yKSk7XG4gICAgICBicmVhaztcbiAgICBjYXNlIChcIi9jb2xsZWN0aW9uL3dpc2hsaXN0L21vZGlmeVByaWNlTW9uaXRvclwiKTpcbiAgICAgIGxldCBtb2RpZnlQcmljZU1vbml0b3IgPSBDb21tb25QcmljZU1vbml0b3Iuc2VyaWFsaXplRXhpc3RpbmdHYW1lUHJpY2VNb25pdG9yRGF0YSh1c2VyRGF0YSwgSlNPTi5wYXJzZShldmVudC5ib2R5KSk7XG4gICAgICBjYWxsYmFjayhudWxsLCBhd2FpdCBIdHRwUmVzcG9uc2UubW9kaWZ5UHJpY2VNb25pdG9yV2lzaGxpc3RIdHRwUmVzcG9uc2UobW9kaWZ5UHJpY2VNb25pdG9yKSk7XG4gICAgICBicmVhazsgICAgICBcbiAgICBjYXNlIChcIi9jb2xsZWN0aW9uL3dpc2hsaXN0L2RlbGV0ZVByaWNlTW9uaXRvclwiKTpcbiAgICAgIGxldCBkZWxldGVQcmljZU1vbml0b3IgPSBDb21tb25QcmljZU1vbml0b3Iuc2VyaWFsaXplRXhpc3RpbmdHYW1lUHJpY2VNb25pdG9yRGF0YSh1c2VyRGF0YSwgSlNPTi5wYXJzZShldmVudC5ib2R5KSk7XG4gICAgICBjYWxsYmFjayhudWxsLCBhd2FpdCBIdHRwUmVzcG9uc2UuZGVsZXRlUHJpY2VNb25pdG9yV2lzaGxpc3RIdHRwUmVzcG9uc2UoZGVsZXRlUHJpY2VNb25pdG9yKSk7XG4gICAgICBicmVhazsgICAgICAgIFxuICAgIGRlZmF1bHQ6XG4gICAgICBjYWxsYmFjayhudWxsLCBIdHRwUmVzcG9uc2UuaHR0cFJlc3BvbnNlKHtzdGF0dXNDb2RlOiA0MDAsIGJvZHk6IEpTT04uc3RyaW5naWZ5KFwiSW52YWxpZCBvcGVyYXRpb24uXCIpfSkpO1xuICAgICAgYnJlYWs7XG4gICAgfVxufSAgXG4iXX0=