"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.deserializeCollectionData = exports.deserializeGameData = exports.httpResponse = exports.removeGameFromWishlist = exports.modifyGameInWishlist = exports.addGameToWishlist = exports.getWishlistHttpResponse = exports.deleteGameHttpResponse = exports.modifyGameHttpResponse = exports.createGameHttpResponse = exports.listGamesHttpResponse = exports.getGameHttpResponse = void 0;
const AWS = require('aws-sdk');
const game_1 = require("./models/game");
const gameManager_1 = require("./dataManger/gameManager");
const wishlist_1 = require("./models/wishlist");
const collectionManager_1 = require("./dataManger/collectionManager");
exports.handler = async (event, context, callback) => {
    const userID = event.requestContext.authorizer.claims['cognito:username'];
    switch (event.path) {
        case ("/getGame"):
            let gameName = { gameName: event.queryStringParameters["gameName"] };
            let getGameData = deserializeGameData(userID, gameName);
            callback(null, await getGameHttpResponse(getGameData));
            break;
        case ("/listGames"):
            let listGameData = userID;
            callback(null, await listGamesHttpResponse(listGameData));
            break;
        case ("/createGame"):
            let createGameData = deserializeGameData(userID, JSON.parse(event.body));
            callback(null, await createGameHttpResponse(createGameData));
            break;
        case ("/modifyGame"):
            let modifyGameData = deserializeGameData(userID, JSON.parse(event.body));
            callback(null, await modifyGameHttpResponse(modifyGameData));
            break;
        case ("/deleteGame"):
            let deleteGameData = deserializeGameData(userID, JSON.parse(event.body));
            callback(null, await deleteGameHttpResponse(deleteGameData));
            break;
        case ("/collection/wishlist/"):
            callback(null, await getWishlistHttpResponse(userID));
            break;
        case ("/collection/wishlist/addGame"):
            let addGameData = deserializeCollectionData(userID, JSON.parse(event.body), 'Wishlist');
            callback(null, await addGameToWishlist(addGameData, userID));
            break;
        case ("/collection/wishlist/modifyGame"):
            let modifyWishlistData = deserializeCollectionData(userID, JSON.parse(event.body), 'Wishlist');
            callback(null, await modifyGameInWishlist(modifyWishlistData, userID));
            break;
        case ("/collection/wishlist/removeGame"):
            let removeGameData = deserializeCollectionData(userID, JSON.parse(event.body), 'Wishlist');
            callback(null, await removeGameFromWishlist(removeGameData, userID));
            break;
        default:
            callback(null, httpResponse({ statusCode: 400, body: JSON.stringify("Invalid operation.") }));
            break;
    }
};
async function getGameHttpResponse(game) {
    try {
        let response = await (0, gameManager_1.getGame)(game);
        return httpResponse({ statusCode: 200, body: JSON.stringify(response) });
    }
    catch (err) {
        return httpResponse({ statusCode: err.statusCode, body: err.message });
    }
}
exports.getGameHttpResponse = getGameHttpResponse;
async function listGamesHttpResponse(userID) {
    try {
        let response = await (0, gameManager_1.listGames)(userID);
        return httpResponse({ statusCode: 200, body: JSON.stringify(response) });
    }
    catch (err) {
        return httpResponse({ statusCode: err.statusCode, body: err.message });
    }
}
exports.listGamesHttpResponse = listGamesHttpResponse;
async function createGameHttpResponse(game) {
    try {
        let response = await (0, gameManager_1.createGame)(game);
        return httpResponse({ statusCode: 200, body: JSON.stringify(response) });
    }
    catch (err) {
        return httpResponse({ statusCode: err.statusCode, body: err.message });
    }
}
exports.createGameHttpResponse = createGameHttpResponse;
async function modifyGameHttpResponse(game) {
    try {
        let response = await (0, gameManager_1.modifyGame)(game);
        return httpResponse({ statusCode: 200, body: JSON.stringify(response) });
    }
    catch (err) {
        return httpResponse({ statusCode: err.statusCode, body: err.message });
    }
}
exports.modifyGameHttpResponse = modifyGameHttpResponse;
async function deleteGameHttpResponse(game) {
    try {
        let response = await (0, gameManager_1.deleteGame)(game);
        return httpResponse({ statusCode: 200, body: JSON.stringify(response) });
    }
    catch (err) {
        return httpResponse({ statusCode: err.statusCode, body: err.message });
    }
}
exports.deleteGameHttpResponse = deleteGameHttpResponse;
async function getWishlistHttpResponse(userID) {
    try {
        let wishlist = new wishlist_1.Wishlist(userID);
        let response = await (0, collectionManager_1.getCollection)(wishlist);
        return httpResponse({ statusCode: 200, body: JSON.stringify(response) });
    }
    catch (err) {
        return httpResponse({ statusCode: err.statusCode, body: err.message });
    }
}
exports.getWishlistHttpResponse = getWishlistHttpResponse;
async function addGameToWishlist(game, userID) {
    try {
        let wishlist = new wishlist_1.Wishlist(userID);
        let response = await (0, collectionManager_1.addGameToCollection)(game, wishlist);
        return httpResponse({ statusCode: 200, body: JSON.stringify(response) });
    }
    catch (err) {
        return httpResponse({ statusCode: err.statusCode, body: err.message });
    }
}
exports.addGameToWishlist = addGameToWishlist;
async function modifyGameInWishlist(game, userID) {
    try {
        let wishlist = new wishlist_1.Wishlist(userID);
        let response = await (0, collectionManager_1.modifyGameInCollection)(game, wishlist);
        return httpResponse({ statusCode: 200, body: JSON.stringify(response) });
    }
    catch (err) {
        return httpResponse({ statusCode: err.statusCode, body: err.message });
    }
}
exports.modifyGameInWishlist = modifyGameInWishlist;
async function removeGameFromWishlist(game, userID) {
    try {
        let wishlist = new wishlist_1.Wishlist(userID);
        let response = await (0, collectionManager_1.removeGameFromCollection)(game, wishlist);
        return httpResponse({ statusCode: 200, body: JSON.stringify(response) });
    }
    catch (err) {
        return httpResponse({ statusCode: err.statusCode, body: err.message });
    }
}
exports.removeGameFromWishlist = removeGameFromWishlist;
function httpResponse(data) {
    return {
        statusCode: data.statusCode,
        body: data.body,
        headers: {
            'Access-Control-Allow-Origin': '*'
        }
    };
}
exports.httpResponse = httpResponse;
function deserializeGameData(userID, data) {
    let sortKey = `[GameItem]#[${data.gameName}]`;
    return new game_1.Game(userID, sortKey, data.gameName, data === null || data === void 0 ? void 0 : data.yearReleased, data === null || data === void 0 ? void 0 : data.genre, data === null || data === void 0 ? void 0 : data.console, data === null || data === void 0 ? void 0 : data.developer);
}
exports.deserializeGameData = deserializeGameData;
function deserializeCollectionData(userID, data, collectionType) {
    let sortKey = `[CollectionItem]#[${collectionType}]#[GameItem]#[${data.gameName}]`;
    return new game_1.Game(userID, sortKey, data.gameName, data === null || data === void 0 ? void 0 : data.yearReleased, data === null || data === void 0 ? void 0 : data.genre, data === null || data === void 0 ? void 0 : data.console, data === null || data === void 0 ? void 0 : data.developer, data === null || data === void 0 ? void 0 : data.desiredCondition, data === null || data === void 0 ? void 0 : data.desiredPrice);
}
exports.deserializeCollectionData = deserializeCollectionData;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSxNQUFNLEdBQUcsR0FBRyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7QUFDL0Isd0NBQW9DO0FBQ3BDLDBEQUFrRztBQUNsRyxnREFBNkM7QUFDN0Msc0VBQXNJO0FBR3RJLE9BQU8sQ0FBQyxPQUFPLEdBQUcsS0FBSyxFQUFFLEtBQVUsRUFBRSxPQUFZLEVBQUUsUUFBYSxFQUFFLEVBQUU7SUFDbEUsTUFBTSxNQUFNLEdBQUcsS0FBSyxDQUFDLGNBQWMsQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLGtCQUFrQixDQUFDLENBQUM7SUFDMUUsUUFBUSxLQUFLLENBQUMsSUFBSSxFQUFFO1FBQ2xCLEtBQUssQ0FBQyxVQUFVLENBQUM7WUFDZixJQUFJLFFBQVEsR0FBRyxFQUFFLFFBQVEsRUFBRSxLQUFLLENBQUMscUJBQXFCLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQztZQUNyRSxJQUFJLFdBQVcsR0FBRyxtQkFBbUIsQ0FBQyxNQUFNLEVBQUUsUUFBUSxDQUFDLENBQUE7WUFDdkQsUUFBUSxDQUFDLElBQUksRUFBRSxNQUFNLG1CQUFtQixDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUM7WUFDdkQsTUFBTTtRQUNSLEtBQUksQ0FBQyxZQUFZLENBQUM7WUFDaEIsSUFBSSxZQUFZLEdBQUcsTUFBTSxDQUFDO1lBQzFCLFFBQVEsQ0FBQyxJQUFJLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO1lBQzFELE1BQU07UUFDUixLQUFJLENBQUMsYUFBYSxDQUFDO1lBQ2pCLElBQUksY0FBYyxHQUFHLG1CQUFtQixDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQ3pFLFFBQVEsQ0FBQyxJQUFJLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQyxj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RSxPQUFPLEVBQUUsSUFBSSxDQUFDLFFBQVEsRUFBRSxJQUFJLGFBQUosSUFBSSx1QkFBSixJQUFJLENBQUUsWUFBWSxFQUFFLElBQUksYUFBSixJQUFJLHVCQUFKLElBQUksQ0FBRSxLQUFLLEVBQUUsSUFBSSxhQUFKLElBQUksdUJBQUosSUFBSSxDQUFFLE9BQU8sRUFBRSxJQUFJLGFBQUosSUFBSSx1QkFBSixJQUFJLENBQUUsU0FBUyxFQUFFLElBQUksYUFBSixJQUFJLHVCQUFKLElBQUksQ0FBRSxnQkFBZ0IsRUFBRSxJQUFJLGFBQUosSUFBSSx1QkFBSixJQUFJLENBQUUsWUFBWSxDQUFDLENBQUM7QUFDL0osQ0FBQztBQUhELDhEQUdDIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgQVdTID0gcmVxdWlyZSgnYXdzLXNkaycpO1xyXG5pbXBvcnQgeyBHYW1lIH0gZnJvbSBcIi4vbW9kZWxzL2dhbWVcIlxyXG5pbXBvcnQgeyBnZXRHYW1lLCBsaXN0R2FtZXMsIGRlbGV0ZUdhbWUsIG1vZGlmeUdhbWUsIGNyZWF0ZUdhbWUgfSBmcm9tIFwiLi9kYXRhTWFuZ2VyL2dhbWVNYW5hZ2VyXCI7XHJcbmltcG9ydCB7IFdpc2hsaXN0IH0gZnJvbSBcIi4vbW9kZWxzL3dpc2hsaXN0XCI7XHJcbmltcG9ydCB7IGdldENvbGxlY3Rpb24sIGFkZEdhbWVUb0NvbGxlY3Rpb24sIG1vZGlmeUdhbWVJbkNvbGxlY3Rpb24sIHJlbW92ZUdhbWVGcm9tQ29sbGVjdGlvbiB9IGZyb20gXCIuL2RhdGFNYW5nZXIvY29sbGVjdGlvbk1hbmFnZXJcIjtcclxuaW1wb3J0ICogYXMgSW50ZXJmYWNlcyBmcm9tIFwiLi9pbnRlcmZhY2VzL2ludGVyZmFjZXNcIlxyXG5cclxuZXhwb3J0cy5oYW5kbGVyID0gYXN5bmMgKGV2ZW50OiBhbnksIGNvbnRleHQ6IGFueSwgY2FsbGJhY2s6IGFueSkgPT4ge1xyXG4gIGNvbnN0IHVzZXJJRCA9IGV2ZW50LnJlcXVlc3RDb250ZXh0LmF1dGhvcml6ZXIuY2xhaW1zWydjb2duaXRvOnVzZXJuYW1lJ107XHJcbiAgc3dpdGNoIChldmVudC5wYXRoKSB7XHJcbiAgICBjYXNlIChcIi9nZXRHYW1lXCIpOlxyXG4gICAgICBsZXQgZ2FtZU5hbWUgPSB7IGdhbWVOYW1lOiBldmVudC5xdWVyeVN0cmluZ1BhcmFtZXRlcnNbXCJnYW1lTmFtZVwiXSB9O1xyXG4gICAgICBsZXQgZ2V0R2FtZURhdGEgPSBkZXNlcmlhbGl6ZUdhbWVEYXRhKHVzZXJJRCwgZ2FtZU5hbWUpXHJcbiAgICAgIGNhbGxiYWNrKG51bGwsIGF3YWl0IGdldEdhbWVIdHRwUmVzcG9uc2UoZ2V0R2FtZURhdGEpKTtcclxuICAgICAgYnJlYWs7XHJcbiAgICBjYXNlKFwiL2xpc3RHYW1lc1wiKTpcclxuICAgICAgbGV0IGxpc3RHYW1lRGF0YSA9IHVzZXJJRDtcclxuICAgICAgY2FsbGJhY2sobnVsbCwgYXdhaXQgbGlzdEdhbWVzSHR0cFJlc3BvbnNlKGxpc3RHYW1lRGF0YSkpO1xyXG4gICAgICBicmVhaztcclxuICAgIGNhc2UoXCIvY3JlYXRlR2FtZVwiKTpcclxuICAgICAgbGV0IGNyZWF0ZUdhbWVEYXRhID0gZGVzZXJpYWxpemVHYW1lRGF0YSh1c2VySUQsIEpTT04ucGFyc2UoZXZlbnQuYm9keSkpO1xyXG4gICAgICBjYWxsYmFjayhudWxsLCBhd2FpdCBjcmVhdGVHYW1lSHR0cFJlc3BvbnNlKGNyZWF0ZUdhbWVEYXRhKSk7XHJcbiAgICAgIGJyZWFrO1xyXG4gICAgY2FzZShcIi9tb2RpZnlHYW1lXCIpOlxyXG4gICAgICBsZXQgbW9kaWZ5R2FtZURhdGEgPSBkZXNlcmlhbGl6ZUdhbWVEYXRhKHVzZXJJRCwgSlNPTi5wYXJzZShldmVudC5ib2R5KSk7XHJcbiAgICAgIGNhbGxiYWNrKG51bGwsIGF3YWl0IG1vZGlmeUdhbWVIdHRwUmVzcG9uc2UobW9kaWZ5R2FtZURhdGEpKTtcclxuICAgICAgYnJlYWs7XHJcbiAgICBjYXNlIChcIi9kZWxldGVHYW1lXCIpOlxyXG4gICAgICBsZXQgZGVsZXRlR2FtZURhdGEgPSBkZXNlcmlhbGl6ZUdhbWVEYXRhKHVzZXJJRCwgSlNPTi5wYXJzZShldmVudC5ib2R5KSk7XHJcbiAgICAgIGNhbGxiYWNrKG51bGwsIGF3YWl0IGRlbGV0ZUdhbWVIdHRwUmVzcG9uc2UoZGVsZXRlR2FtZURhdGEpKTtcclxuICAgICAgYnJlYWs7XHJcbiAgICBjYXNlIChcIi9jb2xsZWN0aW9uL3dpc2hsaXN0L1wiKTpcclxuICAgICAgY2FsbGJhY2sobnVsbCwgYXdhaXQgZ2V0V2lzaGxpc3RIdHRwUmVzcG9uc2UodXNlcklEKSk7XHJcbiAgICAgIGJyZWFrO1xyXG4gICAgY2FzZSAoXCIvY29sbGVjdGlvbi93aXNobGlzdC9hZGRHYW1lXCIpOlxyXG4gICAgICBsZXQgYWRkR2FtZURhdGEgPSBkZXNlcmlhbGl6ZUNvbGxlY3Rpb25EYXRhKHVzZXJJRCwgSlNPTi5wYXJzZShldmVudC5ib2R5KSwgJ1dpc2hsaXN0Jyk7XHJcbiAgICAgIGNhbGxiYWNrKG51bGwsIGF3YWl0IGFkZEdhbWVUb1dpc2hsaXN0KGFkZEdhbWVEYXRhLCB1c2VySUQpKTtcclxuICAgICAgYnJlYWs7XHJcbiAgICBjYXNlIChcIi9jb2xsZWN0aW9uL3dpc2hsaXN0L21vZGlmeUdhbWVcIik6XHJcbiAgICAgIGxldCBtb2RpZnlXaXNobGlzdERhdGEgPSBkZXNlcmlhbGl6ZUNvbGxlY3Rpb25EYXRhKHVzZXJJRCwgSlNPTi5wYXJzZShldmVudC5ib2R5KSwgJ1dpc2hsaXN0Jyk7XHJcbiAgICAgIGNhbGxiYWNrKG51bGwsIGF3YWl0IG1vZGlmeUdhbWVJbldpc2hsaXN0KG1vZGlmeVdpc2hsaXN0RGF0YSwgdXNlcklEKSk7XHJcbiAgICAgIGJyZWFrO1xyXG4gICAgY2FzZSAoXCIvY29sbGVjdGlvbi93aXNobGlzdC9yZW1vdmVHYW1lXCIpOlxyXG4gICAgICBsZXQgcmVtb3ZlR2FtZURhdGEgPSBkZXNlcmlhbGl6ZUNvbGxlY3Rpb25EYXRhKHVzZXJJRCwgSlNPTi5wYXJzZShldmVudC5ib2R5KSwgJ1dpc2hsaXN0Jyk7XHJcbiAgICAgIGNhbGxiYWNrKG51bGwsIGF3YWl0IHJlbW92ZUdhbWVGcm9tV2lzaGxpc3QocmVtb3ZlR2FtZURhdGEsIHVzZXJJRCkpO1xyXG4gICAgICBicmVhaztcclxuICAgIGRlZmF1bHQ6XHJcbiAgICAgIGNhbGxiYWNrKG51bGwsIGh0dHBSZXNwb25zZSh7c3RhdHVzQ29kZTogNDAwLCBib2R5OiBKU09OLnN0cmluZ2lmeShcIkludmFsaWQgb3BlcmF0aW9uLlwiKX0pKTtcclxuICAgICAgYnJlYWs7XHJcbiAgICB9XHJcbn0gIFxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEdhbWVIdHRwUmVzcG9uc2UoZ2FtZTogR2FtZSkge1xyXG4gIHRyeSB7XHJcbiAgICBsZXQgcmVzcG9uc2UgPSBhd2FpdCBnZXRHYW1lKGdhbWUpO1xyXG4gICAgcmV0dXJuIGh0dHBSZXNwb25zZSh7c3RhdHVzQ29kZTogMjAwLCBib2R5OiBKU09OLnN0cmluZ2lmeShyZXNwb25zZSl9KTtcclxuICB9IGNhdGNoIChlcnI6IGFueSkge1xyXG4gICAgcmV0dXJuIGh0dHBSZXNwb25zZSh7c3RhdHVzQ29kZTogZXJyLnN0YXR1c0NvZGUsIGJvZHk6IGVyci5tZXNzYWdlfSk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbGlzdEdhbWVzSHR0cFJlc3BvbnNlKHVzZXJJRDogc3RyaW5nKSB7XHJcbiAgdHJ5IHtcclxuICAgIGxldCByZXNwb25zZSA9IGF3YWl0IGxpc3RHYW1lcyh1c2VySUQpO1xyXG4gICAgcmV0dXJuIGh0dHBSZXNwb25zZSh7c3RhdHVzQ29kZTogMjAwLCBib2R5OiBKU09OLnN0cmluZ2lmeShyZXNwb25zZSl9KTtcclxuICB9IGNhdGNoIChlcnI6IGFueSkge1xyXG4gICAgcmV0dXJuIGh0dHBSZXNwb25zZSh7c3RhdHVzQ29kZTogZXJyLnN0YXR1c0NvZGUsIGJvZHk6IGVyci5tZXNzYWdlfSk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlR2FtZUh0dHBSZXNwb25zZShnYW1lOiBHYW1lKSB7XHJcbiAgdHJ5IHtcclxuICAgIGxldCByZXNwb25zZSA9IGF3YWl0IGNyZWF0ZUdhbWUoZ2FtZSk7XHJcbiAgICByZXR1cm4gaHR0cFJlc3BvbnNlKHtzdGF0dXNDb2RlOiAyMDAsIGJvZHk6IEpTT04uc3RyaW5naWZ5KHJlc3BvbnNlKX0pO1xyXG4gIH0gY2F0Y2ggKGVycjogYW55KSB7XHJcbiAgICByZXR1cm4gaHR0cFJlc3BvbnNlKHtzdGF0dXNDb2RlOiBlcnIuc3RhdHVzQ29kZSwgYm9keTogZXJyLm1lc3NhZ2V9KTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBtb2RpZnlHYW1lSHR0cFJlc3BvbnNlKGdhbWU6IEdhbWUpIHtcclxuICB0cnkge1xyXG4gICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgbW9kaWZ5R2FtZShnYW1lKTtcclxuICAgIHJldHVybiBodHRwUmVzcG9uc2Uoe3N0YXR1c0NvZGU6IDIwMCwgYm9keTogSlNPTi5zdHJpbmdpZnkocmVzcG9uc2UpfSk7XHJcbiAgfSBjYXRjaCAoZXJyOiBhbnkpIHtcclxuICAgIHJldHVybiBodHRwUmVzcG9uc2Uoe3N0YXR1c0NvZGU6IGVyci5zdGF0dXNDb2RlLCBib2R5OiBlcnIubWVzc2FnZX0pO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGRlbGV0ZUdhbWVIdHRwUmVzcG9uc2UoZ2FtZTogR2FtZSkge1xyXG4gIHRyeSB7XHJcbiAgICBsZXQgcmVzcG9uc2UgPSBhd2FpdCBkZWxldGVHYW1lKGdhbWUpO1xyXG4gICAgcmV0dXJuIGh0dHBSZXNwb25zZSh7c3RhdHVzQ29kZTogMjAwLCBib2R5OiBKU09OLnN0cmluZ2lmeShyZXNwb25zZSl9KTtcclxuICB9IGNhdGNoIChlcnI6IGFueSkge1xyXG4gICAgcmV0dXJuIGh0dHBSZXNwb25zZSh7c3RhdHVzQ29kZTogZXJyLnN0YXR1c0NvZGUsIGJvZHk6IGVyci5tZXNzYWdlfSk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0V2lzaGxpc3RIdHRwUmVzcG9uc2UodXNlcklEOiBzdHJpbmcpIHtcclxuICB0cnkge1xyXG4gICAgbGV0IHdpc2hsaXN0ID0gbmV3IFdpc2hsaXN0KHVzZXJJRCk7XHJcbiAgICBsZXQgcmVzcG9uc2UgPSBhd2FpdCBnZXRDb2xsZWN0aW9uKHdpc2hsaXN0KTtcclxuICAgIHJldHVybiBodHRwUmVzcG9uc2Uoe3N0YXR1c0NvZGU6IDIwMCwgYm9keTogSlNPTi5zdHJpbmdpZnkocmVzcG9uc2UpfSk7XHJcbiAgfSBjYXRjaCAoZXJyOiBhbnkpIHtcclxuICAgIHJldHVybiBodHRwUmVzcG9uc2Uoe3N0YXR1c0NvZGU6IGVyci5zdGF0dXNDb2RlLCBib2R5OiBlcnIubWVzc2FnZX0pO1xyXG4gIH1cclxufVxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYWRkR2FtZVRvV2lzaGxpc3QoZ2FtZTogR2FtZSwgdXNlcklEOiBzdHJpbmcpIHtcclxuICB0cnkge1xyXG4gICAgbGV0IHdpc2hsaXN0ID0gbmV3IFdpc2hsaXN0KHVzZXJJRCk7XHJcbiAgICBsZXQgcmVzcG9uc2UgPSBhd2FpdCBhZGRHYW1lVG9Db2xsZWN0aW9uKGdhbWUsIHdpc2hsaXN0KTtcclxuICAgIHJldHVybiBodHRwUmVzcG9uc2Uoe3N0YXR1c0NvZGU6IDIwMCwgYm9keTogSlNPTi5zdHJpbmdpZnkocmVzcG9uc2UpfSk7XHJcbiAgfSBjYXRjaCAoZXJyOiBhbnkpIHtcclxuICAgIHJldHVybiBodHRwUmVzcG9uc2Uoe3N0YXR1c0NvZGU6IGVyci5zdGF0dXNDb2RlLCBib2R5OiBlcnIubWVzc2FnZX0pO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIG1vZGlmeUdhbWVJbldpc2hsaXN0KGdhbWU6IEdhbWUsIHVzZXJJRDogc3RyaW5nKSB7XHJcbiAgdHJ5IHtcclxuICAgIGxldCB3aXNobGlzdCA9IG5ldyBXaXNobGlzdCh1c2VySUQpO1xyXG4gICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgbW9kaWZ5R2FtZUluQ29sbGVjdGlvbihnYW1lLCB3aXNobGlzdCk7XHJcbiAgICByZXR1cm4gaHR0cFJlc3BvbnNlKHtzdGF0dXNDb2RlOiAyMDAsIGJvZHk6IEpTT04uc3RyaW5naWZ5KHJlc3BvbnNlKX0pO1xyXG4gIH0gY2F0Y2ggKGVycjogYW55KSB7XHJcbiAgICByZXR1cm4gaHR0cFJlc3BvbnNlKHtzdGF0dXNDb2RlOiBlcnIuc3RhdHVzQ29kZSwgYm9keTogZXJyLm1lc3NhZ2V9KTtcclxuICB9XHJcbn1cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJlbW92ZUdhbWVGcm9tV2lzaGxpc3QoZ2FtZTogR2FtZSwgdXNlcklEOiBzdHJpbmcpIHtcclxuICB0cnkge1xyXG4gICAgbGV0IHdpc2hsaXN0ID0gbmV3IFdpc2hsaXN0KHVzZXJJRCk7ICAgIFxyXG4gICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgcmVtb3ZlR2FtZUZyb21Db2xsZWN0aW9uKGdhbWUsIHdpc2hsaXN0KTtcclxuICAgIHJldHVybiBodHRwUmVzcG9uc2Uoe3N0YXR1c0NvZGU6IDIwMCwgYm9keTogSlNPTi5zdHJpbmdpZnkocmVzcG9uc2UpfSk7XHJcbiAgfSBjYXRjaCAoZXJyOiBhbnkpIHtcclxuICAgIHJldHVybiBodHRwUmVzcG9uc2Uoe3N0YXR1c0NvZGU6IGVyci5zdGF0dXNDb2RlLCBib2R5OiBlcnIubWVzc2FnZX0pO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGh0dHBSZXNwb25zZShkYXRhOiBJbnRlcmZhY2VzLklIdHRwUmVzcG9uc2UpIDoge30ge1xyXG4gIHJldHVybiB7XHJcbiAgICBzdGF0dXNDb2RlOiBkYXRhLnN0YXR1c0NvZGUsXHJcbiAgICBib2R5OiBkYXRhLmJvZHksXHJcbiAgICBoZWFkZXJzOiB7XHJcbiAgICAgICdBY2Nlc3MtQ29udHJvbC1BbGxvdy1PcmlnaW4nOiAnKidcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBkZXNlcmlhbGl6ZUdhbWVEYXRhKHVzZXJJRDogc3RyaW5nLCBkYXRhOiBJbnRlcmZhY2VzLklKU09OUGF5bG9hZCkgOiBHYW1lIHtcclxuICBsZXQgc29ydEtleSA9IGBbR2FtZUl0ZW1dI1ske2RhdGEuZ2FtZU5hbWV9XWA7XHJcbiAgcmV0dXJuIG5ldyBHYW1lKHVzZXJJRCwgc29ydEtleSwgZGF0YS5nYW1lTmFtZSwgZGF0YT8ueWVhclJlbGVhc2VkLCBkYXRhPy5nZW5yZSwgZGF0YT8uY29uc29sZSwgZGF0YT8uZGV2ZWxvcGVyKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGRlc2VyaWFsaXplQ29sbGVjdGlvbkRhdGEodXNlcklEOiBzdHJpbmcsIGRhdGE6IEludGVyZmFjZXMuSUpTT05QYXlsb2FkLCBjb2xsZWN0aW9uVHlwZTogc3RyaW5nKSA6IEdhbWUge1xyXG4gIGxldCBzb3J0S2V5ID0gYFtDb2xsZWN0aW9uSXRlbV0jWyR7Y29sbGVjdGlvblR5cGV9XSNbR2FtZUl0ZW1dI1ske2RhdGEuZ2FtZU5hbWV9XWA7XHJcbiAgcmV0dXJuIG5ldyBHYW1lKHVzZXJJRCwgc29ydEtleSwgZGF0YS5nYW1lTmFtZSwgZGF0YT8ueWVhclJlbGVhc2VkLCBkYXRhPy5nZW5yZSwgZGF0YT8uY29uc29sZSwgZGF0YT8uZGV2ZWxvcGVyLCBkYXRhPy5kZXNpcmVkQ29uZGl0aW9uLCBkYXRhPy5kZXNpcmVkUHJpY2UpO1xyXG59Il19