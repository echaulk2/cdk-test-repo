"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.deserializeCollectionData = exports.deserializeGameData = exports.httpResponse = exports.removeGameFromWishlist = exports.addGameToWishlist = exports.getWishlistHttpResponse = exports.createWishListHttpResponse = exports.deleteGameHttpResponse = exports.modifyGameHttpResponse = exports.createGameHttpResponse = exports.listGamesHttpResponse = exports.getGameHttpResponse = void 0;
const AWS = require('aws-sdk');
const game_1 = require("./game");
const gameManager_1 = require("./gameManager");
const collection_1 = require("./collection");
const collectionManager_1 = require("./collectionManager");
exports.handler = async (event, context, callback) => {
    const userID = event.requestContext.authorizer.claims['cognito:username'];
    switch (event.path) {
        case ("/getGame"):
            let gameName = { gameName: event.queryStringParameters["gameName"] };
            let getGameData = deserializeGameData(userID, gameName);
            callback(null, await getGameHttpResponse(getGameData));
            break;
        case ("/listGames"):
            let listGameData = userID;
            callback(null, await listGamesHttpResponse(listGameData));
            break;
        case ("/createGame"):
            let createGameData = deserializeGameData(userID, JSON.parse(event.body));
            callback(null, await createGameHttpResponse(createGameData));
            break;
        case ("/modifyGame"):
            let modifyGameData = deserializeGameData(userID, JSON.parse(event.body));
            callback(null, await modifyGameHttpResponse(modifyGameData));
            break;
        case ("/deleteGame"):
            let deleteGameData = deserializeGameData(userID, JSON.parse(event.body));
            callback(null, await deleteGameHttpResponse(deleteGameData));
            break;
        case ("/collection/createWishlist"):
            let createWishlistData = deserializeCollectionData(userID, "wishlist");
            callback(null, await createWishListHttpResponse(createWishlistData));
            break;
        case ("/collection/getWishlist"):
            callback(null, await getWishlistHttpResponse(userID));
            break;
        case ("/wishlist/addGame"):
            let addGameData = deserializeGameData(userID, JSON.parse(event.body));
            callback(null, await addGameToWishlist(addGameData));
            break;
        case ("/wishlist/removeGame"):
            let removeGameData = deserializeGameData(userID, JSON.parse(event.body));
            callback(null, await removeGameFromWishlist(removeGameData));
            break;
        default:
            callback(null, httpResponse({ statusCode: 400, body: JSON.stringify("Invalid operation.") }));
            break;
    }
};
async function getGameHttpResponse(game) {
    try {
        let response = await (0, gameManager_1.getGame)(game);
        return httpResponse({ statusCode: 200, body: JSON.stringify(response) });
    }
    catch (err) {
        return httpResponse({ statusCode: err.statusCode, body: err.message });
    }
}
exports.getGameHttpResponse = getGameHttpResponse;
async function listGamesHttpResponse(userID) {
    try {
        let response = await (0, gameManager_1.listGames)(userID);
        return httpResponse({ statusCode: 200, body: JSON.stringify(response) });
    }
    catch (err) {
        return httpResponse({ statusCode: err.statusCode, body: err.message });
    }
}
exports.listGamesHttpResponse = listGamesHttpResponse;
async function createGameHttpResponse(game) {
    try {
        let response = await game.createGame();
        return httpResponse({ statusCode: 200, body: JSON.stringify(response) });
    }
    catch (err) {
        return httpResponse({ statusCode: err.statusCode, body: err.message });
    }
}
exports.createGameHttpResponse = createGameHttpResponse;
async function modifyGameHttpResponse(game) {
    try {
        let response = await (0, gameManager_1.modifyGame)(game);
        return httpResponse({ statusCode: 200, body: JSON.stringify(response) });
    }
    catch (err) {
        return httpResponse({ statusCode: err.statusCode, body: err.message });
    }
}
exports.modifyGameHttpResponse = modifyGameHttpResponse;
async function deleteGameHttpResponse(game) {
    try {
        let response = await (0, gameManager_1.deleteGame)(game);
        return httpResponse({ statusCode: 200, body: JSON.stringify(response) });
    }
    catch (err) {
        return httpResponse({ statusCode: err.statusCode, body: err.message });
    }
}
exports.deleteGameHttpResponse = deleteGameHttpResponse;
async function createWishListHttpResponse(wishList) {
    try {
        let response = await wishList.createCollection();
        return httpResponse({ statusCode: 200, body: JSON.stringify(response) });
    }
    catch (err) {
        return httpResponse({ statusCode: err.statusCode, body: err.message });
    }
}
exports.createWishListHttpResponse = createWishListHttpResponse;
async function getWishlistHttpResponse(userID) {
    try {
        let response = await (0, collectionManager_1.getCollection)(userID, "wishlist");
        return httpResponse({ statusCode: 200, body: JSON.stringify(response) });
    }
    catch (err) {
        return httpResponse({ statusCode: err.statusCode, body: err.message });
    }
}
exports.getWishlistHttpResponse = getWishlistHttpResponse;
async function addGameToWishlist(game) {
    try {
        let wishlist = await (0, collectionManager_1.getCollection)(game.userID, 'wishlist');
        let response = await (0, collectionManager_1.addGameToCollection)(game, wishlist);
        return httpResponse({ statusCode: 200, body: JSON.stringify(response) });
    }
    catch (err) {
        return httpResponse({ statusCode: err.statusCode, body: err.message });
    }
}
exports.addGameToWishlist = addGameToWishlist;
async function removeGameFromWishlist(game) {
    try {
        let wishlist = await (0, collectionManager_1.getCollection)(game.userID, 'wishlist');
        let response = await (0, collectionManager_1.removeGameFromCollection)(game, wishlist);
        return httpResponse({ statusCode: 200, body: JSON.stringify(response) });
    }
    catch (err) {
        return httpResponse({ statusCode: err.statusCode, body: err.message });
    }
}
exports.removeGameFromWishlist = removeGameFromWishlist;
function httpResponse(data) {
    return {
        statusCode: data.statusCode,
        body: data.body,
        headers: {
            'Access-Control-Allow-Origin': '*'
        }
    };
}
exports.httpResponse = httpResponse;
function deserializeGameData(userID, data) {
    return new game_1.Game(userID, data.gameName, data === null || data === void 0 ? void 0 : data.yearReleased, data === null || data === void 0 ? void 0 : data.genre, data === null || data === void 0 ? void 0 : data.console, data === null || data === void 0 ? void 0 : data.developer);
}
exports.deserializeGameData = deserializeGameData;
function deserializeCollectionData(userID, collectionType) {
    return new collection_1.Collection(userID, collectionType);
}
exports.deserializeCollectionData = deserializeCollectionData;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSxNQUFNLEdBQUcsR0FBRyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7QUFDL0IsaUNBQTZCO0FBQzdCLCtDQUF3RztBQUN4Ryw2Q0FBMEM7QUFDMUMsMkRBQW1HO0FBRW5HLE9BQU8sQ0FBQyxPQUFPLEdBQUcsS0FBSyxFQUFFLEtBQVUsRUFBRSxPQUFZLEVBQUUsUUFBYSxFQUFFLEVBQUU7SUFDbEUsTUFBTSxNQUFNLEdBQUcsS0FBSyxDQUFDLGNBQWMsQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLGtCQUFrQixDQUFDLENBQUM7SUFDMUUsUUFBUSxLQUFLLENBQUMsSUFBSSxFQUFFO1FBQ2xCLEtBQUssQ0FBQyxVQUFVLENBQUM7WUFDZixJQUFJLFFBQVEsR0FBRyxFQUFFLFFBQVEsRUFBRSxLQUFLLENBQUMscUJBQXFCLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQztZQUNyRSxJQUFJLFdBQVcsR0FBRyxtQkFBbUIsQ0FBQyxNQUFNLEVBQUUsUUFBUSxDQUFDLENBQUE7WUFDdkQsUUFBUSxDQUFDLElBQUksRUFBRSxNQUFNLG1CQUFtQixDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUM7WUFDdkQsTUFBTTtRQUNSLEtBQUksQ0FBQyxZQUFZLENBQUM7WUFDaEIsSUFBSSxZQUFZLEdBQUcsTUFBTSxDQUFDO1lBQzFCLFFBQVEsQ0FBQyxJQUFJLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO1lBQzFELE1BQU07UUFDUixLQUFJLENBQUMsYUFBYSxDQUFDO1lBQ2pCLElBQUksY0FBYyxHQUFHLG1CQUFtQixDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQ3pFLFFBQVEsQ0FBQyxJQUFJLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQyxj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RUFBQyxDQUFDLENBQUM7S0FDdEU7QUFDSCxDQUFDO0FBUkQsd0RBUUM7QUFFRCxTQUFnQixZQUFZLENBQUMsSUFBbUI7SUFDOUMsT0FBTztRQUNMLFVBQVUsRUFBRSxJQUFJLENBQUMsVUFBVTtRQUMzQixJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUk7UUFDZixPQUFPLEVBQUU7WUFDUCw2QkFBNkIsRUFBRSxHQUFHO1NBQ25DO0tBQ0YsQ0FBQTtBQUNILENBQUM7QUFSRCxvQ0FRQztBQUVELFNBQWdCLG1CQUFtQixDQUFDLE1BQWMsRUFBRSxJQUFrQjtJQUNwRSxPQUFPLElBQUksV0FBSSxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsUUFBUSxFQUFFLElBQUksYUFBSixJQUFJLHVCQUFKLElBQUksQ0FBRSxZQUFZLEVBQUUsSUFBSSxhQUFKLElBQUksdUJBQUosSUFBSSxDQUFFLEtBQUssRUFBRSxJQUFJLGFBQUosSUFBSSx1QkFBSixJQUFJLENBQUUsT0FBTyxFQUFFLElBQUksYUFBSixJQUFJLHVCQUFKLElBQUksQ0FBRSxTQUFTLENBQUMsQ0FBQztBQUMxRyxDQUFDO0FBRkQsa0RBRUM7QUFFRCxTQUFnQix5QkFBeUIsQ0FBQyxNQUFjLEVBQUUsY0FBc0I7SUFDOUUsT0FBTyxJQUFJLHVCQUFVLENBQUMsTUFBTSxFQUFFLGNBQWMsQ0FBQyxDQUFDO0FBQ2hELENBQUM7QUFGRCw4REFFQyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IEFXUyA9IHJlcXVpcmUoJ2F3cy1zZGsnKTtcclxuaW1wb3J0IHsgR2FtZSB9IGZyb20gXCIuL2dhbWVcIlxyXG5pbXBvcnQgeyBnZXRHYW1lLCBsaXN0R2FtZXMsIElIdHRwUmVzcG9uc2UsIElKU09OUGF5bG9hZCwgZGVsZXRlR2FtZSwgbW9kaWZ5R2FtZSB9IGZyb20gXCIuL2dhbWVNYW5hZ2VyXCI7XHJcbmltcG9ydCB7IENvbGxlY3Rpb24gfSBmcm9tIFwiLi9jb2xsZWN0aW9uXCI7XHJcbmltcG9ydCB7IGFkZEdhbWVUb0NvbGxlY3Rpb24sIGdldENvbGxlY3Rpb24sIHJlbW92ZUdhbWVGcm9tQ29sbGVjdGlvbiB9IGZyb20gXCIuL2NvbGxlY3Rpb25NYW5hZ2VyXCI7XHJcblxyXG5leHBvcnRzLmhhbmRsZXIgPSBhc3luYyAoZXZlbnQ6IGFueSwgY29udGV4dDogYW55LCBjYWxsYmFjazogYW55KSA9PiB7XHJcbiAgY29uc3QgdXNlcklEID0gZXZlbnQucmVxdWVzdENvbnRleHQuYXV0aG9yaXplci5jbGFpbXNbJ2NvZ25pdG86dXNlcm5hbWUnXTtcclxuICBzd2l0Y2ggKGV2ZW50LnBhdGgpIHtcclxuICAgIGNhc2UgKFwiL2dldEdhbWVcIik6XHJcbiAgICAgIGxldCBnYW1lTmFtZSA9IHsgZ2FtZU5hbWU6IGV2ZW50LnF1ZXJ5U3RyaW5nUGFyYW1ldGVyc1tcImdhbWVOYW1lXCJdIH07XHJcbiAgICAgIGxldCBnZXRHYW1lRGF0YSA9IGRlc2VyaWFsaXplR2FtZURhdGEodXNlcklELCBnYW1lTmFtZSlcclxuICAgICAgY2FsbGJhY2sobnVsbCwgYXdhaXQgZ2V0R2FtZUh0dHBSZXNwb25zZShnZXRHYW1lRGF0YSkpO1xyXG4gICAgICBicmVhaztcclxuICAgIGNhc2UoXCIvbGlzdEdhbWVzXCIpOlxyXG4gICAgICBsZXQgbGlzdEdhbWVEYXRhID0gdXNlcklEO1xyXG4gICAgICBjYWxsYmFjayhudWxsLCBhd2FpdCBsaXN0R2FtZXNIdHRwUmVzcG9uc2UobGlzdEdhbWVEYXRhKSk7XHJcbiAgICAgIGJyZWFrO1xyXG4gICAgY2FzZShcIi9jcmVhdGVHYW1lXCIpOlxyXG4gICAgICBsZXQgY3JlYXRlR2FtZURhdGEgPSBkZXNlcmlhbGl6ZUdhbWVEYXRhKHVzZXJJRCwgSlNPTi5wYXJzZShldmVudC5ib2R5KSk7XHJcbiAgICAgIGNhbGxiYWNrKG51bGwsIGF3YWl0IGNyZWF0ZUdhbWVIdHRwUmVzcG9uc2UoY3JlYXRlR2FtZURhdGEpKTtcclxuICAgICAgYnJlYWs7XHJcbiAgICBjYXNlKFwiL21vZGlmeUdhbWVcIik6XHJcbiAgICAgIGxldCBtb2RpZnlHYW1lRGF0YSA9IGRlc2VyaWFsaXplR2FtZURhdGEodXNlcklELCBKU09OLnBhcnNlKGV2ZW50LmJvZHkpKTtcclxuICAgICAgY2FsbGJhY2sobnVsbCwgYXdhaXQgbW9kaWZ5R2FtZUh0dHBSZXNwb25zZShtb2RpZnlHYW1lRGF0YSkpO1xyXG4gICAgICBicmVhaztcclxuICAgIGNhc2UgKFwiL2RlbGV0ZUdhbWVcIik6XHJcbiAgICAgIGxldCBkZWxldGVHYW1lRGF0YSA9IGRlc2VyaWFsaXplR2FtZURhdGEodXNlcklELCBKU09OLnBhcnNlKGV2ZW50LmJvZHkpKTtcclxuICAgICAgY2FsbGJhY2sobnVsbCwgYXdhaXQgZGVsZXRlR2FtZUh0dHBSZXNwb25zZShkZWxldGVHYW1lRGF0YSkpO1xyXG4gICAgICBicmVhaztcclxuICAgIGNhc2UgKFwiL2NvbGxlY3Rpb24vY3JlYXRlV2lzaGxpc3RcIik6XHJcbiAgICAgIGxldCBjcmVhdGVXaXNobGlzdERhdGEgPSBkZXNlcmlhbGl6ZUNvbGxlY3Rpb25EYXRhKHVzZXJJRCwgXCJ3aXNobGlzdFwiKTtcclxuICAgICAgY2FsbGJhY2sobnVsbCwgYXdhaXQgY3JlYXRlV2lzaExpc3RIdHRwUmVzcG9uc2UoY3JlYXRlV2lzaGxpc3REYXRhKSk7XHJcbiAgICAgIGJyZWFrO1xyXG4gICAgY2FzZSAoXCIvY29sbGVjdGlvbi9nZXRXaXNobGlzdFwiKTpcclxuICAgICAgY2FsbGJhY2sobnVsbCwgYXdhaXQgZ2V0V2lzaGxpc3RIdHRwUmVzcG9uc2UodXNlcklEKSk7XHJcbiAgICAgIGJyZWFrO1xyXG4gICAgY2FzZSAoXCIvd2lzaGxpc3QvYWRkR2FtZVwiKTpcclxuICAgICAgbGV0IGFkZEdhbWVEYXRhID0gZGVzZXJpYWxpemVHYW1lRGF0YSh1c2VySUQsIEpTT04ucGFyc2UoZXZlbnQuYm9keSkpO1xyXG4gICAgICBjYWxsYmFjayhudWxsLCBhd2FpdCBhZGRHYW1lVG9XaXNobGlzdChhZGRHYW1lRGF0YSkpO1xyXG4gICAgICBicmVhaztcclxuICAgIGNhc2UgKFwiL3dpc2hsaXN0L3JlbW92ZUdhbWVcIik6XHJcbiAgICAgIGxldCByZW1vdmVHYW1lRGF0YSA9IGRlc2VyaWFsaXplR2FtZURhdGEodXNlcklELCBKU09OLnBhcnNlKGV2ZW50LmJvZHkpKTtcclxuICAgICAgY2FsbGJhY2sobnVsbCwgYXdhaXQgcmVtb3ZlR2FtZUZyb21XaXNobGlzdChyZW1vdmVHYW1lRGF0YSkpO1xyXG4gICAgICBicmVhaztcclxuICAgIGRlZmF1bHQ6XHJcbiAgICAgIGNhbGxiYWNrKG51bGwsIGh0dHBSZXNwb25zZSh7c3RhdHVzQ29kZTogNDAwLCBib2R5OiBKU09OLnN0cmluZ2lmeShcIkludmFsaWQgb3BlcmF0aW9uLlwiKX0pKTtcclxuICAgICAgYnJlYWs7XHJcbiAgICB9XHJcbn0gIFxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEdhbWVIdHRwUmVzcG9uc2UoZ2FtZTogR2FtZSkge1xyXG4gIHRyeSB7XHJcbiAgICBsZXQgcmVzcG9uc2UgPSBhd2FpdCBnZXRHYW1lKGdhbWUpO1xyXG4gICAgcmV0dXJuIGh0dHBSZXNwb25zZSh7c3RhdHVzQ29kZTogMjAwLCBib2R5OiBKU09OLnN0cmluZ2lmeShyZXNwb25zZSl9KTtcclxuICB9IGNhdGNoIChlcnI6IGFueSkge1xyXG4gICAgcmV0dXJuIGh0dHBSZXNwb25zZSh7c3RhdHVzQ29kZTogZXJyLnN0YXR1c0NvZGUsIGJvZHk6IGVyci5tZXNzYWdlfSk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbGlzdEdhbWVzSHR0cFJlc3BvbnNlKHVzZXJJRDogc3RyaW5nKSB7XHJcbiAgdHJ5IHtcclxuICAgIGxldCByZXNwb25zZSA9IGF3YWl0IGxpc3RHYW1lcyh1c2VySUQpO1xyXG4gICAgcmV0dXJuIGh0dHBSZXNwb25zZSh7c3RhdHVzQ29kZTogMjAwLCBib2R5OiBKU09OLnN0cmluZ2lmeShyZXNwb25zZSl9KTtcclxuICB9IGNhdGNoIChlcnI6IGFueSkge1xyXG4gICAgcmV0dXJuIGh0dHBSZXNwb25zZSh7c3RhdHVzQ29kZTogZXJyLnN0YXR1c0NvZGUsIGJvZHk6IGVyci5tZXNzYWdlfSk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlR2FtZUh0dHBSZXNwb25zZShnYW1lOiBHYW1lKSB7XHJcbiAgdHJ5IHtcclxuICAgIGxldCByZXNwb25zZSA9IGF3YWl0IGdhbWUuY3JlYXRlR2FtZSgpO1xyXG4gICAgcmV0dXJuIGh0dHBSZXNwb25zZSh7c3RhdHVzQ29kZTogMjAwLCBib2R5OiBKU09OLnN0cmluZ2lmeShyZXNwb25zZSl9KTtcclxuICB9IGNhdGNoIChlcnI6IGFueSkge1xyXG4gICAgcmV0dXJuIGh0dHBSZXNwb25zZSh7c3RhdHVzQ29kZTogZXJyLnN0YXR1c0NvZGUsIGJvZHk6IGVyci5tZXNzYWdlfSk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbW9kaWZ5R2FtZUh0dHBSZXNwb25zZShnYW1lOiBHYW1lKSB7XHJcbiAgdHJ5IHtcclxuICAgIGxldCByZXNwb25zZSA9IGF3YWl0IG1vZGlmeUdhbWUoZ2FtZSk7XHJcbiAgICByZXR1cm4gaHR0cFJlc3BvbnNlKHtzdGF0dXNDb2RlOiAyMDAsIGJvZHk6IEpTT04uc3RyaW5naWZ5KHJlc3BvbnNlKX0pO1xyXG4gIH0gY2F0Y2ggKGVycjogYW55KSB7XHJcbiAgICByZXR1cm4gaHR0cFJlc3BvbnNlKHtzdGF0dXNDb2RlOiBlcnIuc3RhdHVzQ29kZSwgYm9keTogZXJyLm1lc3NhZ2V9KTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBkZWxldGVHYW1lSHR0cFJlc3BvbnNlKGdhbWU6IEdhbWUpIHtcclxuICB0cnkge1xyXG4gICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgZGVsZXRlR2FtZShnYW1lKTtcclxuICAgIHJldHVybiBodHRwUmVzcG9uc2Uoe3N0YXR1c0NvZGU6IDIwMCwgYm9keTogSlNPTi5zdHJpbmdpZnkocmVzcG9uc2UpfSk7XHJcbiAgfSBjYXRjaCAoZXJyOiBhbnkpIHtcclxuICAgIHJldHVybiBodHRwUmVzcG9uc2Uoe3N0YXR1c0NvZGU6IGVyci5zdGF0dXNDb2RlLCBib2R5OiBlcnIubWVzc2FnZX0pO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZVdpc2hMaXN0SHR0cFJlc3BvbnNlKHdpc2hMaXN0OiBDb2xsZWN0aW9uKSB7XHJcbiAgdHJ5IHtcclxuICAgIGxldCByZXNwb25zZSA9IGF3YWl0IHdpc2hMaXN0LmNyZWF0ZUNvbGxlY3Rpb24oKTtcclxuICAgIHJldHVybiBodHRwUmVzcG9uc2Uoe3N0YXR1c0NvZGU6IDIwMCwgYm9keTogSlNPTi5zdHJpbmdpZnkocmVzcG9uc2UpfSk7XHJcbiAgfSBjYXRjaCAoZXJyOiBhbnkpIHtcclxuICAgIHJldHVybiBodHRwUmVzcG9uc2Uoe3N0YXR1c0NvZGU6IGVyci5zdGF0dXNDb2RlLCBib2R5OiBlcnIubWVzc2FnZX0pO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFdpc2hsaXN0SHR0cFJlc3BvbnNlKHVzZXJJRDogc3RyaW5nKSB7XHJcbiAgdHJ5IHtcclxuICAgIGxldCByZXNwb25zZSA9IGF3YWl0IGdldENvbGxlY3Rpb24odXNlcklELCBcIndpc2hsaXN0XCIpO1xyXG4gICAgcmV0dXJuIGh0dHBSZXNwb25zZSh7c3RhdHVzQ29kZTogMjAwLCBib2R5OiBKU09OLnN0cmluZ2lmeShyZXNwb25zZSl9KTtcclxuICB9IGNhdGNoIChlcnI6IGFueSkge1xyXG4gICAgcmV0dXJuIGh0dHBSZXNwb25zZSh7c3RhdHVzQ29kZTogZXJyLnN0YXR1c0NvZGUsIGJvZHk6IGVyci5tZXNzYWdlfSk7XHJcbiAgfVxyXG59XHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhZGRHYW1lVG9XaXNobGlzdChnYW1lOiBHYW1lKSB7XHJcbiAgdHJ5IHtcclxuICAgIGxldCB3aXNobGlzdCA9IGF3YWl0IGdldENvbGxlY3Rpb24oZ2FtZS51c2VySUQsICd3aXNobGlzdCcpO1xyXG4gICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgYWRkR2FtZVRvQ29sbGVjdGlvbihnYW1lLCB3aXNobGlzdCk7XHJcbiAgICByZXR1cm4gaHR0cFJlc3BvbnNlKHtzdGF0dXNDb2RlOiAyMDAsIGJvZHk6IEpTT04uc3RyaW5naWZ5KHJlc3BvbnNlKX0pO1xyXG4gIH0gY2F0Y2ggKGVycjogYW55KSB7XHJcbiAgICByZXR1cm4gaHR0cFJlc3BvbnNlKHtzdGF0dXNDb2RlOiBlcnIuc3RhdHVzQ29kZSwgYm9keTogZXJyLm1lc3NhZ2V9KTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByZW1vdmVHYW1lRnJvbVdpc2hsaXN0KGdhbWU6IEdhbWUpIHtcclxuICB0cnkge1xyXG4gICAgbGV0IHdpc2hsaXN0ID0gYXdhaXQgZ2V0Q29sbGVjdGlvbihnYW1lLnVzZXJJRCwgJ3dpc2hsaXN0Jyk7XHJcbiAgICBsZXQgcmVzcG9uc2UgPSBhd2FpdCByZW1vdmVHYW1lRnJvbUNvbGxlY3Rpb24oZ2FtZSwgd2lzaGxpc3QpO1xyXG4gICAgcmV0dXJuIGh0dHBSZXNwb25zZSh7c3RhdHVzQ29kZTogMjAwLCBib2R5OiBKU09OLnN0cmluZ2lmeShyZXNwb25zZSl9KTtcclxuICB9IGNhdGNoIChlcnI6IGFueSkge1xyXG4gICAgcmV0dXJuIGh0dHBSZXNwb25zZSh7c3RhdHVzQ29kZTogZXJyLnN0YXR1c0NvZGUsIGJvZHk6IGVyci5tZXNzYWdlfSk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaHR0cFJlc3BvbnNlKGRhdGE6IElIdHRwUmVzcG9uc2UpIDoge30ge1xyXG4gIHJldHVybiB7XHJcbiAgICBzdGF0dXNDb2RlOiBkYXRhLnN0YXR1c0NvZGUsXHJcbiAgICBib2R5OiBkYXRhLmJvZHksXHJcbiAgICBoZWFkZXJzOiB7XHJcbiAgICAgICdBY2Nlc3MtQ29udHJvbC1BbGxvdy1PcmlnaW4nOiAnKidcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBkZXNlcmlhbGl6ZUdhbWVEYXRhKHVzZXJJRDogc3RyaW5nLCBkYXRhOiBJSlNPTlBheWxvYWQpIHtcclxuICByZXR1cm4gbmV3IEdhbWUodXNlcklELCBkYXRhLmdhbWVOYW1lLCBkYXRhPy55ZWFyUmVsZWFzZWQsIGRhdGE/LmdlbnJlLCBkYXRhPy5jb25zb2xlLCBkYXRhPy5kZXZlbG9wZXIpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZGVzZXJpYWxpemVDb2xsZWN0aW9uRGF0YSh1c2VySUQ6IHN0cmluZywgY29sbGVjdGlvblR5cGU6IHN0cmluZykge1xyXG4gIHJldHVybiBuZXcgQ29sbGVjdGlvbih1c2VySUQsIGNvbGxlY3Rpb25UeXBlKTtcclxufSJdfQ==