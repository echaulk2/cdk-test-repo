"use strict";
const collection = require("../functions/models/collection");
const wishlist = require("../functions/models/wishlist");
const collectionManager = require("../functions/dataManager/collectionManager");
const collectionErrorHandler = require("../functions/error/collectionErrorHandler");
const gameObject = require("../functions/models/game");
const gameDAO = require("../functions/dataManager/gameManager");
const priceDataManager = require("../functions/dataManager/priceChartingDataManager");
const gamePriceData = require("../functions/models/gamePriceData");
const Interfaces = require("../functions/shared/interfaces/interfaces");
const gamePriceDAO = require("../functions/dataManager/gamePriceDataManager");
test("Add Game to Wishlist", async () => {
    let partitionKey = '[User]#[erikchaulk]';
    let collectionSortKey = '[CollectionItem]#[Wishlist]#[GameItem]#[Super Mario]';
    let collectionItemType = '[CollectionItem]#[Wishlist]#[GameItem]';
    let userData = {
        userID: 'erikchaulk',
        email: 'erikchaulk@gmail.com'
    };
    let gamePriceDataSortKey = '[GamePriceData]#[Super Mario]';
    let gamePriceDataItemType = '[GamePriceData]';
    let testGame = new gameObject.Game(partitionKey, collectionSortKey, collectionItemType, 'Super Mario', userData.email, 1992, 'Action-Adventure', 'Nintendo 64', 'Nintendo', 'loose', 50);
    let testGamePriceData = new gamePriceData.GamePriceData(partitionKey, gamePriceDataSortKey, gamePriceDataItemType);
    testGamePriceData.lowestPrice = "$18.74";
    testGamePriceData.averagePrice = "$44.51";
    testGamePriceData.listedItemTitle = "Super Mario 64";
    testGamePriceData.listedItemURL = "https://www.pricecharting.com/game/jp-nintendo-64/super-mario-64";
    testGamePriceData.listedItemConsole = "JP Nintendo 64";
    testGamePriceData.lastChecked = "3/10/2022, 11:15:38 AM";
    let testWishlist = new wishlist.Wishlist(userData.userID);
    jest.setTimeout(30000);
    let response = await collectionManager.addGameToCollection(testGame, testWishlist);
    testGame.gamePriceData = testGamePriceData;
    expect(response).toEqual([testGame]);
});
test("removeGameFromCollection", async () => {
    let partitionKey = '[User]#[erikchaulk]';
    let sortKey = '[CollectionItem]#[Wishlist]#[GameItem]#[Super Mario]';
    let secondSortKey = '[CollectionItem]#[Wishlist]#[GameItem]#[Overwatch]';
    let userID = 'erikchaulk';
    let testGame = new gameObject.Game(partitionKey, sortKey, 'Super Mario', 1992, 'Action-Adventure', 'Nintendo 64', 'Nintendo', 'loose');
    let secondTestGame = new gameObject.Game(partitionKey, secondSortKey, 'Overwatch', 2016, 'First-Person Shooter', 'PC', 'Blizzard', 'cib');
    let testWishlist = new wishlist.Wishlist(userID);
    await collectionManager.addGameToCollection(secondTestGame, testWishlist);
    let response = await collectionManager.removeGameFromCollection(secondTestGame, testWishlist);
    expect(response).toEqual([testGame]);
});
test("modifyGameInCollection", async () => {
    let partitionKey = '[User]#[erikchaulk]';
    let sortKey = '[CollectionItem]#[Wishlist]#[GameItem]#[Super Mario]';
    let userID = 'erikchaulk';
    let testGame = new gameObject.Game(partitionKey, sortKey, 'Super Mario', 1993, 'Action-Adventure', 'Nintendo 64', 'Nintendo', 'loose');
    let testWishlist = new wishlist.Wishlist(userID);
    let response = await collectionManager.modifyGameInCollection(testGame, testWishlist);
    expect(response).toEqual([testGame]);
});
test("getCollection", async () => {
    let partitionKey = '[User]#[erikchaulk]';
    let sortKey = '[CollectionItem]#[Wishlist]#[GameItem]#[Super Mario]';
    let testGame = new gameObject.Game(partitionKey, sortKey, 'Super Mario', 1993, 'Action-Adventure', 'Nintendo 64', 'Nintendo', 'loose');
    let userID = 'erikchaulk';
    let testWishlist = new wishlist.Wishlist(userID);
    let response = await collectionManager.getCollection(testWishlist);
    expect(response).toEqual([testGame]);
});
test("collectionError", async () => {
    let collectionError = new collectionErrorHandler.CollectionError("Game not found in the collection.", 404);
    expect(collectionError.message).toEqual('Collection error, datastore response: Game not found in the collection.');
    expect(collectionError.statusCode).toEqual(404);
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZnVuY3Rpb25zLmNvbGxlY3Rpb24udGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImZ1bmN0aW9ucy5jb2xsZWN0aW9uLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE1BQU0sVUFBVSxHQUFHLE9BQU8sQ0FBQyxnQ0FBZ0MsQ0FBQyxDQUFDO0FBQzdELE1BQU0sUUFBUSxHQUFHLE9BQU8sQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDO0FBQ3pELE1BQU0saUJBQWlCLEdBQUcsT0FBTyxDQUFDLDRDQUE0QyxDQUFDLENBQUM7QUFDaEYsTUFBTSxzQkFBc0IsR0FBRyxPQUFPLENBQUMsMkNBQTJDLENBQUMsQ0FBQztBQUNwRixNQUFNLFVBQVUsR0FBRyxPQUFPLENBQUMsMEJBQTBCLENBQUMsQ0FBQztBQUN2RCxNQUFNLE9BQU8sR0FBRyxPQUFPLENBQUMsc0NBQXNDLENBQUMsQ0FBQztBQUNoRSxNQUFNLGdCQUFnQixHQUFHLE9BQU8sQ0FBQyxtREFBbUQsQ0FBQyxDQUFDO0FBQ3RGLE1BQU0sYUFBYSxHQUFHLE9BQU8sQ0FBQyxtQ0FBbUMsQ0FBQyxDQUFDO0FBQ25FLE1BQU0sVUFBVSxHQUFHLE9BQU8sQ0FBQywyQ0FBMkMsQ0FBQyxDQUFDO0FBQ3hFLE1BQU0sWUFBWSxHQUFHLE9BQU8sQ0FBQywrQ0FBK0MsQ0FBQyxDQUFDO0FBRTlFLElBQUksQ0FBQyxzQkFBc0IsRUFBRSxLQUFLLElBQUksRUFBRTtJQUNwQyxJQUFJLFlBQVksR0FBRyxxQkFBcUIsQ0FBQTtJQUN4QyxJQUFJLGlCQUFpQixHQUFHLHNEQUFzRCxDQUFBO0lBQzlFLElBQUksa0JBQWtCLEdBQUcsd0NBQXdDLENBQUE7SUFDakUsSUFBSSxRQUFRLEdBQUc7UUFDWCxNQUFNLEVBQUUsWUFBWTtRQUNwQixLQUFLLEVBQUUsc0JBQXNCO0tBQ2hDLENBQUM7SUFDRixJQUFJLG9CQUFvQixHQUFHLCtCQUErQixDQUFDO0lBQzNELElBQUkscUJBQXFCLEdBQUcsaUJB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Q0FBQztJQUNuSCxNQUFNLENBQUMsZUFBZSxDQUFDLFVBQVUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUNwRCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGNvbGxlY3Rpb24gPSByZXF1aXJlKFwiLi4vZnVuY3Rpb25zL21vZGVscy9jb2xsZWN0aW9uXCIpO1xyXG5jb25zdCB3aXNobGlzdCA9IHJlcXVpcmUoXCIuLi9mdW5jdGlvbnMvbW9kZWxzL3dpc2hsaXN0XCIpO1xyXG5jb25zdCBjb2xsZWN0aW9uTWFuYWdlciA9IHJlcXVpcmUoXCIuLi9mdW5jdGlvbnMvZGF0YU1hbmFnZXIvY29sbGVjdGlvbk1hbmFnZXJcIik7XHJcbmNvbnN0IGNvbGxlY3Rpb25FcnJvckhhbmRsZXIgPSByZXF1aXJlKFwiLi4vZnVuY3Rpb25zL2Vycm9yL2NvbGxlY3Rpb25FcnJvckhhbmRsZXJcIik7XHJcbmNvbnN0IGdhbWVPYmplY3QgPSByZXF1aXJlKFwiLi4vZnVuY3Rpb25zL21vZGVscy9nYW1lXCIpO1xyXG5jb25zdCBnYW1lREFPID0gcmVxdWlyZShcIi4uL2Z1bmN0aW9ucy9kYXRhTWFuYWdlci9nYW1lTWFuYWdlclwiKTtcclxuY29uc3QgcHJpY2VEYXRhTWFuYWdlciA9IHJlcXVpcmUoXCIuLi9mdW5jdGlvbnMvZGF0YU1hbmFnZXIvcHJpY2VDaGFydGluZ0RhdGFNYW5hZ2VyXCIpO1xyXG5jb25zdCBnYW1lUHJpY2VEYXRhID0gcmVxdWlyZShcIi4uL2Z1bmN0aW9ucy9tb2RlbHMvZ2FtZVByaWNlRGF0YVwiKTtcclxuY29uc3QgSW50ZXJmYWNlcyA9IHJlcXVpcmUoXCIuLi9mdW5jdGlvbnMvc2hhcmVkL2ludGVyZmFjZXMvaW50ZXJmYWNlc1wiKTtcclxuY29uc3QgZ2FtZVByaWNlREFPID0gcmVxdWlyZShcIi4uL2Z1bmN0aW9ucy9kYXRhTWFuYWdlci9nYW1lUHJpY2VEYXRhTWFuYWdlclwiKTtcclxuXHJcbnRlc3QoXCJBZGQgR2FtZSB0byBXaXNobGlzdFwiLCBhc3luYyAoKSA9PiB7XHJcbiAgICBsZXQgcGFydGl0aW9uS2V5ID0gJ1tVc2VyXSNbZXJpa2NoYXVsa10nXHJcbiAgICBsZXQgY29sbGVjdGlvblNvcnRLZXkgPSAnW0NvbGxlY3Rpb25JdGVtXSNbV2lzaGxpc3RdI1tHYW1lSXRlbV0jW1N1cGVyIE1hcmlvXSdcclxuICAgIGxldCBjb2xsZWN0aW9uSXRlbVR5cGUgPSAnW0NvbGxlY3Rpb25JdGVtXSNbV2lzaGxpc3RdI1tHYW1lSXRlbV0nXHJcbiAgICBsZXQgdXNlckRhdGEgPSB7XHJcbiAgICAgICAgdXNlcklEOiAnZXJpa2NoYXVsaycsXHJcbiAgICAgICAgZW1haWw6ICdlcmlrY2hhdWxrQGdtYWlsLmNvbSdcclxuICAgIH07XHJcbiAgICBsZXQgZ2FtZVByaWNlRGF0YVNvcnRLZXkgPSAnW0dhbWVQcmljZURhdGFdI1tTdXBlciBNYXJpb10nO1xyXG4gICAgbGV0IGdhbWVQcmljZURhdGFJdGVtVHlwZSA9ICdbR2FtZVByaWNlRGF0YV0nO1xyXG4gICAgbGV0IHRlc3RHYW1lID0gbmV3IGdhbWVPYmplY3QuR2FtZShwYXJ0aXRpb25LZXksIGNvbGxlY3Rpb25Tb3J0S2V5LCBjb2xsZWN0aW9uSXRlbVR5cGUsICdTdXBlciBNYXJpbycsIHVzZXJEYXRhLmVtYWlsLCAxOTkyLCAnQWN0aW9uLUFkdmVudHVyZScsICdOaW50ZW5kbyA2NCcsICdOaW50ZW5kbycsICdsb29zZScsIDUwKTtcclxuICAgIGxldCB0ZXN0R2FtZVByaWNlRGF0YSA9IG5ldyBnYW1lUHJpY2VEYXRhLkdhbWVQcmljZURhdGEocGFydGl0aW9uS2V5LCBnYW1lUHJpY2VEYXRhU29ydEtleSwgZ2FtZVByaWNlRGF0YUl0ZW1UeXBlKTtcclxuICAgIHRlc3RHYW1lUHJpY2VEYXRhLmxvd2VzdFByaWNlID0gXCIkMTguNzRcIjtcclxuICAgIHRlc3RHYW1lUHJpY2VEYXRhLmF2ZXJhZ2VQcmljZSA9IFwiJDQ0LjUxXCI7XHJcbiAgICB0ZXN0R2FtZVByaWNlRGF0YS5saXN0ZWRJdGVtVGl0bGUgPSBcIlN1cGVyIE1hcmlvIDY0XCI7XHJcbiAgICB0ZXN0R2FtZVByaWNlRGF0YS5saXN0ZWRJdGVtVVJMID0gXCJodHRwczovL3d3dy5wcmljZWNoYXJ0aW5nLmNvbS9nYW1lL2pwLW5pbnRlbmRvLTY0L3N1cGVyLW1hcmlvLTY0XCI7XHJcbiAgICB0ZXN0R2FtZVByaWNlRGF0YS5saXN0ZWRJdGVtQ29uc29sZSA9IFwiSlAgTmludGVuZG8gNjRcIjtcclxuICAgIHRlc3RHYW1lUHJpY2VEYXRhLmxhc3RDaGVja2VkID0gXCIzLzEwLzIwMjIsIDExOjE1OjM4IEFNXCI7XHJcbiAgICBsZXQgdGVzdFdpc2hsaXN0ID0gbmV3IHdpc2hsaXN0Lldpc2hsaXN0KHVzZXJEYXRhLnVzZXJJRCk7XHJcbiAgICBqZXN0LnNldFRpbWVvdXQoMzAwMDApO1xyXG4gICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgY29sbGVjdGlvbk1hbmFnZXIuYWRkR2FtZVRvQ29sbGVjdGlvbih0ZXN0R2FtZSwgdGVzdFdpc2hsaXN0KTtcclxuICAgIHRlc3RHYW1lLmdhbWVQcmljZURhdGEgPSB0ZXN0R2FtZVByaWNlRGF0YTtcclxuICAgIGV4cGVjdChyZXNwb25zZSkudG9FcXVhbChbdGVzdEdhbWVdKTtcclxufSk7XHJcblxyXG50ZXN0KFwicmVtb3ZlR2FtZUZyb21Db2xsZWN0aW9uXCIsIGFzeW5jICgpID0+IHtcclxuICAgIGxldCBwYXJ0aXRpb25LZXkgPSAnW1VzZXJdI1tlcmlrY2hhdWxrXSc7XHJcbiAgICBsZXQgc29ydEtleSA9ICdbQ29sbGVjdGlvbkl0ZW1dI1tXaXNobGlzdF0jW0dhbWVJdGVtXSNbU3VwZXIgTWFyaW9dJztcclxuICAgIGxldCBzZWNvbmRTb3J0S2V5ID0gJ1tDb2xsZWN0aW9uSXRlbV0jW1dpc2hsaXN0XSNbR2FtZUl0ZW1dI1tPdmVyd2F0Y2hdJztcclxuICAgIGxldCB1c2VySUQgPSAnZXJpa2NoYXVsayc7XHJcbiAgICBsZXQgdGVzdEdhbWUgPSBuZXcgZ2FtZU9iamVjdC5HYW1lKHBhcnRpdGlvbktleSwgc29ydEtleSwgJ1N1cGVyIE1hcmlvJywgMTk5MiwgJ0FjdGlvbi1BZHZlbnR1cmUnLCAnTmludGVuZG8gNjQnLCAnTmludGVuZG8nLCAnbG9vc2UnKTtcclxuICAgIGxldCBzZWNvbmRUZXN0R2FtZSA9IG5ldyBnYW1lT2JqZWN0LkdhbWUocGFydGl0aW9uS2V5LCBzZWNvbmRTb3J0S2V5LCAnT3ZlcndhdGNoJywgMjAxNiwgJ0ZpcnN0LVBlcnNvbiBTaG9vdGVyJywgJ1BDJywgJ0JsaXp6YXJkJywgJ2NpYicpO1xyXG4gICAgbGV0IHRlc3RXaXNobGlzdCA9IG5ldyB3aXNobGlzdC5XaXNobGlzdCh1c2VySUQpO1xyXG4gICAgYXdhaXQgY29sbGVjdGlvbk1hbmFnZXIuYWRkR2FtZVRvQ29sbGVjdGlvbihzZWNvbmRUZXN0R2FtZSwgdGVzdFdpc2hsaXN0KTtcclxuICAgIGxldCByZXNwb25zZSA9IGF3YWl0IGNvbGxlY3Rpb25NYW5hZ2VyLnJlbW92ZUdhbWVGcm9tQ29sbGVjdGlvbihzZWNvbmRUZXN0R2FtZSwgdGVzdFdpc2hsaXN0KTtcclxuICAgIGV4cGVjdChyZXNwb25zZSkudG9FcXVhbChbdGVzdEdhbWVdKTtcclxufSk7XHJcblxyXG50ZXN0KFwibW9kaWZ5R2FtZUluQ29sbGVjdGlvblwiLCBhc3luYyAoKSA9PiB7XHJcbiAgICBsZXQgcGFydGl0aW9uS2V5ID0gJ1tVc2VyXSNbZXJpa2NoYXVsa10nO1xyXG4gICAgbGV0IHNvcnRLZXkgPSAnW0NvbGxlY3Rpb25JdGVtXSNbV2lzaGxpc3RdI1tHYW1lSXRlbV0jW1N1cGVyIE1hcmlvXSc7XHJcbiAgICBsZXQgdXNlcklEID0gJ2VyaWtjaGF1bGsnO1xyXG4gICAgbGV0IHRlc3RHYW1lID0gbmV3IGdhbWVPYmplY3QuR2FtZShwYXJ0aXRpb25LZXksIHNvcnRLZXksICdTdXBlciBNYXJpbycsIDE5OTMsICdBY3Rpb24tQWR2ZW50dXJlJywgJ05pbnRlbmRvIDY0JywgJ05pbnRlbmRvJywgJ2xvb3NlJyk7XHJcbiAgICBsZXQgdGVzdFdpc2hsaXN0ID0gbmV3IHdpc2hsaXN0Lldpc2hsaXN0KHVzZXJJRCk7XHJcbiAgICBsZXQgcmVzcG9uc2UgPSBhd2FpdCBjb2xsZWN0aW9uTWFuYWdlci5tb2RpZnlHYW1lSW5Db2xsZWN0aW9uKHRlc3RHYW1lLCB0ZXN0V2lzaGxpc3QpO1xyXG4gICAgZXhwZWN0KHJlc3BvbnNlKS50b0VxdWFsKFt0ZXN0R2FtZV0pO1xyXG59KTtcclxuXHJcbnRlc3QoXCJnZXRDb2xsZWN0aW9uXCIsIGFzeW5jICgpID0+IHtcclxuICAgIGxldCBwYXJ0aXRpb25LZXkgPSAnW1VzZXJdI1tlcmlrY2hhdWxrXSc7XHJcbiAgICBsZXQgc29ydEtleSA9ICdbQ29sbGVjdGlvbkl0ZW1dI1tXaXNobGlzdF0jW0dhbWVJdGVtXSNbU3VwZXIgTWFyaW9dJztcclxuICAgIGxldCB0ZXN0R2FtZSA9IG5ldyBnYW1lT2JqZWN0LkdhbWUocGFydGl0aW9uS2V5LCBzb3J0S2V5LCAnU3VwZXIgTWFyaW8nLCAxOTkzLCAnQWN0aW9uLUFkdmVudHVyZScsICdOaW50ZW5kbyA2NCcsICdOaW50ZW5kbycsICdsb29zZScpO1xyXG4gICAgbGV0IHVzZXJJRCA9ICdlcmlrY2hhdWxrJztcclxuICAgIGxldCB0ZXN0V2lzaGxpc3QgPSBuZXcgd2lzaGxpc3QuV2lzaGxpc3QodXNlcklEKTtcclxuICAgIGxldCByZXNwb25zZSA9IGF3YWl0IGNvbGxlY3Rpb25NYW5hZ2VyLmdldENvbGxlY3Rpb24odGVzdFdpc2hsaXN0KTtcclxuICAgIGV4cGVjdChyZXNwb25zZSkudG9FcXVhbChbdGVzdEdhbWVdKTtcclxufSk7XHJcblxyXG50ZXN0KFwiY29sbGVjdGlvbkVycm9yXCIsIGFzeW5jICgpID0+IHtcclxuICAgIGxldCBjb2xsZWN0aW9uRXJyb3IgPSBuZXcgY29sbGVjdGlvbkVycm9ySGFuZGxlci5Db2xsZWN0aW9uRXJyb3IoXCJHYW1lIG5vdCBmb3VuZCBpbiB0aGUgY29sbGVjdGlvbi5cIiwgNDA0KTtcclxuICAgIGV4cGVjdChjb2xsZWN0aW9uRXJyb3IubWVzc2FnZSkudG9FcXVhbCgnQ29sbGVjdGlvbiBlcnJvciwgZGF0YXN0b3JlIHJlc3BvbnNlOiBHYW1lIG5vdCBmb3VuZCBpbiB0aGUgY29sbGVjdGlvbi4nKTtcclxuICAgIGV4cGVjdChjb2xsZWN0aW9uRXJyb3Iuc3RhdHVzQ29kZSkudG9FcXVhbCg0MDQpO1xyXG59KTtcclxuIl19