"use strict";
const game = require("../functions/game");
const gameManager = require("../functions/gameManager");
const index = require("../functions/index");
const error = require("../functions/gameErrorHandler");
test("CreateGame", async () => {
    let testGame = new game.Game('erikchaulk', 'League of Legends', 2008, 'Moba', 'PC', 'Riot Games');
    let response = await testGame.createGame();
    expect(response).toEqual(testGame);
});
test("GetGame", async () => {
    let testGame = new game.Game('erikchaulk', 'League of Legends', 2008, 'Moba', 'PC', 'Riot Games');
    let response = await gameManager.getGame(testGame);
    expect(response).toEqual(testGame);
});
test("ModifyGame", async () => {
    let testGame = new game.Game('erikchaulk', 'League of Legends', 2010, 'Moba', 'PC', 'Riot Games');
    let response = await gameManager.modifyGame(testGame);
    expect(response).toEqual(testGame);
});
test("DeleteGame", async () => {
    let testGame = new game.Game('erikchaulk', 'League of Legends', 2010, 'Moba', 'PC', 'Riot Games');
    let response = await gameManager.deleteGame(testGame);
    expect(response).toEqual(testGame);
});
test("serializeDynamoResponse", async () => {
    let dynamoResponse = {
        'userID': 'erikchaulk',
        'gameName': 'League of Legends',
        'yearReleased': 2010,
        'genre': 'Moba',
        'console': 'PC',
        'developer': 'Riot Games'
    };
    let response = gameManager.serializeDynamoResponse(dynamoResponse);
    let testGame = new game.Game('erikchaulk', 'League of Legends', 2010, 'Moba', 'PC', 'Riot Games');
    expect(response).toEqual(testGame);
});
test("gameErrorHandler", async () => {
    let testError = new error.GameError('Game not found', 404);
    expect(testError.message).toEqual("Game error, datastore response: Game not found");
    expect(testError.statusCode).toEqual(404);
});
test("createGameHttpResponse", async () => {
    let testGame = new game.Game('erikchaulk', 'League of Legends', 2010, 'Moba', 'PC', 'Riot Games');
    let response = await index.createGameHttpResponse(testGame);
    expect(response).toEqual(index.httpResponse({ statusCode: 200, body: JSON.stringify(testGame) }));
});
//Game already created
test("createGameHttpResponse", async () => {
    let testGame = new game.Game('erikchaulk', 'League of Legends', 2010, 'Moba', 'PC', 'Riot Games');
    let response = await index.createGameHttpResponse(testGame);
    expect(response).toEqual(index.httpResponse({ statusCode: 400, body: "Game error, datastore response: The conditional request failed" }));
});
test("getGameHttpResponse", async () => {
    let testGame = new game.Game('erikchaulk', 'League of Legends', 2010, 'Moba', 'PC', 'Riot Games');
    let response = await index.getGameHttpResponse(testGame);
    expect(response).toEqual(index.httpResponse({ statusCode: 200, body: JSON.stringify(testGame) }));
});
test("listGamesHttpResponse", async () => {
    let testGame = new game.Game('erikchaulk', 'League of Legends', 2010, 'Moba', 'PC', 'Riot Games');
    let secondTestGame = new game.Game('erikchaulk', 'Magic: The Gathering', 2019, 'Trading Card Game', 'PC', 'Wizards of the Coast');
    let gameArray = [];
    gameArray.push(testGame, secondTestGame);
    let userID = 'erikchaulk';
    await secondTestGame.createGame();
    let response = await index.listGamesHttpResponse(userID);
    expect(response).toEqual(index.httpResponse({ statusCode: 200, body: JSON.stringify(gameArray) }));
});
test("modifyGameHttpResponse", async () => {
    let testGame = new game.Game('erikchaulk', 'League of Legends', 2008, 'Moba', 'PC', 'Riot Games');
    let response = await index.modifyGameHttpResponse(testGame);
    expect(response).toEqual(index.httpResponse({ statusCode: 200, body: JSON.stringify(testGame) }));
});
//Modify a game that doesn't exist
test("modifyGameHttpResponse", async () => {
    let testGame = new game.Game('erikchaulk', 'The Witness', 2016, 'Strategy', 'PC', 'Valve');
    let response = await index.modifyGameHttpResponse(testGame);
    expect(response).toEqual(index.httpResponse({ statusCode: 400, body: "Game error, datastore response: Unable to modify game." }));
});
test("deleteGameHttpResponse", async () => {
    let testGame = new game.Game('erikchaulk', 'League of Legends', 2008, 'Moba', 'PC', 'Riot Games');
    let response = await index.deleteGameHttpResponse(testGame);
    expect(response).toEqual(index.httpResponse({ statusCode: 200, body: JSON.stringify(testGame) }));
});
//Delete a game that doesn't exist
test("deleteGameHttpResponse", async () => {
    let testGame = new game.Game('erikchaulk', 'The Witness', 2016, 'Strategy', 'PC', 'Valve');
    let response = await index.deleteGameHttpResponse(testGame);
    expect(response).toEqual(index.httpResponse({ statusCode: 400, body: "Game error, datastore response: Unable to delete game." }));
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZnVuY3Rpb25zLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJmdW5jdGlvbnMudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsTUFBTSxJQUFJLEdBQUcsT0FBTyxDQUFDLG1CQUFtQixDQUFDLENBQUM7QUFDMUMsTUFBTSxXQUFXLEdBQUcsT0FBTyxDQUFDLDBCQUEwQixDQUFDLENBQUM7QUFDeEQsTUFBTSxLQUFLLEdBQUcsT0FBTyxDQUFDLG9CQUFvQixDQUFDLENBQUM7QUFDNUMsTUFBTSxLQUFLLEdBQUcsT0FBTyxDQUFDLCtCQUErQixDQUFDLENBQUE7QUFFdEQsSUFBSSxDQUFDLFlBQVksRUFBRSxLQUFLLElBQUksRUFBRTtJQUMxQixJQUFJLFFBQVEsR0FBRyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLG1CQUFtQixFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLFlBQVksQ0FBQyxDQUFDO0lBQ2xHLElBQUksUUFBUSxHQUFHLE1BQU0sUUFBUSxDQUFDLFVBQVUsRUFBRSxDQUFDO0lBQzNDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDdkMsQ0FBQyxDQUFDLENBQUM7QUFFSCxJQUFJLENBQUMsU0FBUyxFQUFFLEtBQUssSUFBSSxFQUFFO0lBQ3ZCLElBQUksUUFBUSxHQUFHLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsbUJBQW1CLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsWUFBWSxDQUFDLENBQUM7SUFDbEcsSUFBSSxRQUFRLEdBQUcsTUFBTSxXQUFXLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ25ELE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDdkMsQ0FBQyxDQUFDLENBQUM7QUFFSCxJQUFJLENBQUMsWUFBWSxFQUFF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QUFDLEVBQUMsVUFBVSxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsd0RBQXdELEVBQUMsQ0FBQyxDQUFDLENBQUM7QUFDcEksQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBnYW1lID0gcmVxdWlyZShcIi4uL2Z1bmN0aW9ucy9nYW1lXCIpO1xyXG5jb25zdCBnYW1lTWFuYWdlciA9IHJlcXVpcmUoXCIuLi9mdW5jdGlvbnMvZ2FtZU1hbmFnZXJcIik7XHJcbmNvbnN0IGluZGV4ID0gcmVxdWlyZShcIi4uL2Z1bmN0aW9ucy9pbmRleFwiKTtcclxuY29uc3QgZXJyb3IgPSByZXF1aXJlKFwiLi4vZnVuY3Rpb25zL2dhbWVFcnJvckhhbmRsZXJcIilcclxuXHJcbnRlc3QoXCJDcmVhdGVHYW1lXCIsIGFzeW5jICgpID0+IHtcclxuICAgIGxldCB0ZXN0R2FtZSA9IG5ldyBnYW1lLkdhbWUoJ2VyaWtjaGF1bGsnLCAnTGVhZ3VlIG9mIExlZ2VuZHMnLCAyMDA4LCAnTW9iYScsICdQQycsICdSaW90IEdhbWVzJyk7XHJcbiAgICBsZXQgcmVzcG9uc2UgPSBhd2FpdCB0ZXN0R2FtZS5jcmVhdGVHYW1lKCk7XHJcbiAgICBleHBlY3QocmVzcG9uc2UpLnRvRXF1YWwodGVzdEdhbWUpO1xyXG59KTtcclxuXHJcbnRlc3QoXCJHZXRHYW1lXCIsIGFzeW5jICgpID0+IHtcclxuICAgIGxldCB0ZXN0R2FtZSA9IG5ldyBnYW1lLkdhbWUoJ2VyaWtjaGF1bGsnLCAnTGVhZ3VlIG9mIExlZ2VuZHMnLCAyMDA4LCAnTW9iYScsICdQQycsICdSaW90IEdhbWVzJyk7XHJcbiAgICBsZXQgcmVzcG9uc2UgPSBhd2FpdCBnYW1lTWFuYWdlci5nZXRHYW1lKHRlc3RHYW1lKTtcclxuICAgIGV4cGVjdChyZXNwb25zZSkudG9FcXVhbCh0ZXN0R2FtZSk7XHJcbn0pO1xyXG5cclxudGVzdChcIk1vZGlmeUdhbWVcIiwgYXN5bmMgKCkgPT4ge1xyXG4gICAgbGV0IHRlc3RHYW1lID0gbmV3IGdhbWUuR2FtZSgnZXJpa2NoYXVsaycsICdMZWFndWUgb2YgTGVnZW5kcycsIDIwMTAsICdNb2JhJywgJ1BDJywgJ1Jpb3QgR2FtZXMnKTtcclxuICAgIGxldCByZXNwb25zZSA9IGF3YWl0IGdhbWVNYW5hZ2VyLm1vZGlmeUdhbWUodGVzdEdhbWUpO1xyXG4gICAgZXhwZWN0KHJlc3BvbnNlKS50b0VxdWFsKHRlc3RHYW1lKTtcclxufSk7XHJcblxyXG50ZXN0KFwiRGVsZXRlR2FtZVwiLCBhc3luYyAoKSA9PiB7XHJcbiAgICBsZXQgdGVzdEdhbWUgPSBuZXcgZ2FtZS5HYW1lKCdlcmlrY2hhdWxrJywgJ0xlYWd1ZSBvZiBMZWdlbmRzJywgMjAxMCwgJ01vYmEnLCAnUEMnLCAnUmlvdCBHYW1lcycpO1xyXG4gICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgZ2FtZU1hbmFnZXIuZGVsZXRlR2FtZSh0ZXN0R2FtZSk7XHJcbiAgICBleHBlY3QocmVzcG9uc2UpLnRvRXF1YWwodGVzdEdhbWUpO1xyXG59KTtcclxuXHJcbnRlc3QoXCJzZXJpYWxpemVEeW5hbW9SZXNwb25zZVwiLCBhc3luYyAoKSA9PiB7XHJcbiAgICBsZXQgZHluYW1vUmVzcG9uc2UgPSB7XHJcbiAgICAgICAgJ3VzZXJJRCc6J2VyaWtjaGF1bGsnLFxyXG4gICAgICAgICdnYW1lTmFtZSc6J0xlYWd1ZSBvZiBMZWdlbmRzJyxcclxuICAgICAgICAneWVhclJlbGVhc2VkJzoyMDEwLFxyXG4gICAgICAgICdnZW5yZSc6J01vYmEnLFxyXG4gICAgICAgICdjb25zb2xlJzonUEMnLFxyXG4gICAgICAgICdkZXZlbG9wZXInOidSaW90IEdhbWVzJ1xyXG4gICAgfVxyXG4gICAgbGV0IHJlc3BvbnNlID0gZ2FtZU1hbmFnZXIuc2VyaWFsaXplRHluYW1vUmVzcG9uc2UoZHluYW1vUmVzcG9uc2UpO1xyXG4gICAgbGV0IHRlc3RHYW1lID0gbmV3IGdhbWUuR2FtZSgnZXJpa2NoYXVsaycsICdMZWFndWUgb2YgTGVnZW5kcycsIDIwMTAsICdNb2JhJywgJ1BDJywgJ1Jpb3QgR2FtZXMnKTtcclxuICAgIGV4cGVjdChyZXNwb25zZSkudG9FcXVhbCh0ZXN0R2FtZSk7XHJcbn0pO1xyXG5cclxudGVzdChcImdhbWVFcnJvckhhbmRsZXJcIiwgYXN5bmMgKCkgPT4ge1xyXG4gICAgbGV0IHRlc3RFcnJvciA9IG5ldyBlcnJvci5HYW1lRXJyb3IoJ0dhbWUgbm90IGZvdW5kJywgNDA0KTtcclxuICAgIGV4cGVjdCh0ZXN0RXJyb3IubWVzc2FnZSkudG9FcXVhbChcIkdhbWUgZXJyb3IsIGRhdGFzdG9yZSByZXNwb25zZTogR2FtZSBub3QgZm91bmRcIik7XHJcbiAgICBleHBlY3QodGVzdEVycm9yLnN0YXR1c0NvZGUpLnRvRXF1YWwoNDA0KTsgICAgXHJcbn0pO1xyXG5cclxudGVzdChcImNyZWF0ZUdhbWVIdHRwUmVzcG9uc2VcIiwgYXN5bmMgKCkgPT4ge1xyXG4gICAgbGV0IHRlc3RHYW1lID0gbmV3IGdhbWUuR2FtZSgnZXJpa2NoYXVsaycsICdMZWFndWUgb2YgTGVnZW5kcycsIDIwMTAsICdNb2JhJywgJ1BDJywgJ1Jpb3QgR2FtZXMnKTtcclxuICAgIGxldCByZXNwb25zZSA9IGF3YWl0IGluZGV4LmNyZWF0ZUdhbWVIdHRwUmVzcG9uc2UodGVzdEdhbWUpO1xyXG4gICAgZXhwZWN0KHJlc3BvbnNlKS50b0VxdWFsKGluZGV4Lmh0dHBSZXNwb25zZSh7c3RhdHVzQ29kZTogMjAwLCBib2R5OiBKU09OLnN0cmluZ2lmeSh0ZXN0R2FtZSl9KSk7XHJcbn0pO1xyXG5cclxuLy9HYW1lIGFscmVhZHkgY3JlYXRlZFxyXG50ZXN0KFwiY3JlYXRlR2FtZUh0dHBSZXNwb25zZVwiLCBhc3luYyAoKSA9PiB7XHJcbiAgICBsZXQgdGVzdEdhbWUgPSBuZXcgZ2FtZS5HYW1lKCdlcmlrY2hhdWxrJywgJ0xlYWd1ZSBvZiBMZWdlbmRzJywgMjAxMCwgJ01vYmEnLCAnUEMnLCAnUmlvdCBHYW1lcycpO1xyXG4gICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgaW5kZXguY3JlYXRlR2FtZUh0dHBSZXNwb25zZSh0ZXN0R2FtZSk7XHJcbiAgICBleHBlY3QocmVzcG9uc2UpLnRvRXF1YWwoaW5kZXguaHR0cFJlc3BvbnNlKHtzdGF0dXNDb2RlOiA0MDAsIGJvZHk6IFwiR2FtZSBlcnJvciwgZGF0YXN0b3JlIHJlc3BvbnNlOiBUaGUgY29uZGl0aW9uYWwgcmVxdWVzdCBmYWlsZWRcIn0pKTtcclxufSk7XHJcblxyXG50ZXN0KFwiZ2V0R2FtZUh0dHBSZXNwb25zZVwiLCBhc3luYyAoKSA9PiB7XHJcbiAgICBsZXQgdGVzdEdhbWUgPSBuZXcgZ2FtZS5HYW1lKCdlcmlrY2hhdWxrJywgJ0xlYWd1ZSBvZiBMZWdlbmRzJywgMjAxMCwgJ01vYmEnLCAnUEMnLCAnUmlvdCBHYW1lcycpO1xyXG4gICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgaW5kZXguZ2V0R2FtZUh0dHBSZXNwb25zZSh0ZXN0R2FtZSk7XHJcbiAgICBleHBlY3QocmVzcG9uc2UpLnRvRXF1YWwoaW5kZXguaHR0cFJlc3BvbnNlKHtzdGF0dXNDb2RlOiAyMDAsIGJvZHk6IEpTT04uc3RyaW5naWZ5KHRlc3RHYW1lKX0pKTtcclxufSk7XHJcblxyXG50ZXN0KFwibGlzdEdhbWVzSHR0cFJlc3BvbnNlXCIsIGFzeW5jICgpID0+IHtcclxuICAgIGxldCB0ZXN0R2FtZSA9IG5ldyBnYW1lLkdhbWUoJ2VyaWtjaGF1bGsnLCAnTGVhZ3VlIG9mIExlZ2VuZHMnLCAyMDEwLCAnTW9iYScsICdQQycsICdSaW90IEdhbWVzJyk7XHJcbiAgICBsZXQgc2Vjb25kVGVzdEdhbWUgPSBuZXcgZ2FtZS5HYW1lKCdlcmlrY2hhdWxrJywgJ01hZ2ljOiBUaGUgR2F0aGVyaW5nJywgMjAxOSwgJ1RyYWRpbmcgQ2FyZCBHYW1lJywgJ1BDJywgJ1dpemFyZHMgb2YgdGhlIENvYXN0Jyk7XHJcbiAgICBsZXQgZ2FtZUFycmF5ID0gW107XHJcbiAgICBnYW1lQXJyYXkucHVzaCh0ZXN0R2FtZSwgc2Vjb25kVGVzdEdhbWUpO1xyXG4gICAgbGV0IHVzZXJJRCA9ICdlcmlrY2hhdWxrJ1xyXG4gICAgYXdhaXQgc2Vjb25kVGVzdEdhbWUuY3JlYXRlR2FtZSgpO1xyXG4gICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgaW5kZXgubGlzdEdhbWVzSHR0cFJlc3BvbnNlKHVzZXJJRCk7XHJcbiAgICBleHBlY3QocmVzcG9uc2UpLnRvRXF1YWwoaW5kZXguaHR0cFJlc3BvbnNlKHtzdGF0dXNDb2RlOiAyMDAsIGJvZHk6IEpTT04uc3RyaW5naWZ5KGdhbWVBcnJheSl9KSk7XHJcbn0pO1xyXG5cclxudGVzdChcIm1vZGlmeUdhbWVIdHRwUmVzcG9uc2VcIiwgYXN5bmMgKCkgPT4ge1xyXG4gICAgbGV0IHRlc3RHYW1lID0gbmV3IGdhbWUuR2FtZSgnZXJpa2NoYXVsaycsICdMZWFndWUgb2YgTGVnZW5kcycsIDIwMDgsICdNb2JhJywgJ1BDJywgJ1Jpb3QgR2FtZXMnKTtcclxuICAgIGxldCByZXNwb25zZSA9IGF3YWl0IGluZGV4Lm1vZGlmeUdhbWVIdHRwUmVzcG9uc2UodGVzdEdhbWUpO1xyXG4gICAgZXhwZWN0KHJlc3BvbnNlKS50b0VxdWFsKGluZGV4Lmh0dHBSZXNwb25zZSh7c3RhdHVzQ29kZTogMjAwLCBib2R5OiBKU09OLnN0cmluZ2lmeSh0ZXN0R2FtZSl9KSk7XHJcbn0pO1xyXG5cclxuLy9Nb2RpZnkgYSBnYW1lIHRoYXQgZG9lc24ndCBleGlzdFxyXG50ZXN0KFwibW9kaWZ5R2FtZUh0dHBSZXNwb25zZVwiLCBhc3luYyAoKSA9PiB7XHJcbiAgICBsZXQgdGVzdEdhbWUgPSBuZXcgZ2FtZS5HYW1lKCdlcmlrY2hhdWxrJywgJ1RoZSBXaXRuZXNzJywgMjAxNiwgJ1N0cmF0ZWd5JywgJ1BDJywgJ1ZhbHZlJyk7XHJcbiAgICBsZXQgcmVzcG9uc2UgPSBhd2FpdCBpbmRleC5tb2RpZnlHYW1lSHR0cFJlc3BvbnNlKHRlc3RHYW1lKTtcclxuICAgIGV4cGVjdChyZXNwb25zZSkudG9FcXVhbChpbmRleC5odHRwUmVzcG9uc2Uoe3N0YXR1c0NvZGU6IDQwMCwgYm9keTogXCJHYW1lIGVycm9yLCBkYXRhc3RvcmUgcmVzcG9uc2U6IFVuYWJsZSB0byBtb2RpZnkgZ2FtZS5cIn0pKTtcclxufSk7XHJcblxyXG50ZXN0KFwiZGVsZXRlR2FtZUh0dHBSZXNwb25zZVwiLCBhc3luYyAoKSA9PiB7XHJcbiAgICBsZXQgdGVzdEdhbWUgPSBuZXcgZ2FtZS5HYW1lKCdlcmlrY2hhdWxrJywgJ0xlYWd1ZSBvZiBMZWdlbmRzJywgMjAwOCwgJ01vYmEnLCAnUEMnLCAnUmlvdCBHYW1lcycpO1xyXG4gICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgaW5kZXguZGVsZXRlR2FtZUh0dHBSZXNwb25zZSh0ZXN0R2FtZSk7XHJcbiAgICBleHBlY3QocmVzcG9uc2UpLnRvRXF1YWwoaW5kZXguaHR0cFJlc3BvbnNlKHtzdGF0dXNDb2RlOiAyMDAsIGJvZHk6IEpTT04uc3RyaW5naWZ5KHRlc3RHYW1lKX0pKTtcclxufSk7XHJcblxyXG4vL0RlbGV0ZSBhIGdhbWUgdGhhdCBkb2Vzbid0IGV4aXN0XHJcbnRlc3QoXCJkZWxldGVHYW1lSHR0cFJlc3BvbnNlXCIsIGFzeW5jICgpID0+IHtcclxuICAgIGxldCB0ZXN0R2FtZSA9IG5ldyBnYW1lLkdhbWUoJ2VyaWtjaGF1bGsnLCAnVGhlIFdpdG5lc3MnLCAyMDE2LCAnU3RyYXRlZ3knLCAnUEMnLCAnVmFsdmUnKTtcclxuICAgIGxldCByZXNwb25zZSA9IGF3YWl0IGluZGV4LmRlbGV0ZUdhbWVIdHRwUmVzcG9uc2UodGVzdEdhbWUpO1xyXG4gICAgZXhwZWN0KHJlc3BvbnNlKS50b0VxdWFsKGluZGV4Lmh0dHBSZXNwb25zZSh7c3RhdHVzQ29kZTogNDAwLCBib2R5OiBcIkdhbWUgZXJyb3IsIGRhdGFzdG9yZSByZXNwb25zZTogVW5hYmxlIHRvIGRlbGV0ZSBnYW1lLlwifSkpO1xyXG59KTsiXX0=