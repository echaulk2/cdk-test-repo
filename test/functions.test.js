"use strict";
const game = require("../functions/models/game");
const gameManager = require("../functions/dataManager/gameManager");
const index = require("../functions/index");
const error = require("../functions/error/gameErrorHandler");
const common = require("../functions/shared/common/game");
test("CreateGame", async () => {
    let partitionKey = '[User]#[${erikchaulk}]';
    let sortKey = '[GameItem]#[League of Legends]';
    let testCreateGame = new game.Game(partitionKey, sortKey, 'League of Legends', 2008, 'Moba', 'PC', 'Riot Games');
    let response = await gameManager.createGame(testCreateGame);
    expect(response).toEqual(testCreateGame);
});
test("GetGame", async () => {
    let partitionKey = '[User]#[${erikchaulk}]';
    let sortKey = '[GameItem]#[League of Legends]';
    let testGetGame = new game.Game(partitionKey, sortKey, 'League of Legends', 2008, 'Moba', 'PC', 'Riot Games');
    let response = await gameManager.getGame(testGetGame);
    expect(response).toEqual(testGetGame);
});
test("ModifyGame", async () => {
    let partitionKey = '[User]#[${erikchaulk}]';
    let sortKey = '[GameItem]#[League of Legends]';
    let testModifyGame = new game.Game(partitionKey, sortKey, 'League of Legends', 2010, 'Moba', 'PC', 'Riot Games');
    let response = await gameManager.modifyGame(testModifyGame);
    expect(response).toEqual(testModifyGame);
});
test("DeleteGame", async () => {
    let partitionKey = '[User]#[${erikchaulk}]';
    let sortKey = '[GameItem]#[League of Legends]';
    let testDeleteGame = new game.Game(partitionKey, sortKey, 'League of Legends', 2010, 'Moba', 'PC', 'Riot Games');
    let response = await gameManager.deleteGame(testDeleteGame);
    expect(response).toEqual(testDeleteGame);
});
test("serializeDynamoResponse", async () => {
    let partitionKey = '[User]#[${erikchaulk}]';
    let sortKey = '[GameItem]#[League of Legends]';
    let dynamoResponse = {
        'partitionKey': partitionKey,
        'sortKey': sortKey,
        'gameName': 'League of Legends',
        'yearReleased': 2010,
        'genre': 'Moba',
        'console': 'PC',
        'developer': 'Riot Games'
    };
    let response = common.serializeDynamoResponse(dynamoResponse);
    let testDynamoResponse = new game.Game(partitionKey, sortKey, 'League of Legends', 2010, 'Moba', 'PC', 'Riot Games');
    expect(response).toEqual(testDynamoResponse);
});
test("gameErrorHandler", async () => {
    let testError = new error.GameError('Game not found', 404);
    expect(testError.message).toEqual("Game error, datastore response: Game not found");
    expect(testError.statusCode).toEqual(404);
});
test("createGameHttpResponse", async () => {
    let partitionKey = '[User]#[${erikchaulk}]';
    let sortKey = '[GameItem]#[League of Legends]';
    let testGame = new game.Game(partitionKey, sortKey, 'League of Legends', 2010, 'Moba', 'PC', 'Riot Games');
    let response = await index.createGameHttpResponse(testGame);
    expect(response).toEqual(index.httpResponse({ statusCode: 200, body: JSON.stringify(testGame) }));
});
//Game already created
test("createGameHttpResponse", async () => {
    let partitionKey = '[User]#[${erikchaulk}]';
    let sortKey = '[GameItem]#[League of Legends]';
    let testGame = new game.Game(partitionKey, sortKey, 'League of Legends', 2010, 'Moba', 'PC', 'Riot Games');
    let response = await index.createGameHttpResponse(testGame);
    expect(response).toEqual(index.httpResponse({ statusCode: 400, body: "Game error, datastore response: The conditional request failed" }));
});
test("getGameHttpResponse", async () => {
    let partitionKey = '[User]#[${erikchaulk}]';
    let sortKey = '[GameItem]#[League of Legends]';
    let testGame = new game.Game(partitionKey, sortKey, 'League of Legends', 2010, 'Moba', 'PC', 'Riot Games');
    let response = await index.getGameHttpResponse(testGame);
    expect(response).toEqual(index.httpResponse({ statusCode: 200, body: JSON.stringify(testGame) }));
});
test("modifyGameHttpResponse", async () => {
    let partitionKey = '[User]#[${erikchaulk}]';
    let sortKey = '[GameItem]#[League of Legends]';
    let testGame = new game.Game(partitionKey, sortKey, 'League of Legends', 2012, 'Moba', 'PC', 'Riot Games');
    let response = await index.modifyGameHttpResponse(testGame);
    expect(response).toEqual(index.httpResponse({ statusCode: 200, body: JSON.stringify(testGame) }));
});
//Modify a game that doesn't exist
test("modifyGameHttpResponse", async () => {
    let partitionKey = '[User]#[${erikchaulk}]';
    let sortKey = '[GameItem]#[The Witness]';
    let testGame = new game.Game(partitionKey, sortKey, 'The Witness', 2016, 'Strategy', 'PC', 'Valve');
    let response = await index.modifyGameHttpResponse(testGame);
    expect(response).toEqual(index.httpResponse({ statusCode: 400, body: "Game error, datastore response: Unable to modify game." }));
});
test("deleteGameHttpResponse", async () => {
    let partitionKey = '[User]#[${erikchaulk}]';
    let sortKey = '[GameItem]#[League of Legends]';
    let testGame = new game.Game(partitionKey, sortKey, 'League of Legends', 2012, 'Moba', 'PC', 'Riot Games');
    let response = await index.deleteGameHttpResponse(testGame);
    expect(response).toEqual(index.httpResponse({ statusCode: 200, body: JSON.stringify(testGame) }));
});
//Delete a game that doesn't exist
test("deleteGameHttpResponse", async () => {
    let partitionKey = '[User]#[${erikchaulk}]';
    let sortKey = '[GameItem]#[The Witness]';
    let testGame = new game.Game(partitionKey, sortKey, 'The Witness', 2016, 'Strategy', 'PC', 'Valve');
    let response = await index.deleteGameHttpResponse(testGame);
    expect(response).toEqual(index.httpResponse({ statusCode: 400, body: "Game error, datastore response: Unable to delete game." }));
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZnVuY3Rpb25zLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJmdW5jdGlvbnMudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsTUFBTSxJQUFJLEdBQUcsT0FBTyxDQUFDLDBCQUEwQixDQUFDLENBQUM7QUFDakQsTUFBTSxXQUFXLEdBQUcsT0FBTyxDQUFDLHNDQUFzQyxDQUFDLENBQUM7QUFDcEUsTUFBTSxLQUFLLEdBQUcsT0FBTyxDQUFDLG9CQUFvQixDQUFDLENBQUM7QUFDNUMsTUFBTSxLQUFLLEdBQUcsT0FBTyxDQUFDLHFDQUFxQyxDQUFDLENBQUE7QUFDNUQsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLGlDQUFpQyxDQUFDLENBQUM7QUFFMUQsSUFBSSxDQUFDLFlBQVksRUFBRSxLQUFLLElBQUksRUFBRTtJQUMxQixJQUFJLFlBQVksR0FBRyx3QkFBd0IsQ0FBQTtJQUMzQyxJQUFJLE9BQU8sR0FBRyxnQ0FBZ0MsQ0FBQTtJQUM5QyxJQUFJLGNBQWMsR0FBRyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxZQUFZLENBQUMsQ0FBQztJQUNqSCxJQUFJLFFBQVEsR0FBRyxNQUFNLFdBQVcsQ0FBQyxVQUFVLENBQUMsY0FBYyxDQUFDLENBQUM7SUFDNUQsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxjQUFjLENBQUMsQ0FBQztBQUM3QyxDQUFDLENBQUMsQ0FBQztBQUVILElBQUksQ0FBQyxTQUFTLEVBQUUsS0FBSyxJQUFJLEVBQUU7SUFDdkIsSUFBSSxZQUFZLEdBQUcsd0JBQXdCLENBQUE7SUFDM0MsSUFBSSxPQUFPLEdBQUcsZ0NBQWdDLENBQUE7SUFDOUMsSUFBSSxXQUFXLEdBQUcsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxPQUFPLEVBQUUsbUJBQW1CLEVB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SUFBSSxDQUFDLHdCQUF3QixFQUFFLEtBQUssSUFBSSxFQUFFO0lBQ3RDLElBQUksWUFBWSxHQUFHLHdCQUF3QixDQUFDO0lBQzVDLElBQUksT0FBTyxHQUFHLDBCQUEwQixDQUFDO0lBQ3pDLElBQUksUUFBUSxHQUFHLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsT0FBTyxFQUFFLGFBQWEsRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBRSxPQUFPLENBQUMsQ0FBQztJQUNwRyxJQUFJLFFBQVEsR0FBRyxNQUFNLEtBQUssQ0FBQyxzQkFBc0IsQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUM1RCxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsRUFBQyxVQUFVLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSx3REFBd0QsRUFBQyxDQUFDLENBQUMsQ0FBQztBQUNwSSxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGdhbWUgPSByZXF1aXJlKFwiLi4vZnVuY3Rpb25zL21vZGVscy9nYW1lXCIpO1xyXG5jb25zdCBnYW1lTWFuYWdlciA9IHJlcXVpcmUoXCIuLi9mdW5jdGlvbnMvZGF0YU1hbmFnZXIvZ2FtZU1hbmFnZXJcIik7XHJcbmNvbnN0IGluZGV4ID0gcmVxdWlyZShcIi4uL2Z1bmN0aW9ucy9pbmRleFwiKTtcclxuY29uc3QgZXJyb3IgPSByZXF1aXJlKFwiLi4vZnVuY3Rpb25zL2Vycm9yL2dhbWVFcnJvckhhbmRsZXJcIilcclxuY29uc3QgY29tbW9uID0gcmVxdWlyZShcIi4uL2Z1bmN0aW9ucy9zaGFyZWQvY29tbW9uL2dhbWVcIik7XHJcblxyXG50ZXN0KFwiQ3JlYXRlR2FtZVwiLCBhc3luYyAoKSA9PiB7XHJcbiAgICBsZXQgcGFydGl0aW9uS2V5ID0gJ1tVc2VyXSNbJHtlcmlrY2hhdWxrfV0nXHJcbiAgICBsZXQgc29ydEtleSA9ICdbR2FtZUl0ZW1dI1tMZWFndWUgb2YgTGVnZW5kc10nXHJcbiAgICBsZXQgdGVzdENyZWF0ZUdhbWUgPSBuZXcgZ2FtZS5HYW1lKHBhcnRpdGlvbktleSwgc29ydEtleSwgJ0xlYWd1ZSBvZiBMZWdlbmRzJywgMjAwOCwgJ01vYmEnLCAnUEMnLCAnUmlvdCBHYW1lcycpO1xyXG4gICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgZ2FtZU1hbmFnZXIuY3JlYXRlR2FtZSh0ZXN0Q3JlYXRlR2FtZSk7XHJcbiAgICBleHBlY3QocmVzcG9uc2UpLnRvRXF1YWwodGVzdENyZWF0ZUdhbWUpO1xyXG59KTtcclxuXHJcbnRlc3QoXCJHZXRHYW1lXCIsIGFzeW5jICgpID0+IHtcclxuICAgIGxldCBwYXJ0aXRpb25LZXkgPSAnW1VzZXJdI1ske2VyaWtjaGF1bGt9XSdcclxuICAgIGxldCBzb3J0S2V5ID0gJ1tHYW1lSXRlbV0jW0xlYWd1ZSBvZiBMZWdlbmRzXSdcclxuICAgIGxldCB0ZXN0R2V0R2FtZSA9IG5ldyBnYW1lLkdhbWUocGFydGl0aW9uS2V5LCBzb3J0S2V5LCAnTGVhZ3VlIG9mIExlZ2VuZHMnLCAyMDA4LCAnTW9iYScsICdQQycsICdSaW90IEdhbWVzJyk7XHJcbiAgICBsZXQgcmVzcG9uc2UgPSBhd2FpdCBnYW1lTWFuYWdlci5nZXRHYW1lKHRlc3RHZXRHYW1lKTtcclxuICAgIGV4cGVjdChyZXNwb25zZSkudG9FcXVhbCh0ZXN0R2V0R2FtZSk7XHJcbn0pO1xyXG5cclxudGVzdChcIk1vZGlmeUdhbWVcIiwgYXN5bmMgKCkgPT4ge1xyXG4gICAgbGV0IHBhcnRpdGlvbktleSA9ICdbVXNlcl0jWyR7ZXJpa2NoYXVsa31dJ1xyXG4gICAgbGV0IHNvcnRLZXkgPSAnW0dhbWVJdGVtXSNbTGVhZ3VlIG9mIExlZ2VuZHNdJ1xyXG4gICAgbGV0IHRlc3RNb2RpZnlHYW1lID0gbmV3IGdhbWUuR2FtZShwYXJ0aXRpb25LZXksIHNvcnRLZXksICdMZWFndWUgb2YgTGVnZW5kcycsIDIwMTAsICdNb2JhJywgJ1BDJywgJ1Jpb3QgR2FtZXMnKTtcclxuICAgIGxldCByZXNwb25zZSA9IGF3YWl0IGdhbWVNYW5hZ2VyLm1vZGlmeUdhbWUodGVzdE1vZGlmeUdhbWUpO1xyXG4gICAgZXhwZWN0KHJlc3BvbnNlKS50b0VxdWFsKHRlc3RNb2RpZnlHYW1lKTtcclxufSk7XHJcblxyXG50ZXN0KFwiRGVsZXRlR2FtZVwiLCBhc3luYyAoKSA9PiB7XHJcbiAgICBsZXQgcGFydGl0aW9uS2V5ID0gJ1tVc2VyXSNbJHtlcmlrY2hhdWxrfV0nXHJcbiAgICBsZXQgc29ydEtleSA9ICdbR2FtZUl0ZW1dI1tMZWFndWUgb2YgTGVnZW5kc10nXHJcbiAgICBsZXQgdGVzdERlbGV0ZUdhbWUgPSBuZXcgZ2FtZS5HYW1lKHBhcnRpdGlvbktleSwgc29ydEtleSwgJ0xlYWd1ZSBvZiBMZWdlbmRzJywgMjAxMCwgJ01vYmEnLCAnUEMnLCAnUmlvdCBHYW1lcycpO1xyXG4gICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgZ2FtZU1hbmFnZXIuZGVsZXRlR2FtZSh0ZXN0RGVsZXRlR2FtZSk7XHJcbiAgICBleHBlY3QocmVzcG9uc2UpLnRvRXF1YWwodGVzdERlbGV0ZUdhbWUpO1xyXG59KTtcclxuXHJcbnRlc3QoXCJzZXJpYWxpemVEeW5hbW9SZXNwb25zZVwiLCBhc3luYyAoKSA9PiB7XHJcbiAgICBsZXQgcGFydGl0aW9uS2V5ID0gJ1tVc2VyXSNbJHtlcmlrY2hhdWxrfV0nXHJcbiAgICBsZXQgc29ydEtleSA9ICdbR2FtZUl0ZW1dI1tMZWFndWUgb2YgTGVnZW5kc10nXHJcbiAgICBsZXQgZHluYW1vUmVzcG9uc2UgPSB7XHJcbiAgICAgICAgJ3BhcnRpdGlvbktleSc6cGFydGl0aW9uS2V5LFxyXG4gICAgICAgICdzb3J0S2V5Jzogc29ydEtleSxcclxuICAgICAgICAnZ2FtZU5hbWUnOidMZWFndWUgb2YgTGVnZW5kcycsXHJcbiAgICAgICAgJ3llYXJSZWxlYXNlZCc6MjAxMCxcclxuICAgICAgICAnZ2VucmUnOidNb2JhJyxcclxuICAgICAgICAnY29uc29sZSc6J1BDJyxcclxuICAgICAgICAnZGV2ZWxvcGVyJzonUmlvdCBHYW1lcydcclxuICAgIH1cclxuICAgIGxldCByZXNwb25zZSA9IGNvbW1vbi5zZXJpYWxpemVEeW5hbW9SZXNwb25zZShkeW5hbW9SZXNwb25zZSk7XHJcbiAgICBsZXQgdGVzdER5bmFtb1Jlc3BvbnNlID0gbmV3IGdhbWUuR2FtZShwYXJ0aXRpb25LZXksIHNvcnRLZXksICdMZWFndWUgb2YgTGVnZW5kcycsIDIwMTAsICdNb2JhJywgJ1BDJywgJ1Jpb3QgR2FtZXMnKTtcclxuICAgIGV4cGVjdChyZXNwb25zZSkudG9FcXVhbCh0ZXN0RHluYW1vUmVzcG9uc2UpO1xyXG59KTtcclxuXHJcbnRlc3QoXCJnYW1lRXJyb3JIYW5kbGVyXCIsIGFzeW5jICgpID0+IHtcclxuICAgIGxldCB0ZXN0RXJyb3IgPSBuZXcgZXJyb3IuR2FtZUVycm9yKCdHYW1lIG5vdCBmb3VuZCcsIDQwNCk7XHJcbiAgICBleHBlY3QodGVzdEVycm9yLm1lc3NhZ2UpLnRvRXF1YWwoXCJHYW1lIGVycm9yLCBkYXRhc3RvcmUgcmVzcG9uc2U6IEdhbWUgbm90IGZvdW5kXCIpO1xyXG4gICAgZXhwZWN0KHRlc3RFcnJvci5zdGF0dXNDb2RlKS50b0VxdWFsKDQwNCk7ICAgIFxyXG59KTtcclxuXHJcbnRlc3QoXCJjcmVhdGVHYW1lSHR0cFJlc3BvbnNlXCIsIGFzeW5jICgpID0+IHtcclxuICAgIGxldCBwYXJ0aXRpb25LZXkgPSAnW1VzZXJdI1ske2VyaWtjaGF1bGt9XSdcclxuICAgIGxldCBzb3J0S2V5ID0gJ1tHYW1lSXRlbV0jW0xlYWd1ZSBvZiBMZWdlbmRzXSdcclxuICAgIGxldCB0ZXN0R2FtZSA9IG5ldyBnYW1lLkdhbWUocGFydGl0aW9uS2V5LCBzb3J0S2V5LCAnTGVhZ3VlIG9mIExlZ2VuZHMnLCAyMDEwLCAnTW9iYScsICdQQycsICdSaW90IEdhbWVzJyk7XHJcbiAgICBsZXQgcmVzcG9uc2UgPSBhd2FpdCBpbmRleC5jcmVhdGVHYW1lSHR0cFJlc3BvbnNlKHRlc3RHYW1lKTtcclxuICAgIGV4cGVjdChyZXNwb25zZSkudG9FcXVhbChpbmRleC5odHRwUmVzcG9uc2Uoe3N0YXR1c0NvZGU6IDIwMCwgYm9keTogSlNPTi5zdHJpbmdpZnkodGVzdEdhbWUpfSkpO1xyXG59KTtcclxuXHJcbi8vR2FtZSBhbHJlYWR5IGNyZWF0ZWRcclxudGVzdChcImNyZWF0ZUdhbWVIdHRwUmVzcG9uc2VcIiwgYXN5bmMgKCkgPT4ge1xyXG4gICAgbGV0IHBhcnRpdGlvbktleSA9ICdbVXNlcl0jWyR7ZXJpa2NoYXVsa31dJ1xyXG4gICAgbGV0IHNvcnRLZXkgPSAnW0dhbWVJdGVtXSNbTGVhZ3VlIG9mIExlZ2VuZHNdJ1xyXG4gICAgbGV0IHRlc3RHYW1lID0gbmV3IGdhbWUuR2FtZShwYXJ0aXRpb25LZXksIHNvcnRLZXksICdMZWFndWUgb2YgTGVnZW5kcycsIDIwMTAsICdNb2JhJywgJ1BDJywgJ1Jpb3QgR2FtZXMnKTtcclxuICAgIGxldCByZXNwb25zZSA9IGF3YWl0IGluZGV4LmNyZWF0ZUdhbWVIdHRwUmVzcG9uc2UodGVzdEdhbWUpO1xyXG4gICAgZXhwZWN0KHJlc3BvbnNlKS50b0VxdWFsKGluZGV4Lmh0dHBSZXNwb25zZSh7c3RhdHVzQ29kZTogNDAwLCBib2R5OiBcIkdhbWUgZXJyb3IsIGRhdGFzdG9yZSByZXNwb25zZTogVGhlIGNvbmRpdGlvbmFsIHJlcXVlc3QgZmFpbGVkXCJ9KSk7XHJcbn0pO1xyXG5cclxudGVzdChcImdldEdhbWVIdHRwUmVzcG9uc2VcIiwgYXN5bmMgKCkgPT4ge1xyXG4gICAgbGV0IHBhcnRpdGlvbktleSA9ICdbVXNlcl0jWyR7ZXJpa2NoYXVsa31dJ1xyXG4gICAgbGV0IHNvcnRLZXkgPSAnW0dhbWVJdGVtXSNbTGVhZ3VlIG9mIExlZ2VuZHNdJ1xyXG4gICAgbGV0IHRlc3RHYW1lID0gbmV3IGdhbWUuR2FtZShwYXJ0aXRpb25LZXksIHNvcnRLZXksICdMZWFndWUgb2YgTGVnZW5kcycsIDIwMTAsICdNb2JhJywgJ1BDJywgJ1Jpb3QgR2FtZXMnKTtcclxuICAgIGxldCByZXNwb25zZSA9IGF3YWl0IGluZGV4LmdldEdhbWVIdHRwUmVzcG9uc2UodGVzdEdhbWUpO1xyXG4gICAgZXhwZWN0KHJlc3BvbnNlKS50b0VxdWFsKGluZGV4Lmh0dHBSZXNwb25zZSh7c3RhdHVzQ29kZTogMjAwLCBib2R5OiBKU09OLnN0cmluZ2lmeSh0ZXN0R2FtZSl9KSk7XHJcbn0pO1xyXG5cclxudGVzdChcIm1vZGlmeUdhbWVIdHRwUmVzcG9uc2VcIiwgYXN5bmMgKCkgPT4ge1xyXG4gICAgbGV0IHBhcnRpdGlvbktleSA9ICdbVXNlcl0jWyR7ZXJpa2NoYXVsa31dJztcclxuICAgIGxldCBzb3J0S2V5ID0gJ1tHYW1lSXRlbV0jW0xlYWd1ZSBvZiBMZWdlbmRzXSc7XHJcbiAgICBsZXQgdGVzdEdhbWUgPSBuZXcgZ2FtZS5HYW1lKHBhcnRpdGlvbktleSwgc29ydEtleSwgJ0xlYWd1ZSBvZiBMZWdlbmRzJywgMjAxMiwgJ01vYmEnLCAnUEMnLCAnUmlvdCBHYW1lcycpO1xyXG4gICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgaW5kZXgubW9kaWZ5R2FtZUh0dHBSZXNwb25zZSh0ZXN0R2FtZSk7XHJcbiAgICBleHBlY3QocmVzcG9uc2UpLnRvRXF1YWwoaW5kZXguaHR0cFJlc3BvbnNlKHtzdGF0dXNDb2RlOiAyMDAsIGJvZHk6IEpTT04uc3RyaW5naWZ5KHRlc3RHYW1lKX0pKTtcclxufSk7XHJcblxyXG4vL01vZGlmeSBhIGdhbWUgdGhhdCBkb2Vzbid0IGV4aXN0XHJcbnRlc3QoXCJtb2RpZnlHYW1lSHR0cFJlc3BvbnNlXCIsIGFzeW5jICgpID0+IHtcclxuICAgIGxldCBwYXJ0aXRpb25LZXkgPSAnW1VzZXJdI1ske2VyaWtjaGF1bGt9XSc7XHJcbiAgICBsZXQgc29ydEtleSA9ICdbR2FtZUl0ZW1dI1tUaGUgV2l0bmVzc10nO1xyXG4gICAgbGV0IHRlc3RHYW1lID0gbmV3IGdhbWUuR2FtZShwYXJ0aXRpb25LZXksIHNvcnRLZXksICdUaGUgV2l0bmVzcycsIDIwMTYsICdTdHJhdGVneScsICdQQycsICdWYWx2ZScpO1xyXG4gICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgaW5kZXgubW9kaWZ5R2FtZUh0dHBSZXNwb25zZSh0ZXN0R2FtZSk7XHJcbiAgICBleHBlY3QocmVzcG9uc2UpLnRvRXF1YWwoaW5kZXguaHR0cFJlc3BvbnNlKHtzdGF0dXNDb2RlOiA0MDAsIGJvZHk6IFwiR2FtZSBlcnJvciwgZGF0YXN0b3JlIHJlc3BvbnNlOiBVbmFibGUgdG8gbW9kaWZ5IGdhbWUuXCJ9KSk7XHJcbn0pO1xyXG5cclxudGVzdChcImRlbGV0ZUdhbWVIdHRwUmVzcG9uc2VcIiwgYXN5bmMgKCkgPT4ge1xyXG4gICAgbGV0IHBhcnRpdGlvbktleSA9ICdbVXNlcl0jWyR7ZXJpa2NoYXVsa31dJztcclxuICAgIGxldCBzb3J0S2V5ID0gJ1tHYW1lSXRlbV0jW0xlYWd1ZSBvZiBMZWdlbmRzXSc7XHJcbiAgICBsZXQgdGVzdEdhbWUgPSBuZXcgZ2FtZS5HYW1lKHBhcnRpdGlvbktleSwgc29ydEtleSwgJ0xlYWd1ZSBvZiBMZWdlbmRzJywgMjAxMiwgJ01vYmEnLCAnUEMnLCAnUmlvdCBHYW1lcycpO1xyXG4gICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgaW5kZXguZGVsZXRlR2FtZUh0dHBSZXNwb25zZSh0ZXN0R2FtZSk7XHJcbiAgICBleHBlY3QocmVzcG9uc2UpLnRvRXF1YWwoaW5kZXguaHR0cFJlc3BvbnNlKHtzdGF0dXNDb2RlOiAyMDAsIGJvZHk6IEpTT04uc3RyaW5naWZ5KHRlc3RHYW1lKX0pKTtcclxufSk7XHJcblxyXG4vL0RlbGV0ZSBhIGdhbWUgdGhhdCBkb2Vzbid0IGV4aXN0XHJcbnRlc3QoXCJkZWxldGVHYW1lSHR0cFJlc3BvbnNlXCIsIGFzeW5jICgpID0+IHtcclxuICAgIGxldCBwYXJ0aXRpb25LZXkgPSAnW1VzZXJdI1ske2VyaWtjaGF1bGt9XSc7XHJcbiAgICBsZXQgc29ydEtleSA9ICdbR2FtZUl0ZW1dI1tUaGUgV2l0bmVzc10nO1xyXG4gICAgbGV0IHRlc3RHYW1lID0gbmV3IGdhbWUuR2FtZShwYXJ0aXRpb25LZXksIHNvcnRLZXksICdUaGUgV2l0bmVzcycsIDIwMTYsICdTdHJhdGVneScsICdQQycsICdWYWx2ZScpO1xyXG4gICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgaW5kZXguZGVsZXRlR2FtZUh0dHBSZXNwb25zZSh0ZXN0R2FtZSk7XHJcbiAgICBleHBlY3QocmVzcG9uc2UpLnRvRXF1YWwoaW5kZXguaHR0cFJlc3BvbnNlKHtzdGF0dXNDb2RlOiA0MDAsIGJvZHk6IFwiR2FtZSBlcnJvciwgZGF0YXN0b3JlIHJlc3BvbnNlOiBVbmFibGUgdG8gZGVsZXRlIGdhbWUuXCJ9KSk7XHJcbn0pO1xyXG5cclxuIl19