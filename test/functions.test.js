"use strict";
const game = require("../functions/models/game");
const gameManager = require("../functions/dataManager/gameManager");
const httpResponse = require("../functions/shared/common/httpResponse");
const error = require("../functions/error/gameErrorHandler");
const common = require("../functions/shared/common/game");
test("CreateGame", async () => {
    let partitionKey = '[User]#[${erikchaulk}]';
    let sortKey = '[GameItem]#[League of Legends]';
    let testCreateGame = new game.Game(partitionKey, sortKey, 'League of Legends', 2008, 'Moba', 'PC', 'Riot Games');
    let response = await gameManager.createGame(testCreateGame);
    expect(response).toEqual(testCreateGame);
});
test("GetGame", async () => {
    let partitionKey = '[User]#[${erikchaulk}]';
    let sortKey = '[GameItem]#[League of Legends]';
    let testGetGame = new game.Game(partitionKey, sortKey, 'League of Legends', 2008, 'Moba', 'PC', 'Riot Games');
    let response = await gameManager.getGame(testGetGame);
    expect(response).toEqual(testGetGame);
});
test("ModifyGame", async () => {
    let partitionKey = '[User]#[${erikchaulk}]';
    let sortKey = '[GameItem]#[League of Legends]';
    let testModifyGame = new game.Game(partitionKey, sortKey, 'League of Legends', 2010, 'Moba', 'PC', 'Riot Games');
    let response = await gameManager.modifyGame(testModifyGame);
    expect(response).toEqual(testModifyGame);
});
test("DeleteGame", async () => {
    let partitionKey = '[User]#[${erikchaulk}]';
    let sortKey = '[GameItem]#[League of Legends]';
    let testDeleteGame = new game.Game(partitionKey, sortKey, 'League of Legends', 2010, 'Moba', 'PC', 'Riot Games');
    let response = await gameManager.deleteGame(testDeleteGame);
    expect(response).toEqual(testDeleteGame);
});
test("serializeGameData", async () => {
    let partitionKey = '[User]#[erikchaulk]';
    let sortKey = '[GameItem]#[League of Legends]';
    let dynamoResponse = {
        'partitionKey': partitionKey,
        'sortKey': sortKey,
        'gameName': 'League of Legends',
        'yearReleased': 2010,
        'genre': 'Moba',
        'console': 'PC',
        'developer': 'Riot Games'
    };
    let userData = {
        userID: 'erikchaulk',
        email: 'erikchaulk@gmail.com'
    };
    let itemType = '[GameItem]';
    let response = common.serializeGameData(userData, dynamoResponse);
    let testDynamoResponse = new game.Game(partitionKey, sortKey, itemType, 'League of Legends', userData.email, 2010, 'Moba', 'PC', 'Riot Games');
    expect(response).toEqual(testDynamoResponse);
});
test("gameErrorHandler", async () => {
    let testError = new error.GameError('Game not found', 404);
    expect(testError.message).toEqual("Game error, datastore response: Game not found");
    expect(testError.statusCode).toEqual(404);
});
test("createGameHttpResponse", async () => {
    let partitionKey = '[User]#[${erikchaulk}]';
    let sortKey = '[GameItem]#[League of Legends]';
    let testGame = new game.Game(partitionKey, sortKey, 'League of Legends', 2010, 'Moba', 'PC', 'Riot Games');
    let response = await httpResponse.createGameHttpResponse(testGame);
    expect(response).toEqual(httpResponse.httpResponse({ statusCode: 200, body: JSON.stringify(testGame) }));
});
//Game already created
test("createGameHttpResponse", async () => {
    let partitionKey = '[User]#[${erikchaulk}]';
    let sortKey = '[GameItem]#[League of Legends]';
    let testGame = new game.Game(partitionKey, sortKey, 'League of Legends', 2010, 'Moba', 'PC', 'Riot Games');
    let response = await httpResponse.createGameHttpResponse(testGame);
    expect(response).toEqual(httpResponse.httpResponse({ statusCode: 400, body: "Unable to create game.  Game already exists." }));
});
test("getGameHttpResponse", async () => {
    let partitionKey = '[User]#[${erikchaulk}]';
    let sortKey = '[GameItem]#[League of Legends]';
    let testGame = new game.Game(partitionKey, sortKey, 'League of Legends', 2010, 'Moba', 'PC', 'Riot Games');
    let response = await httpResponse.getGameHttpResponse(testGame);
    expect(response).toEqual(httpResponse.httpResponse({ statusCode: 200, body: JSON.stringify(testGame) }));
});
test("modifyGameHttpResponse", async () => {
    let partitionKey = '[User]#[${erikchaulk}]';
    let sortKey = '[GameItem]#[League of Legends]';
    let testGame = new game.Game(partitionKey, sortKey, 'League of Legends', 2012, 'Moba', 'PC', 'Riot Games');
    let response = await httpResponse.modifyGameHttpResponse(testGame);
    expect(response).toEqual(httpResponse.httpResponse({ statusCode: 200, body: JSON.stringify(testGame) }));
});
//Modify a game that doesn't exist
test("modifyGameHttpResponse", async () => {
    let partitionKey = '[User]#[${erikchaulk}]';
    let sortKey = '[GameItem]#[The Witness]';
    let testGame = new game.Game(partitionKey, sortKey, 'The Witness', 2016, 'Strategy', 'PC', 'Valve');
    let response = await httpResponse.modifyGameHttpResponse(testGame);
    expect(response).toEqual(httpResponse.httpResponse({ statusCode: 400, body: "Unable to modify game.  Game not found." }));
});
test("deleteGameHttpResponse", async () => {
    let partitionKey = '[User]#[${erikchaulk}]';
    let sortKey = '[GameItem]#[League of Legends]';
    let testGame = new game.Game(partitionKey, sortKey, 'League of Legends', 2012, 'Moba', 'PC', 'Riot Games');
    let response = await httpResponse.deleteGameHttpResponse(testGame);
    expect(response).toEqual(httpResponse.httpResponse({ statusCode: 200, body: JSON.stringify(testGame) }));
});
//Delete a game that doesn't exist
test("deleteGameHttpResponse", async () => {
    let partitionKey = '[User]#[${erikchaulk}]';
    let sortKey = '[GameItem]#[The Witness]';
    let testGame = new game.Game(partitionKey, sortKey, 'The Witness', 2016, 'Strategy', 'PC', 'Valve');
    let response = await httpResponse.deleteGameHttpResponse(testGame);
    expect(response).toEqual(httpResponse.httpResponse({ statusCode: 400, body: "Unable to delete game.  Game not found." }));
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZnVuY3Rpb25zLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJmdW5jdGlvbnMudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsTUFBTSxJQUFJLEdBQUcsT0FBTyxDQUFDLDBCQUEwQixDQUFDLENBQUM7QUFDakQsTUFBTSxXQUFXLEdBQUcsT0FBTyxDQUFDLHNDQUFzQyxDQUFDLENBQUM7QUFDcEUsTUFBTSxZQUFZLEdBQUcsT0FBTyxDQUFDLHlDQUF5QyxDQUFDLENBQUM7QUFDeEUsTUFBTSxLQUFLLEdBQUcsT0FBTyxDQUFDLHFDQUFxQyxDQUFDLENBQUE7QUFDNUQsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLGlDQUFpQyxDQUFDLENBQUM7QUFFMUQsSUFBSSxDQUFDLFlBQVksRUFBRSxLQUFLLElBQUksRUFBRTtJQUMxQixJQUFJLFlBQVksR0FBRyx3QkFBd0IsQ0FBQTtJQUMzQyxJQUFJLE9BQU8sR0FBRyxnQ0FBZ0MsQ0FBQTtJQUM5QyxJQUFJLGNBQWMsR0FBRyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxZQUFZLENBQUMsQ0FBQztJQUNqSCxJQUFJLFFBQVEsR0FBRyxNQUFNLFdBQVcsQ0FBQyxVQUFVLENBQUMsY0FBYyxDQUFDLENBQUM7SUFDNUQsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxjQUFjLENBQUMsQ0FBQztBQUM3QyxDQUFDLENBQUMsQ0FBQztBQUVILElBQUksQ0FBQyxTQUFTLEVBQUUsS0FBSyxJQUFJLEVBQUU7SUFDdkIsSUFBSSxZQUFZLEdBQUcsd0JBQXdCLENBQUE7SUFDM0MsSUFBSSxPQUFPLEdBQUcsZ0NBQWdDLENBQUE7SUFDOUMsSUFBSSxXQUFXLEdBQUcsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxPQUFPLEVBQUUsbUJBQW1CLEVB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LFlBQVksQ0FBQyxZQUFZLENBQUMsRUFBQyxVQUFVLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxFQUFDLENBQUMsQ0FBQyxDQUFDO0FBQzNHLENBQUMsQ0FBQyxDQUFDO0FBRUgsa0NBQWtDO0FBQ2xDLElBQUksQ0FBQyx3QkFBd0IsRUFBRSxLQUFLLElBQUksRUFBRTtJQUN0QyxJQUFJLFlBQVksR0FBRyx3QkFBd0IsQ0FBQztJQUM1QyxJQUFJLE9BQU8sR0FBRywwQkFBMEIsQ0FBQztJQUN6QyxJQUFJLFFBQVEsR0FBRyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLE9BQU8sRUFBRSxhQUFhLEVBQUUsSUFBSSxFQUFFLFVBQVUsRUFBRSxJQUFJLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDcEcsSUFBSSxRQUFRLEdBQUcsTUFBTSxZQUFZLENBQUMsc0JBQXNCLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDbkUsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsWUFBWSxDQUFDLEVBQUMsVUFBVSxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUseUNBQXlDLEVBQUMsQ0FBQyxDQUFDLENBQUM7QUFDNUgsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBnYW1lID0gcmVxdWlyZShcIi4uL2Z1bmN0aW9ucy9tb2RlbHMvZ2FtZVwiKTtcclxuY29uc3QgZ2FtZU1hbmFnZXIgPSByZXF1aXJlKFwiLi4vZnVuY3Rpb25zL2RhdGFNYW5hZ2VyL2dhbWVNYW5hZ2VyXCIpO1xyXG5jb25zdCBodHRwUmVzcG9uc2UgPSByZXF1aXJlKFwiLi4vZnVuY3Rpb25zL3NoYXJlZC9jb21tb24vaHR0cFJlc3BvbnNlXCIpO1xyXG5jb25zdCBlcnJvciA9IHJlcXVpcmUoXCIuLi9mdW5jdGlvbnMvZXJyb3IvZ2FtZUVycm9ySGFuZGxlclwiKVxyXG5jb25zdCBjb21tb24gPSByZXF1aXJlKFwiLi4vZnVuY3Rpb25zL3NoYXJlZC9jb21tb24vZ2FtZVwiKTtcclxuXHJcbnRlc3QoXCJDcmVhdGVHYW1lXCIsIGFzeW5jICgpID0+IHtcclxuICAgIGxldCBwYXJ0aXRpb25LZXkgPSAnW1VzZXJdI1ske2VyaWtjaGF1bGt9XSdcclxuICAgIGxldCBzb3J0S2V5ID0gJ1tHYW1lSXRlbV0jW0xlYWd1ZSBvZiBMZWdlbmRzXSdcclxuICAgIGxldCB0ZXN0Q3JlYXRlR2FtZSA9IG5ldyBnYW1lLkdhbWUocGFydGl0aW9uS2V5LCBzb3J0S2V5LCAnTGVhZ3VlIG9mIExlZ2VuZHMnLCAyMDA4LCAnTW9iYScsICdQQycsICdSaW90IEdhbWVzJyk7XHJcbiAgICBsZXQgcmVzcG9uc2UgPSBhd2FpdCBnYW1lTWFuYWdlci5jcmVhdGVHYW1lKHRlc3RDcmVhdGVHYW1lKTtcclxuICAgIGV4cGVjdChyZXNwb25zZSkudG9FcXVhbCh0ZXN0Q3JlYXRlR2FtZSk7XHJcbn0pO1xyXG5cclxudGVzdChcIkdldEdhbWVcIiwgYXN5bmMgKCkgPT4ge1xyXG4gICAgbGV0IHBhcnRpdGlvbktleSA9ICdbVXNlcl0jWyR7ZXJpa2NoYXVsa31dJ1xyXG4gICAgbGV0IHNvcnRLZXkgPSAnW0dhbWVJdGVtXSNbTGVhZ3VlIG9mIExlZ2VuZHNdJ1xyXG4gICAgbGV0IHRlc3RHZXRHYW1lID0gbmV3IGdhbWUuR2FtZShwYXJ0aXRpb25LZXksIHNvcnRLZXksICdMZWFndWUgb2YgTGVnZW5kcycsIDIwMDgsICdNb2JhJywgJ1BDJywgJ1Jpb3QgR2FtZXMnKTtcclxuICAgIGxldCByZXNwb25zZSA9IGF3YWl0IGdhbWVNYW5hZ2VyLmdldEdhbWUodGVzdEdldEdhbWUpO1xyXG4gICAgZXhwZWN0KHJlc3BvbnNlKS50b0VxdWFsKHRlc3RHZXRHYW1lKTtcclxufSk7XHJcblxyXG50ZXN0KFwiTW9kaWZ5R2FtZVwiLCBhc3luYyAoKSA9PiB7XHJcbiAgICBsZXQgcGFydGl0aW9uS2V5ID0gJ1tVc2VyXSNbJHtlcmlrY2hhdWxrfV0nXHJcbiAgICBsZXQgc29ydEtleSA9ICdbR2FtZUl0ZW1dI1tMZWFndWUgb2YgTGVnZW5kc10nXHJcbiAgICBsZXQgdGVzdE1vZGlmeUdhbWUgPSBuZXcgZ2FtZS5HYW1lKHBhcnRpdGlvbktleSwgc29ydEtleSwgJ0xlYWd1ZSBvZiBMZWdlbmRzJywgMjAxMCwgJ01vYmEnLCAnUEMnLCAnUmlvdCBHYW1lcycpO1xyXG4gICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgZ2FtZU1hbmFnZXIubW9kaWZ5R2FtZSh0ZXN0TW9kaWZ5R2FtZSk7XHJcbiAgICBleHBlY3QocmVzcG9uc2UpLnRvRXF1YWwodGVzdE1vZGlmeUdhbWUpO1xyXG59KTtcclxuXHJcbnRlc3QoXCJEZWxldGVHYW1lXCIsIGFzeW5jICgpID0+IHtcclxuICAgIGxldCBwYXJ0aXRpb25LZXkgPSAnW1VzZXJdI1ske2VyaWtjaGF1bGt9XSdcclxuICAgIGxldCBzb3J0S2V5ID0gJ1tHYW1lSXRlbV0jW0xlYWd1ZSBvZiBMZWdlbmRzXSdcclxuICAgIGxldCB0ZXN0RGVsZXRlR2FtZSA9IG5ldyBnYW1lLkdhbWUocGFydGl0aW9uS2V5LCBzb3J0S2V5LCAnTGVhZ3VlIG9mIExlZ2VuZHMnLCAyMDEwLCAnTW9iYScsICdQQycsICdSaW90IEdhbWVzJyk7XHJcbiAgICBsZXQgcmVzcG9uc2UgPSBhd2FpdCBnYW1lTWFuYWdlci5kZWxldGVHYW1lKHRlc3REZWxldGVHYW1lKTtcclxuICAgIGV4cGVjdChyZXNwb25zZSkudG9FcXVhbCh0ZXN0RGVsZXRlR2FtZSk7XHJcbn0pO1xyXG5cclxudGVzdChcInNlcmlhbGl6ZUdhbWVEYXRhXCIsIGFzeW5jICgpID0+IHtcclxuICAgIGxldCBwYXJ0aXRpb25LZXkgPSAnW1VzZXJdI1tlcmlrY2hhdWxrXSdcclxuICAgIGxldCBzb3J0S2V5ID0gJ1tHYW1lSXRlbV0jW0xlYWd1ZSBvZiBMZWdlbmRzXSdcclxuICAgIGxldCBkeW5hbW9SZXNwb25zZSA9IHtcclxuICAgICAgICAncGFydGl0aW9uS2V5JzpwYXJ0aXRpb25LZXksXHJcbiAgICAgICAgJ3NvcnRLZXknOiBzb3J0S2V5LFxyXG4gICAgICAgICdnYW1lTmFtZSc6J0xlYWd1ZSBvZiBMZWdlbmRzJyxcclxuICAgICAgICAneWVhclJlbGVhc2VkJzoyMDEwLFxyXG4gICAgICAgICdnZW5yZSc6J01vYmEnLFxyXG4gICAgICAgICdjb25zb2xlJzonUEMnLFxyXG4gICAgICAgICdkZXZlbG9wZXInOidSaW90IEdhbWVzJ1xyXG4gICAgfVxyXG4gICAgbGV0IHVzZXJEYXRhID0ge1xyXG4gICAgICAgIHVzZXJJRDogJ2VyaWtjaGF1bGsnLFxyXG4gICAgICAgIGVtYWlsOiAnZXJpa2NoYXVsa0BnbWFpbC5jb20nXHJcbiAgICB9XHJcbiAgICBsZXQgaXRlbVR5cGUgPSAnW0dhbWVJdGVtXSdcclxuICAgIGxldCByZXNwb25zZSA9IGNvbW1vbi5zZXJpYWxpemVHYW1lRGF0YSh1c2VyRGF0YSwgZHluYW1vUmVzcG9uc2UpO1xyXG4gICAgbGV0IHRlc3REeW5hbW9SZXNwb25zZSA9IG5ldyBnYW1lLkdhbWUocGFydGl0aW9uS2V5LCBzb3J0S2V5LCBpdGVtVHlwZSwgJ0xlYWd1ZSBvZiBMZWdlbmRzJywgdXNlckRhdGEuZW1haWwsIDIwMTAsICdNb2JhJywgJ1BDJywgJ1Jpb3QgR2FtZXMnKTtcclxuICAgIGV4cGVjdChyZXNwb25zZSkudG9FcXVhbCh0ZXN0RHluYW1vUmVzcG9uc2UpO1xyXG59KTtcclxuXHJcbnRlc3QoXCJnYW1lRXJyb3JIYW5kbGVyXCIsIGFzeW5jICgpID0+IHtcclxuICAgIGxldCB0ZXN0RXJyb3IgPSBuZXcgZXJyb3IuR2FtZUVycm9yKCdHYW1lIG5vdCBmb3VuZCcsIDQwNCk7XHJcbiAgICBleHBlY3QodGVzdEVycm9yLm1lc3NhZ2UpLnRvRXF1YWwoXCJHYW1lIGVycm9yLCBkYXRhc3RvcmUgcmVzcG9uc2U6IEdhbWUgbm90IGZvdW5kXCIpO1xyXG4gICAgZXhwZWN0KHRlc3RFcnJvci5zdGF0dXNDb2RlKS50b0VxdWFsKDQwNCk7ICAgIFxyXG59KTtcclxuXHJcbnRlc3QoXCJjcmVhdGVHYW1lSHR0cFJlc3BvbnNlXCIsIGFzeW5jICgpID0+IHtcclxuICAgIGxldCBwYXJ0aXRpb25LZXkgPSAnW1VzZXJdI1ske2VyaWtjaGF1bGt9XSdcclxuICAgIGxldCBzb3J0S2V5ID0gJ1tHYW1lSXRlbV0jW0xlYWd1ZSBvZiBMZWdlbmRzXSdcclxuICAgIGxldCB0ZXN0R2FtZSA9IG5ldyBnYW1lLkdhbWUocGFydGl0aW9uS2V5LCBzb3J0S2V5LCAnTGVhZ3VlIG9mIExlZ2VuZHMnLCAyMDEwLCAnTW9iYScsICdQQycsICdSaW90IEdhbWVzJyk7XHJcbiAgICBsZXQgcmVzcG9uc2UgPSBhd2FpdCBodHRwUmVzcG9uc2UuY3JlYXRlR2FtZUh0dHBSZXNwb25zZSh0ZXN0R2FtZSk7XHJcbiAgICBleHBlY3QocmVzcG9uc2UpLnRvRXF1YWwoaHR0cFJlc3BvbnNlLmh0dHBSZXNwb25zZSh7c3RhdHVzQ29kZTogMjAwLCBib2R5OiBKU09OLnN0cmluZ2lmeSh0ZXN0R2FtZSl9KSk7XHJcbn0pO1xyXG5cclxuLy9HYW1lIGFscmVhZHkgY3JlYXRlZFxyXG50ZXN0KFwiY3JlYXRlR2FtZUh0dHBSZXNwb25zZVwiLCBhc3luYyAoKSA9PiB7XHJcbiAgICBsZXQgcGFydGl0aW9uS2V5ID0gJ1tVc2VyXSNbJHtlcmlrY2hhdWxrfV0nXHJcbiAgICBsZXQgc29ydEtleSA9ICdbR2FtZUl0ZW1dI1tMZWFndWUgb2YgTGVnZW5kc10nXHJcbiAgICBsZXQgdGVzdEdhbWUgPSBuZXcgZ2FtZS5HYW1lKHBhcnRpdGlvbktleSwgc29ydEtleSwgJ0xlYWd1ZSBvZiBMZWdlbmRzJywgMjAxMCwgJ01vYmEnLCAnUEMnLCAnUmlvdCBHYW1lcycpO1xyXG4gICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgaHR0cFJlc3BvbnNlLmNyZWF0ZUdhbWVIdHRwUmVzcG9uc2UodGVzdEdhbWUpO1xyXG4gICAgZXhwZWN0KHJlc3BvbnNlKS50b0VxdWFsKGh0dHBSZXNwb25zZS5odHRwUmVzcG9uc2Uoe3N0YXR1c0NvZGU6IDQwMCwgYm9keTogXCJVbmFibGUgdG8gY3JlYXRlIGdhbWUuICBHYW1lIGFscmVhZHkgZXhpc3RzLlwifSkpO1xyXG59KTtcclxuXHJcbnRlc3QoXCJnZXRHYW1lSHR0cFJlc3BvbnNlXCIsIGFzeW5jICgpID0+IHtcclxuICAgIGxldCBwYXJ0aXRpb25LZXkgPSAnW1VzZXJdI1ske2VyaWtjaGF1bGt9XSdcclxuICAgIGxldCBzb3J0S2V5ID0gJ1tHYW1lSXRlbV0jW0xlYWd1ZSBvZiBMZWdlbmRzXSdcclxuICAgIGxldCB0ZXN0R2FtZSA9IG5ldyBnYW1lLkdhbWUocGFydGl0aW9uS2V5LCBzb3J0S2V5LCAnTGVhZ3VlIG9mIExlZ2VuZHMnLCAyMDEwLCAnTW9iYScsICdQQycsICdSaW90IEdhbWVzJyk7XHJcbiAgICBsZXQgcmVzcG9uc2UgPSBhd2FpdCBodHRwUmVzcG9uc2UuZ2V0R2FtZUh0dHBSZXNwb25zZSh0ZXN0R2FtZSk7XHJcbiAgICBleHBlY3QocmVzcG9uc2UpLnRvRXF1YWwoaHR0cFJlc3BvbnNlLmh0dHBSZXNwb25zZSh7c3RhdHVzQ29kZTogMjAwLCBib2R5OiBKU09OLnN0cmluZ2lmeSh0ZXN0R2FtZSl9KSk7XHJcbn0pO1xyXG5cclxudGVzdChcIm1vZGlmeUdhbWVIdHRwUmVzcG9uc2VcIiwgYXN5bmMgKCkgPT4ge1xyXG4gICAgbGV0IHBhcnRpdGlvbktleSA9ICdbVXNlcl0jWyR7ZXJpa2NoYXVsa31dJztcclxuICAgIGxldCBzb3J0S2V5ID0gJ1tHYW1lSXRlbV0jW0xlYWd1ZSBvZiBMZWdlbmRzXSc7XHJcbiAgICBsZXQgdGVzdEdhbWUgPSBuZXcgZ2FtZS5HYW1lKHBhcnRpdGlvbktleSwgc29ydEtleSwgJ0xlYWd1ZSBvZiBMZWdlbmRzJywgMjAxMiwgJ01vYmEnLCAnUEMnLCAnUmlvdCBHYW1lcycpO1xyXG4gICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgaHR0cFJlc3BvbnNlLm1vZGlmeUdhbWVIdHRwUmVzcG9uc2UodGVzdEdhbWUpO1xyXG4gICAgZXhwZWN0KHJlc3BvbnNlKS50b0VxdWFsKGh0dHBSZXNwb25zZS5odHRwUmVzcG9uc2Uoe3N0YXR1c0NvZGU6IDIwMCwgYm9keTogSlNPTi5zdHJpbmdpZnkodGVzdEdhbWUpfSkpO1xyXG59KTtcclxuXHJcbi8vTW9kaWZ5IGEgZ2FtZSB0aGF0IGRvZXNuJ3QgZXhpc3RcclxudGVzdChcIm1vZGlmeUdhbWVIdHRwUmVzcG9uc2VcIiwgYXN5bmMgKCkgPT4ge1xyXG4gICAgbGV0IHBhcnRpdGlvbktleSA9ICdbVXNlcl0jWyR7ZXJpa2NoYXVsa31dJztcclxuICAgIGxldCBzb3J0S2V5ID0gJ1tHYW1lSXRlbV0jW1RoZSBXaXRuZXNzXSc7XHJcbiAgICBsZXQgdGVzdEdhbWUgPSBuZXcgZ2FtZS5HYW1lKHBhcnRpdGlvbktleSwgc29ydEtleSwgJ1RoZSBXaXRuZXNzJywgMjAxNiwgJ1N0cmF0ZWd5JywgJ1BDJywgJ1ZhbHZlJyk7XHJcbiAgICBsZXQgcmVzcG9uc2UgPSBhd2FpdCBodHRwUmVzcG9uc2UubW9kaWZ5R2FtZUh0dHBSZXNwb25zZSh0ZXN0R2FtZSk7XHJcbiAgICBleHBlY3QocmVzcG9uc2UpLnRvRXF1YWwoaHR0cFJlc3BvbnNlLmh0dHBSZXNwb25zZSh7c3RhdHVzQ29kZTogNDAwLCBib2R5OiBcIlVuYWJsZSB0byBtb2RpZnkgZ2FtZS4gIEdhbWUgbm90IGZvdW5kLlwifSkpO1xyXG59KTtcclxuXHJcbnRlc3QoXCJkZWxldGVHYW1lSHR0cFJlc3BvbnNlXCIsIGFzeW5jICgpID0+IHtcclxuICAgIGxldCBwYXJ0aXRpb25LZXkgPSAnW1VzZXJdI1ske2VyaWtjaGF1bGt9XSc7XHJcbiAgICBsZXQgc29ydEtleSA9ICdbR2FtZUl0ZW1dI1tMZWFndWUgb2YgTGVnZW5kc10nO1xyXG4gICAgbGV0IHRlc3RHYW1lID0gbmV3IGdhbWUuR2FtZShwYXJ0aXRpb25LZXksIHNvcnRLZXksICdMZWFndWUgb2YgTGVnZW5kcycsIDIwMTIsICdNb2JhJywgJ1BDJywgJ1Jpb3QgR2FtZXMnKTtcclxuICAgIGxldCByZXNwb25zZSA9IGF3YWl0IGh0dHBSZXNwb25zZS5kZWxldGVHYW1lSHR0cFJlc3BvbnNlKHRlc3RHYW1lKTtcclxuICAgIGV4cGVjdChyZXNwb25zZSkudG9FcXVhbChodHRwUmVzcG9uc2UuaHR0cFJlc3BvbnNlKHtzdGF0dXNDb2RlOiAyMDAsIGJvZHk6IEpTT04uc3RyaW5naWZ5KHRlc3RHYW1lKX0pKTtcclxufSk7XHJcblxyXG4vL0RlbGV0ZSBhIGdhbWUgdGhhdCBkb2Vzbid0IGV4aXN0XHJcbnRlc3QoXCJkZWxldGVHYW1lSHR0cFJlc3BvbnNlXCIsIGFzeW5jICgpID0+IHtcclxuICAgIGxldCBwYXJ0aXRpb25LZXkgPSAnW1VzZXJdI1ske2VyaWtjaGF1bGt9XSc7XHJcbiAgICBsZXQgc29ydEtleSA9ICdbR2FtZUl0ZW1dI1tUaGUgV2l0bmVzc10nO1xyXG4gICAgbGV0IHRlc3RHYW1lID0gbmV3IGdhbWUuR2FtZShwYXJ0aXRpb25LZXksIHNvcnRLZXksICdUaGUgV2l0bmVzcycsIDIwMTYsICdTdHJhdGVneScsICdQQycsICdWYWx2ZScpO1xyXG4gICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgaHR0cFJlc3BvbnNlLmRlbGV0ZUdhbWVIdHRwUmVzcG9uc2UodGVzdEdhbWUpO1xyXG4gICAgZXhwZWN0KHJlc3BvbnNlKS50b0VxdWFsKGh0dHBSZXNwb25zZS5odHRwUmVzcG9uc2Uoe3N0YXR1c0NvZGU6IDQwMCwgYm9keTogXCJVbmFibGUgdG8gZGVsZXRlIGdhbWUuICBHYW1lIG5vdCBmb3VuZC5cIn0pKTtcclxufSk7XHJcblxyXG4iXX0=